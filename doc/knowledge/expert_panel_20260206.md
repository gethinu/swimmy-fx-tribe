# 🦅 Expert Panel Report (Consult)

**Date:** 2026-02-06
**Leader:** Elon Musk
**Mode:** consult
**Trigger:** 「候補戦略の母集団サイズをどうする？」（Pair-Compositeのペア選定）
**Purpose:** ペア選定の母集団サイズを決め、計算コストと分散効果のバランスを取る
**Constraints:** 既存単一戦略を壊さない／対象はA/S/Legend／相関|corr|≤0.2・N≥100／最大5ペア／ロット上限のみ介入（設計）
**Success Criteria:** 選定処理が現実的な計算量で回り、再現性のある上位ペアを安定的に得られる／単一戦略の挙動を変更しない
**Assumptions:** Pearson相関／PnL系列はOOS/CPCV/Backtestのtrade_list由来／trade_listはINTERFACES準拠
**Uncertainties:** 候補数の実態（A/S/Legendの規模）／trade_listの欠損率／異なるTF/シンボル混在時の相関の妥当性

## 🏛️ 常設顧問の意見
### Taleb: 「計算量より“破滅確率”を最小化しろ」
- **選択肢**
  1) **全A/S/Legend総当たり**: 分散最大化だがノイズと偶然相関が増え、破滅耐性はむしろ低下する恐れ。  
  2) **上位K本に限定**: 破滅確率は下がるが、モデルの脆弱性（過適合・単調化）が増える。  
  3) **層別（シンボル/TF単位で上位N）**: 分散を維持しつつ、偶然相関の温床を減らす。
- **意地悪ポイント**: 「候補数の上限不在」は事故待ち。設計書に“候補生成の上限が曖昧”のまま（`docs/plans/2026-02-06-pair-composite-strategy-design.md:14-41`）。
- **具体的指摘**: 既存実装は選定ロジックが未実装で、判断を後回しにしている（`docs/llm/STATE.md:36`、`src/lisp/school/school-pair-composite.lisp:5-46`）。

### Graham: 「速度は“削る”ことで得る」
- **選択肢**
  1) **総当たり**: “最初は全部やる”はスケール死。  
  2) **上位K本**: 実装容易・計算量が読める。  
  3) **層別K（推奨）**: UX的には“無駄なく分散”が説明しやすい。
- **意地悪ポイント**: 仕様上はA/S/Legend対象だが、母集団サイズが無制限のまま（`docs/plans/2026-02-06-pair-composite-strategy-design.md:14-40`）。
- **具体的指摘**: trade_listを正本とする設計だが、巨大メッセージ対策が未実装（`docs/llm/INTERFACES.md:229-248`）。母集団を増やすほど、欠損や切り捨てが増えやすい。

### Naval: 「レバレッジは“自動化”に使え」
- **選択肢**
  1) **総当たり**: 自動化に乗るなら良いが、今はパイプラインが未完成。  
  2) **上位K**: まずは運用可能性を優先する。  
  3) **層別K**: 自動化に向けた中間解。
- **意地悪ポイント**: “母集団サイズ”のルールがないと将来の自動運用が破綻する。運用フラグ未接続も放置されている（`docs/llm/STATE.md:36`）。

### Simons: 「計算量は戦略の敵だ」
- **選択肢**
  1) **総当たり**: O(n^2)で死ぬ。  
  2) **上位K**: Kを固定すれば計算量を制御できる。  
  3) **層別K**: 分散の維持に合理性がある。
- **意地悪ポイント**: 相関の定義は決まったが、サンプル数N不足のフィルタが最初に入らないと、相関推定がゴミになる（`docs/plans/2026-02-06-pair-composite-strategy-design.md:38-47`）。

## 💻 技術パネルの意見
### Fowler: 「設計の分割が曖昧」
- **選択肢**
  1) **総当たり**: テストや可観測性の境界が壊れる。  
  2) **上位K**: 設計の責務分離に向く。  
  3) **層別K**: ポリシー層として独立できる。
- **意地悪ポイント**: pair候補生成の責務が “設計上の箱” にあるだけで、APIが未定義（`docs/plans/2026-02-06-pair-composite-strategy-design.md:23-27`）。

### Hickey: 「シンプルさが足りない」
- **選択肢**
  1) **総当たり**: シンプルに見えて複雑性が爆発する。  
  2) **上位K**: ルールは単純で良い。  
  3) **層別K**: “ルールとして”書けるなら許容。
- **意地悪ポイント**: PnL系列の生成と相関計算がコード上に存在しない。複雑性は実装時に暴走する（`src/lisp/school/school-pair-composite.lisp:5-46`）。

### Uncle Bob: 「テストが先にない」
- **選択肢**
  1) **総当たり**: テスト負荷が跳ね上がる。  
  2) **上位K**: テストケースを限定できる。  
  3) **層別K**: テスト戦略を立てやすい。
- **意地悪ポイント**: 設計は“相関計算テスト”を要求するのに、実装の足場がない（`docs/plans/2026-02-06-pair-composite-strategy-design.md:114-117`）。

## 🚀 ビジョナリーの意見
### Ng: 「データ分布の歪みが最大リスク」
- **選択肢**
  1) **総当たり**: 分布が混ざりすぎて学習に毒。  
  2) **上位K**: 毒入り特徴量が減るが、バイアスが増える。  
  3) **層別K**: 分布の偏りを抑えやすい。
- **意地悪ポイント**: trade_listの欠損/切り捨てがある前提なら、母集団を広げるほどバイアスが増える（`docs/llm/INTERFACES.md:229-248`）。

### López de Prado: 「相関推定の不安定性」
- **選択肢**
  1) **総当たり**: 見せかけの相関が大量発生。  
  2) **上位K**: 統計的ノイズは減るが、多様性は減る。  
  3) **層別K**: 多様性を保ちつつノイズを抑えられる。
- **意地悪ポイント**: OOS/CPCV/Backtestの結合は良いが、相関の推定誤差を明示的に扱っていない（`docs/plans/2026-02-06-pair-composite-strategy-design.md:30-47`）。

### Gene Kim: 「運用は“遅い正しさ”より“速い失敗検知”」
- **選択肢**
  1) **総当たり**: 失敗検知が遅い。  
  2) **上位K**: 運用コストを抑え、監視も軽くできる。  
  3) **層別K**: “局所的な失敗”を検出しやすい。
- **意地悪ポイント**: 選定処理の可観測性/メトリクスが定義されていない。運用前に「何を監視するか」を決めるべき。

## 🚀 Musk's Decision (Final)
> 「全件総当たりはやらない。層別Kで行く。実装コストは小さく、運用が回る。失敗は早く検知できる構造にする。」

## Actionable Items
1. 候補母集団を **層別K（シンボル×TFごとに上位N）** に決定し、仕様へ明記（`docs/plans/2026-02-06-pair-composite-strategy-design.md`）。
2. 相関計算の前に **N≥100フィルタ** と **データ欠損率** のチェックを必須化。
3. 選定処理のメトリクス（候補数、落選理由、計算時間）をログ/レポートに追加。
4. trade_list欠損/切り捨て時のフェイルオープンを仕様として強化。
