#!/bin/bash
# Swimmy Control Script (Systemd Wrapper)
# Following Musk's Decision: Single Point of Control

BOLD='\033[1m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

show_help() {
    echo -e "${BOLD}üêü Swimmy Control Script${NC}"
    echo ""
    echo "Usage: swim [command]"
    echo ""
    echo "Commands:"
    echo "  (none)      Run Swimmy locally (Dev Mode) - No Sudo"
    echo "  local       Run Swimmy locally (same as default)"
    echo "  svc-start   Start Swimmy Service (Systemd)"
    echo "  svc-stop    Stop Swimmy Service (Systemd)"
    echo "  svc-restart Restart Swimmy Service (Systemd)"
    echo "  svc-status  Show Swimmy Service Status"
    echo "  svc-logs    Follow Swimmy Service logs"
    echo "  help        Show this help"
    echo ""
    echo "Examples:"
    echo "  swim            # Run locally (calls make run)"
    echo "  swim svc-status # Check systemd service"
}

case "$1" in
    start)
        echo -e "${GREEN}[SWIM]${NC} üöÄ Starting Swimmy..."
        sudo systemctl start swimmy
        sleep 2
        sudo systemctl status swimmy --no-pager
        ;;
    stop)
        echo -e "${YELLOW}[SWIM]${NC} üõë Stopping Swimmy..."
        sudo systemctl stop swimmy
        echo -e "${GREEN}[SWIM]${NC} ‚úÖ Swimmy stopped."
        ;;
    restart)
        echo -e "${YELLOW}[SWIM]${NC} üîÑ Restarting Swimmy..."
        sudo systemctl restart swimmy
        sleep 2
        sudo systemctl status swimmy --no-pager
        ;;
    status)
        echo -e "${BOLD}[SWIM]${NC} üìä Swimmy Status:"
        sudo systemctl status swimmy --no-pager
        ;;
    logs)
        echo -e "${BOLD}[SWIM]${NC} üìú Following Swimmy logs (Ctrl+C to exit)..."
        journalctl -u swimmy -f
        ;;
    help|--help|-h)
        show_help
        ;;
    local)
        echo -e "${GREEN}[SWIM]${NC} üèÉ Running Swimmy Locally..."
        make run
        ;;
    svc-restart)
        echo -e "${YELLOW}[SWIM]${NC} üîÑ Restarting Swimmy Service (Requires Sudo)..."
        sudo systemctl restart swimmy
        sleep 2
        sudo systemctl status swimmy --no-pager
        ;;
    "")
        # Default: Run locally (No Sudo)
        echo -e "${GREEN}[SWIM]${NC} üêü Swimmy Control (Dev Mode)"
        make run
        ;;
    *)
        echo -e "${RED}[SWIM]${NC} ‚ùå Unknown command: $1"
        echo ""
        show_help
        exit 1
        ;;
esac
