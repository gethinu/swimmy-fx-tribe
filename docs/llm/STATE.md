# Swimmy System State

## 現在の状態
- **稼働フェーズ**: V50.6 (Structured Telemetry) - 2026-02-03
- **V50.8 KPI再設定（2026-02-26）**:
  - 収益KPIを `月利10%` から **主KPI: 月利3% / ストレッチ: 月利5%** へ再設定。
  - `monthly10` 表記の成果物は履歴として保持し、運用判定は `3%/5%` 基準を正本とする。
- **V50.8-P5.15 実装整合（2026-02-26）**:
  - `tools/xau_autobot.py` の `ema_gap_over_atr` レンジゲート（既定 `0.9..2.5`）を実コードへ適用する。
  - `tools/xau_autobot_trial_judge.py` の判定出力を `readiness/performance` 分割へ統一し、`min_closed_positions` 既定を `12` に合わせる。
- **V50.8-P5.16 観測メトリクス追加（2026-02-26）**:
  - `tools/xau_autobot.py` の実行payloadへ runtime 集計（`gate_check_count`, `gate_reject_gap_count`, `signal_counts`）を同梱し、gapゲート導入効果を運用ログで定量確認できる状態を正本とする。
  - `tools/xau_autobot_live_report.py` の summary に `closed_per_day`, `close_reason_counts(tp/sl/other)`, `tp_sl_ratio` を追加し、14日/30日窓の回転率と SL偏重の可観測性を強化する。
- **V50.8-P5.17 運用監査判定自動化（2026-02-26）**:
  - 監査CLI `tools/xau_autobot_operational_audit.py` を正本化し、3日窓で `gap_reject_rate / tp_sl_ratio / closed_per_day / expectancy` を集計して `PASS/WARN/FAIL` を自動判定する。
  - 修正ガイドは判定パターン `A/B/C`（過剰制限・弱ゲート・RR不整合）を出力し、次の設定変更をルール化する。
  - `tools/xau_autobot.py` は各サイクルpayloadを runtime journal（JSONL）へ追記し、`runtime_metrics` の監査母集団を継続保存する。
- **V50.8-P5.18 runtime観測連続性修復（2026-02-26）**:
  - `tools/xau_autobot.py` の runtime journal 既定パスを repo-root 基準の絶対解決へ固定し、実行cwd差分で `runtime_metrics` 保存先が漂流しない状態を正本とする。
  - `tools/xau_autobot_live_report.py` は最新 runtime snapshot を `runtime_metrics` として同梱し、trial日次レポート単体でも gap ゲート稼働状況を監査可能にする。
  - `tools/xau_autobot_operational_audit.py` は runtime journal 欠損時に live report 同梱の `runtime_metrics` を fallback 集計し、`snapshot_count=0` による観測断絶を回避する。
- **V50.8-P5.19 監査メタ契約固定（2026-02-26）**:
  - `runtime_metrics` の出所優先順位を `journal -> live_report_snapshot(fallback)` へ固定し、監査出力に `runtime_metrics_source` / `runtime_metrics_fallback_reason` を明示する。
  - runtime snapshot は `snapshot_time_utc`, `run_id`, `magic`, `schema_version` を保持し、run混線を監査ログで追跡可能にする。
  - `gate_check_count` は「bar確定サイクルで gap 判定 (`gap_gate_checked=true`) を実行した回数」を分母定義とし、tick単位カウントへ拡散させない。
- **V50.8 Timeframe Mapping整合（2026-02-26）**:
  - `tools/xau_autobot_optimize.py` の `--interval` を出力configの `timeframe` と整合させる（例: `15m->M15`, `60m/1h->H1`, `4h->H4`）。
  - 非対応intervalは fail-closed で拒否し、最適化条件とライブ実行足の乖離を防止する。
- **V50.8 M5除外探索（2026-02-26）**:
  - `M15/H1` を60dで再最適化し、trial候補を分離作成（`magic=560186/560187`）。
  - readiness 比較:
    - `M15`: `trades=116`, `PF=1.972`, `total_return=0.2493`（GO）
    - `H1`: `trades=20`, `PF=2.2239`, `total_return=0.0649`（GO, ただし件数薄）
  - 新規 trial config:
    - `tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_m15.json`
    - `tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_h1.json`
- **V50.8 月次判定schema正規化（2026-02-26）**:
  - `v50_8_monthly_decision_*.json` の正本判定キーを **主KPI 3% / ストレッチ 5%** に統一する。
  - `monthly_10pct_reached` は履歴互換キーとして保持し、運用判定には使わない。
- **V50.8-P5.23 正本run再同期（2026-02-27）**:
  - 正本runは `primary=trial_v2_20260227_v50_8_30d_r3u_h1`、副runは `secondary=trial_v2_20260227_alpha3_r2` を採用する。
  - `xau_autobot_trial_v2_current_run.json` / `xau_autobot_trial_v2_current_run_r1.json` / `xau_autobot_trial_v2_current_run_r2.json` / `v50_8_dual_run_status_20260226.json` / `v50_8_monthly_decision_20260225.json` の run 参照を一致させる。
  - interface 変更はなく、`INTERFACES.md` 更新は不要。
- **V50.8-P5.30 並行運用モード（2026-02-27）**:
  - ユーザー指示 `並行で` に従い、`primary + secondary(2本)` の同時運用を許可する。
  - 正本KPI run は `primary=trial_v2_20260227_v50_8_30d_r3u_h1` を維持する。
  - secondary は `trial_v2_20260227_v50_8_30d_r2v_h1`（判定系）と `trial_v2_20260227_alpha3_r2`（探索系）を同時運用する。
  - run meta / lock は衝突回避のため分離する。
    - `r2v_h1`: `data/reports/xau_autobot_trial_v2_current_run_r2.json` / `data/runtime/xau_autobot_trial_v2_r2.lock`
    - `alpha3_r2`: `data/reports/xau_autobot_trial_v2_current_run_r3.json` / `data/runtime/xau_autobot_trial_v2_r3.lock`
  - `v50_8_dual_run_status_*.json` と `v50_8_monthly_decision_*.json` は正本判定として `primary + r2v_h1` を使い、`alpha3_r2` は別 judge/gap の探索観測として扱う。
  - interface 変更はなく、`INTERFACES.md` 更新は不要。
- **V50.8-P5.35 execution-path回復強化（2026-02-27）**:
  - `tools/xau_autobot.py` に `retcode=5` / `comment~Disk error` 検出時の **MT5再接続 + 単回再送** を実装し、build更新/terminal再起動局面の一時失敗からの自己回復経路を追加。
  - 注文結果に `mt5_last_error` / `reconnect_retried` / `reconnect_success` / `reconnect_detail` を同梱し、`order_check=Done` かつ `order_send` 失敗時の切り分けを強化。
  - 回帰: `tools/tests/test_xau_autobot.py`（50件）PASS、`tools/tests/test_xau_autobot_live_report.py` + `tools/tests/test_xau_autobot_trial_v2_eval.py` + `tools/tests/test_xau_autobot_operational_audit.py`（32件）PASS。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.37 filling mode適応（2026-02-27）**:
  - `tools/xau_autobot.py` の fill mode 選択を `symbol_info.filling_mode` + 直近成功 mode の優先順へ更新し、`retcode=10030 (Unsupported filling mode)` の反復発生を抑止する。
  - `send_market_order` / `close_opposite_positions` の初回 `type_filling` は固定 `IOC` ではなく動的選択へ切替え、fallback は fail-closed のまま維持する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.40 live loop多重起動是正（2026-02-27）**:
  - Windows 側で重複起動していた `xau_autobot_live_loop.ps1` / `xau_autobot.py --loop --live` を一括停止し、`r3u_h1` / `r2v_h1` / `alpha3_r2` の3run単独稼働へ正規化する。
  - 停止前 `15` プロセス（重複あり）から、停止後 `6` プロセス（`powershell.exe` 3 + `python.exe` 3）へ収束したことを確認。
  - 18秒後の再計測でも `count=6` を維持し、再増殖が発生しないことを確認。
  - 各runは専用 runtime journal（`..._r3u_h1.jsonl` / `..._r2v_h1.jsonl` / `..._alpha3_r2.jsonl`）で継続更新され、最新行の `run_id` 一致を確認。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.42 alpha3探索runのブロック解消（2026-02-27）**:
  - 探索run `trial_v2_20260227_alpha3_r2` の config を `session=0-23` と `atr_ratio_filter=0.0-999.0` へ緩和し、`reason=session` / `reason=volatility` 由来の常時ブロックを回避する。
  - KPI判定の正本（`primary=r3u_h1` / `secondary=r2v_h1`）は維持し、`alpha3_r2` は探索専用として運用する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.43 monitor-only再同期（2026-02-27 20:32 JST）**:
  - `r3u_h1 / r2v_h1 / alpha3_r2` を run専用 runtime journal 指定で再評価し、`trial_valid=true` を3runで確認（`verdict=NO_GO`）。
  - 実測:
    - `r3u_h1`: `window_days=0.4898`, `closed_positions=2`, `PF=1.3322`, `WR=0.50`, `net_profit=+395`
    - `r2v_h1`: `window_days=0.4759`, `closed_positions=21`, `PF=1.2352`, `WR=0.4762`, `net_profit=+1342`
    - `alpha3_r2`: `window_days=0.4553`, `closed_positions=2`, `PF=1.3558`, `WR=0.50`, `net_profit=+497`
  - `v50_8_dual_run_status_20260226.json` / `v50_8_dual_run_status_20260227.json` / `v50_8_monitor_only_status_20260227.json` / `v50_8_monthly_decision_20260225.json` を再同期し、月次判定を `trial_invalid` から `failed_window_days + failed_closed_positions` 主体へ更新。
  - `execution_path_blocked=false` を反映し、`Disk error` は「継続ブロッカー」ではなく解消済みインシデントとして扱う。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.44 live_loop単一インスタンス契約（2026-02-27）**:
  - root cause: `xau_autobot_live_loop.ps1` が外部再起動トリガーと重なった際、同一 config の `python --loop --live` が多重起動し、runtime journal と judge 集計が混線する。
  - 契約:
    - `tools/windows/xau_autobot_live_loop.ps1` は config 単位の lock を取得し、既存インスタンスがある場合は fail-closed で重複起動を拒否する。
    - lock はプロセス寿命に追随し、正常終了/異常終了いずれでも解放を試行する。
  - 目的:
    - 手動停止に依存せず `3run=3python` の単独稼働を維持し、`runtime_metrics` 分母の再現性を担保する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.46 MT5 authorization blocked 監視継続（2026-02-27 20:58 JST）**:
  - `r3u_h1/r2v_h1/alpha3_r2` の再起動を試行したが、Windows Python で `mt5.initialize() failed: (-6, 'Terminal: Authorization failed')` を再現。
  - 影響:
    - live loop は起動直後に終了し、`xau_autobot_runtime_journal_trial_v2_20260227_*.jsonl` の更新は `2026-02-27 20:29 JST` で停止。
    - `xau_autobot_live_report_trial_v2_20260227_*.json` の最新更新は `2026-02-27 20:31 JST`。
  - 対応:
    - 監査は最新既存成果物から再集計し、`xau_autobot_operational_audit_*_authblocked.json` / `xau_autobot_trial_judge_*_authblocked.json` / `v50_8_run_refresh_20260227_1158_authblocked.json` を生成。
    - 判定は3runとも `trial_valid=true`, `verdict=NO_GO`（主因 `window_days<14`、一部 `closed_positions<12`）を維持。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.47 MT5認証の部分復旧（2026-02-27 21:05 JST）**:
  - `terminal64.exe` 明示起動後、Windows Python 単体プローブで `mt5.initialize() -> ok=True`（`last_error=(1, 'Success')`）を確認。
  - `r3u_h1/r2v_h1` は live loop 再開を確認し、runtime journal が `21:01 JST` 以降に更新再開。
  - 最新再評価（`tools/xau_autobot_trial_v2_eval.sh`）:
    - `r3u_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.5132`, `closed=2`, `PF=1.3322`, `net=+395`
    - `r2v_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.4993`, `closed=22`, `PF=1.1172`, `net=+739`
  - alpha探索runは `alpha3_r2` ではなく `alpha3_r3a` が実稼働（`runtime_journal_trial_v2_20260227_alpha3_r3a.jsonl` 更新）。`alpha3_r3a` は `invalid_reasons={after_magic_filter, after_comment_prefix_filter}` で `INVALID_TRIAL`。
  - 集約成果物: `v50_8_run_refresh_20260227_1205.json`
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.48 monitor-only再同期 #13（2026-02-27 21:09 JST）**:
  - 実稼働3run（`r3u_h1/r2v_h1/alpha3_r3a`）を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` + run専用 runtime journal で再評価し、`xau_autobot_trial_judge_*` を再生成。
  - `xau_autobot_trial_v2_current_run_r3.json` の探索run正本を `trial_v2_20260227_alpha3_r3a` へ統一し、`alpha3_r2` は履歴runとして扱う。
  - `v50_8_trial_judge_*` / `v50_8_dual_run_status_20260226.json` / `v50_8_dual_run_status_20260227.json` / `v50_8_parallel3_status_20260227.json` / `v50_8_monitor_only_status_20260227.json` / `v50_8_monthly_decision_20260225.json` / `v50_8_run_refresh_20260227_1207_live_running.json` を再同期。
  - 最新実測:
    - `r3u_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.5149198039120371`, `closed_positions=2`, `PF=1.3322`, `net_profit=+395`
    - `r2v_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.5010194001273148`, `closed_positions=22`, `PF=1.1172`, `net_profit=+739`
    - `alpha3_r3a`: `trial_valid=false`, `verdict=INVALID_TRIAL`, `window_days=0.010602790092592592`, `invalid_reasons={after_magic_filter, after_comment_prefix_filter}`
  - 月次判定は `decision=NO_GO` を維持（`reason_codes={failed_window_days, failed_closed_positions, actual_monthly_below_target}`）。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.49 monitor-only再同期 #16（2026-02-27 22:16 JST）**:
  - 実稼働3run（`r3u_h1/r2v_h1/alpha3_r3a`）を run専用 runtime journal で再評価し、judge/live/audit を再同期。
  - 更新成果物:
    - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r3u_h1.json`
    - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r2v_h1.json`
    - `v50_8_trial_judge_trial_v2_20260227_alpha3_r3a.json`
    - `v50_8_dual_run_status_20260226.json`
    - `v50_8_dual_run_status_20260227.json`
    - `v50_8_parallel3_status_20260227.json`
    - `v50_8_monitor_only_status_20260227.json`
    - `v50_8_monthly_decision_20260225.json`
    - `v50_8_run_refresh_20260227_2215.json`
  - 最新実測:
    - `r3u_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.562277269525463`, `closed_positions=3`, `PF=0.6481`, `net_profit=-860`
    - `r2v_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.548376937337963`, `closed_positions=23`, `PF=1.0182`, `net_profit=+126`
    - `alpha3_r3a`: `trial_valid=false`, `verdict=INVALID_TRIAL`, `window_days=0.05796034162037037`, `closed_positions=0`
  - 月次判定は `NO_GO` を維持し、`reason_codes` は `failed_window_days/failed_closed_positions/failed_profit_factor/failed_win_rate/failed_net_profit/actual_monthly_below_target` へ更新。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.50 monitor-only再同期 #17（2026-02-27 22:22 JST）**:
  - 3run（`r3u_h1/r2v_h1/alpha3_r3a`）を run専用 runtime journal で再評価し、監査 `refresh8` と集約成果物を再生成。
  - 更新成果物:
    - `xau_autobot_operational_audit_20260227_r3u_h1_refresh8.json`
    - `xau_autobot_operational_audit_20260227_r2v_h1_refresh8.json`
    - `xau_autobot_operational_audit_20260227_alpha3_r3a_refresh8.json`
    - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r3u_h1.json`
    - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r2v_h1.json`
    - `v50_8_trial_judge_trial_v2_20260227_alpha3_r3a.json`
    - `v50_8_dual_run_status_20260226.json`
    - `v50_8_dual_run_status_20260227.json`
    - `v50_8_parallel3_status_20260227.json`
    - `v50_8_monitor_only_status_20260227.json`
    - `v50_8_monthly_decision_20260225.json`
    - `v50_8_run_refresh_20260227_2221.json`
  - 最新実測:
    - `r3u_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.5662239402777778`, `closed_positions=3`, `PF=0.6481`, `net_profit=-860`
    - `r2v_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.5523237585069444`, `closed_positions=23`, `PF=1.0182`, `net_profit=+126`
    - `alpha3_r3a`: `trial_valid=false`, `verdict=INVALID_TRIAL`, `window_days=0.06190907834490741`, `closed_positions=0`
  - 月次判定は `NO_GO` 継続（`failed_window_days/failed_closed_positions/failed_profit_factor/failed_win_rate/failed_net_profit/actual_monthly_below_target`）。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.51 monitor-only再同期 #19（2026-02-27 22:41 JST）**:
  - 実稼働3run（`r3u_h1/r2v_h1/alpha3_r3a`）を run専用 runtime journal で再評価し、監査 `refresh9` と集約を再同期。
  - 更新成果物:
    - `xau_autobot_operational_audit_20260227_r3u_h1_refresh9.json`
    - `xau_autobot_operational_audit_20260227_r2v_h1_refresh9.json`
    - `xau_autobot_operational_audit_20260227_alpha3_r3a_refresh9.json`
    - `v50_8_run_refresh_20260227_2241.json`
  - 最新実測:
    - `r3u_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.5797619560300926`, `closed_positions=3`, `PF=0.6481`, `net_profit=-860`
    - `r2v_h1`: `trial_valid=true`, `verdict=NO_GO`, `window_days=0.5659113637847222`, `closed_positions=23`, `PF=1.0182`, `net_profit=+126`
    - `alpha3_r3a`: `trial_valid=false`, `verdict=INVALID_TRIAL`, `window_days=0.07554202921296296`, `closed_positions=0`
  - 監査（3日窓）:
    - `r3u_h1`: `status=FAIL`, `gap_reject_rate=0.01053740779768177`, `tp_sl_ratio=0.5`, `expectancy=-286.6667`
    - `r2v_h1`: `status=WARN`, `gap_reject_rate=0.010626992561105207`, `tp_sl_ratio=0.7692307692307693`, `expectancy=5.4783`
    - `alpha3_r3a`: `status=FAIL`, `runtime_metrics_source=live_report.runtime_metrics`, `runtime_metrics_fallback_reason=journal_snapshot_count_zero`
  - 月次判定は `NO_GO` 継続（`failed_window_days/failed_closed_positions/failed_profit_factor/failed_win_rate/failed_net_profit/actual_monthly_below_target`）。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.52 live単独運用への縮退契約（2026-02-27）**:
  - 目的: 直近実測で `r3u_h1` の性能劣化（`PF<1.0` かつ `net<0`）が継続したため、同時稼働リスクを下げる。
  - 契約:
    - live稼働は `trial_v2_20260227_v50_8_30d_r2v_h1` を正本runとする。
    - `trial_v2_20260227_v50_8_30d_r3u_h1` と `trial_v2_20260227_alpha3_r3a` は live loop 停止（必要時のみ手動再開）。
    - `data/reports/xau_autobot_trial_v2_current_run.json` は `r2v_h1` を指す。
  - 判定系:
    - `r2v_h1` の trial/judge は継続するが、`monthly_decision` 判定基準（3%/5%、min_days/min_pf等）は変更しない。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.53 live loop self-heal 契約（2026-02-27）**:
  - 目的: Windows 側 `xau_autobot_live_loop.ps1 -Live` の欠落/多重を手動介入なしで収束させ、実行基盤の再現性を維持する。
  - 契約:
    - `tools/xau_autobot_live_loop_guard.py` を正本化し、期待run集合を run meta（既定 `xau_autobot_trial_v2_current_run.json` / `..._r2.json`、`..._r3.json` は `--include-r3` または `XAU_AUTOBOT_LIVE_GUARD_INCLUDE_R3=1` 時のみ）から解決する。
    - 期待集合は `trial_config` 単位で正規化し、Windows の `powershell.exe ... xau_autobot_live_loop.ps1 ... -Live` 実プロセスを `config` ごとに照合する。
    - 欠落（0件）は `xau_autobot_live_loop.ps1 -Live` を再起動し、多重（2件以上）は先頭1件を残して余剰を停止する。
    - ガード結果は `data/reports/xau_autobot_live_loop_guard_latest.json` に保存し、`missing/duplicate/restarted/terminated` を可観測化する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.54 探索枠再開契約（2026-02-27）**:
  - ユーザー指示により探索枠を再開し、`alpha3` 系は `r3a` から `r3b` へ切替える。
  - 正本判定runは `r2v_h1` のまま維持し、探索枠の `trial/judge/audit` は判定正本から分離して運用する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.55 timeframe整合是正 + 広時間軸alpha探索契約（2026-02-27）**:
  - 目的:
    - `run_id` 命名と実際の `config.timeframe` の不一致（`r2v_h1` が `M5`）を是正する。
    - `H4/D1/W1/MN` と `M60/H5` を含む時間軸探索で alpha 候補を拡張する。
  - 契約:
    - 運用run命名は `config.timeframe` 実値と一致させる（不一致ラベルを正本から除去）。
    - 広時間軸探索は研究経路（`xau_autobot_optimize` / `xau_autobot_readiness`）で実施し、成果物は `data/reports` に集約する。
    - データ取得互換として `H4` は `4h` で正規化し、`240m` 直指定による provider 非対応エラーを避ける。
    - 非標準時間軸（例: `H5`）は研究評価を許容し、live投入可否は実行経路サポートと既存Go/No-Go基準で別判定する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.56 探索枠再開実施（alpha3_r3b, 2026-02-27 23:06 JST）**:
  - `current_run_r3` を `trial_v2_20260227_alpha3_r3b` へ更新し、`r2v_h1` 本線を維持したまま `alpha3_r3b` を live 再開。
  - 生成成果物:
    - `data/reports/xau_autobot_live_report_trial_v2_20260227_alpha3_r3b.json`
    - `data/reports/xau_autobot_trial_judge_trial_v2_20260227_alpha3_r3b.json`
    - `data/reports/xau_autobot_operational_audit_20260227_alpha3_r3b_refresh10.json`
    - `data/reports/xau_autobot_operational_audit_20260227_alpha3_r3b_refresh10_now1606.json`
    - `data/reports/v50_8_run_refresh_20260227_2306_r2v_alpha3r3b.json`
  - 最新実測:
    - Windows 実行系: `powershell=1`, `python=2`（`r2v_h1` + `alpha3_r3b`）
    - `alpha3_r3b` live: `closed_positions=0`, `PF=0.0`, `win_rate=0.0`, `net_profit=0.0`, `gate_check_count=2`, `gap_reject_rate=0.0`
    - judge: `trial_valid=false`, `verdict=INVALID_TRIAL`, `invalid_reasons={after_magic_filter, after_comment_prefix_filter}`, `window_days=0.002221914861111111`
    - audit:
      - `refresh10`: `status=FAIL`, `runtime_metrics_source=live_report.runtime_metrics`, `runtime_metrics_fallback_reason=journal_snapshot_count_zero`
      - `refresh10_now1606`: `status=FAIL`, `runtime_metrics_source=journal`, `snapshot_count=8`, `gate_check_count=1`
  - 判定:
    - 観測/監査成果物は再開したが、`closed_positions=0` により readiness 未成立（`INVALID_TRIAL` 継続）。
    - `runtime_metrics` timestamp と audit `now_utc` の整合ズレが残り、fallback 経路が発火し得る。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.57 変則時間足探索契約（M20/M45/H2/H3, 2026-02-27）**:
  - 目的:
    - `M5/H1` 固定探索から拡張し、`M20/M45/H2/H3` を研究経路（optimize/readiness）で比較可能にする。
  - 契約:
    - `tools/xau_autobot_data.py` の interval alias 正規化で、非provider足を下位足 resample に落として取得する。
      - `M20 -> 5m x4`
      - `M45 -> 15m x3`
      - `H2 -> 60m x2`
      - `H3 -> 60m x3`
    - `tools/xau_autobot_optimize.py` の interval->timeframe 変換は上記4足を受理し、探索configへ反映する。
    - 本契約は研究経路限定で、live投入可否は既存 Go/No-Go と実行系対応（MT5 timeframe対応）で別判定する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.58 変則時間足探索実施（M20/M45/H2/H3, 2026-02-27 UTC）**:
  - 実装:
    - `tools/xau_autobot_data.py` に `m20/m45/h2/h3`（および `20m/45m/2h/3h/120m/180m`）の alias+resample を追加。
    - `tools/xau_autobot_optimize.py` の interval->timeframe 変換と許容timeframeを `M20/M45/H2/H3` まで拡張。
  - 回帰:
    - `./.venv/bin/python -m unittest tools.tests.test_xau_autobot_data tools.tests.test_xau_autobot_optimize`
    - `19 tests OK`。
  - 生成成果物:
    - optimize: `xau_autobot_optimize_20260227_tfscan2_{m20,m45,h2,h3}_60d.jsonl`
    - readiness: `xau_autobot_readiness_20260227_tfscan2_{m20,m45,h2,h3}_cfg60_eval{45d,60d}.json`
    - 集約: `xau_autobot_alpha_scan_20260227_tfscan2_midtf.json`
  - 実測（45d/60d robust最小値）:
    - `m20`: `pf_min=1.2175`, `return_min=0.0253`, `trades_min=26`, `max_dd_max=0.0487`
    - `m45`: `pf_min=2.2377`, `return_min=0.0518`, `trades_min=10`
    - `h2`: `pf_min=1.3024`, `return_min=0.0123`, `trades_min=6`
    - `h3`: `pf_min=99.0`, `return_min=0.0477`, `trades_min=2`
  - 判定:
    - 件数フロア `trades_min>=20` では `m20` のみが信頼候補。
    - `m45/h2/h3` は高PF表示でもサンプル不足のため探索継続（live判定対象外）。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.57 広時間軸alpha探索実施（2026-02-27 UTC）**:
  - 実施:
    - `m60/h4/h5/d1/w1/month` で `xau_autobot_optimize + readiness` を実行し、`data/reports/xau_autobot_alpha_scan_20260227_tfscan.json` へ集約。
    - 上位4時間軸（`h5/d1/h4/m60`）は split 比率変更（`0.55/0.65/0.75`）の stress 再評価を実施し、`data/reports/xau_autobot_alpha_scan_20260227_tfscan_stress.json` を生成。
  - 実測:
    - 月利換算順位: `h5 (1.645%) > d1 (0.792%) > h4 (0.724%) > m60 (0.348%) > month (0.160%) > w1 (0.151%)`
    - 保守（stress込み）順位: `h4 > m60 > h5 > d1 > w1 > month`
    - `h4` は `oos_min_trades=15`・`PF=1.506`・`trades=68` で安定性が相対的に高い。
  - 判定:
    - 時間軸探索の次段は `h4` を安定重視の第一候補、`h5` をアップサイド候補として継続。
    - `w1/month` は取引件数不足で採用保留。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.58 h4/h5 広帯域再探索契約（2026-02-27 UTC）**:
  - 目的:
    - ユーザー選択（Option 3）に基づき、`h4/h5` のパラメータ探索帯を拡張して alpha 発見確率を上げる。
  - 契約:
    - 対象は研究経路（`xau_autobot_optimize` / `xau_autobot_readiness`）に限定し、live正本runは即時変更しない。
    - `h4/h5` それぞれで拡張グリッド最適化を実施し、`monthly_est` と `stress分割` を併記して比較する。
    - 採用候補は「月利上位」と「安定性上位」を分離して提示する（単一指標に固定しない）。
  - 実施:
    - 拡張グリッド（`candidate_count=6912`）で `h4/h5` を再最適化し、`optimize/readiness(base+stress)` を再生成。
    - 成果物:
      - `xau_autobot_optimize_20260227_h4h5_wide2_{h4,h5}.jsonl`
      - `xau_autobot_readiness_20260227_h4h5_wide2_{h4,h5}.json`
      - `xau_autobot_readiness_20260227_h4h5_wide2_{h4,h5}_stress.json`
      - `xau_autobot_alpha_scan_20260227_h4h5_wide2_summary.json`
  - 実測（baseline tfscan 比較）:
    - `h4`:
      - `monthly_est: 0.724% -> 1.103%`（`+0.378%`）
      - `PF: 1.506 -> 1.777`
      - `trades: 68 -> 58`
      - `merged_oos_min_trades: 15 -> 8`（安定性は悪化）
    - `h5`:
      - `monthly_est: 1.645% -> 1.654%`（`+0.009%`）
      - `PF: 3.444 -> 3.472`
      - `trades: 34 -> 34`（同等）
      - `merged_oos_min_trades: 6 -> 6`（同等）
  - 判定:
    - `h5` はアップサイド指標で微改善。
    - `h4` は月利/PF改善と引き換えに OOS 最小取引数が悪化し、安定性は後退。
    - live 正本は据え置き、`h4=安定系(旧候補保持)` と `h5=上振れ探索(新候補)` を分離運用する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.59 trial_eval live loop guard 接続実装（2026-02-27）**:
  - 目的:
    - `P5.53` の self-heal guard を日次評価フローへ接続し、`trial_v2_eval` 実行時に live-loop 欠落/多重を自動収束させる。
  - 実装:
    - `tools/xau_autobot_trial_v2_eval.sh` に `run_live_loop_guard_once()` を追加し、live report 前に `tools/xau_autobot_live_loop_guard.py` を実行する。
    - 既定は `enabled`（`XAU_AUTOBOT_TRIAL_LIVE_LOOP_GUARD_ENABLED=1`）で、`=0` で明示停止できる。
    - `XAU_AUTOBOT_TRIAL_LIVE_LOOP_GUARD_INCLUDE_R3=1` のときのみ `--include-r3` を付与する。
    - guard失敗時の既定は fail-open（`WARN + 評価継続`）とし、`XAU_AUTOBOT_TRIAL_LIVE_LOOP_GUARD_FAIL_ON_ERROR=1` 時のみ fail-closed とする。
  - 回帰:
    - `./.venv/bin/python -m pytest -q tools/tests/test_xau_autobot_trial_v2_eval.py -k live_loop_guard` -> `3 passed`
    - `./.venv/bin/python -m pytest -q tools/tests/test_xau_autobot_trial_v2_eval.py` -> `11 passed`
    - `./.venv/bin/python -m unittest tools.tests.test_xau_autobot_live_loop_guard tools.tests.test_xau_autobot_trial_watchdog` -> `10 tests OK`
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.60 3案同時実行契約（2026-02-27 UTC）**:
  - 目的:
    - ユーザー指示「ぜんぶやって」に基づき、以下を同時実行する。
      - A: `h5_wide2` を exploration run へ投入
      - B: `h4(旧安定候補)` と `h5_wide2` の並走
      - C: `h4 strict (min OOS trades=45)` の再探索
  - 契約:
    - live 構成は `primary + secondary + r3` の3runを正本とし、`r2` に `h4安定`、`r3` に `h5_wide2` を割り当てる。
    - run混線防止のため `magic/comment` を分離した trial config を新規作成する。
    - `xau_autobot_live_loop_guard.py --include-r3` で process 収束（欠落再起動/多重停止）を実施する。
    - `h4 strict` は研究経路で評価し、live正本切替は `trial/judge` の成立後に別判定とする。
  - 実施:
    - trial config追加:
      - `xau_autobot.trial_v2_20260227_h4_stable_tfscan.json`（`magic=560422`, `comment=xh4stb_260227a`）
      - `xau_autobot.trial_v2_20260227_h5_wide2_exp.json`（`magic=560423`, `comment=xh5w2_260227a`）
    - run meta更新:
      - `xau_autobot_trial_v2_current_run_r2.json` -> `trial_v2_20260227_h4_stable_tfscan`
      - `xau_autobot_trial_v2_current_run_r3.json` -> `trial_v2_20260227_h5_wide2_exp`
    - `xau_autobot_live_loop_guard.py --include-r3` で収束し、`expected_config_counts_post` が `primary/r2/r3 = 1/1/1` を確認。
    - Option3 として `h4 strict (min-oos-trades=45)` を実行し、`xau_autobot_optimize_20260227_h4_strict45.jsonl` / `xau_autobot_readiness_20260227_h4_strict45*.json` を生成。
  - 実測:
    - `primary (trial_v2_20260227_v50_8_30d_r2v_m5)`:
      - judge: `NO_GO`, `trial_valid=true`, `window_days=1.1201`, `closed=38`, `PF=0.5053`, `net=-10185`
      - audit: `status=FAIL`
    - `r2 (trial_v2_20260227_h4_stable_tfscan)`:
      - judge: `INVALID_TRIAL`, `trial_valid=false`, `window_days=0.001185`, `closed=0`
      - audit: `status=INSUFFICIENT_DATA`
    - `r3 (trial_v2_20260227_h5_wide2_exp)`:
      - judge: `INVALID_TRIAL`, `trial_valid=false`, `window_days=0.001232`, `closed=0`
      - audit: `status=INSUFFICIENT_DATA`
    - `h4 strict45`（研究評価）:
      - `monthly_est=1.049%`, `PF=1.973`, `trades=46`, `oos_min_trades=9`
      - baseline h4 대비 `monthly/PF` は改善するが `oos_min_trades` は `15 -> 9` へ悪化。
    - `h5_wide2` live投入試行:
      - `r3=h5_wide2_exp` は `live_loop_guard --dry-run` で継続的に `DEGRADED`（`h5` loop 欠落）を検知。
      - 現行 live 実行経路では `H5` が未対応のため、`h5` は research-only として保持。
      - fail-closed 対応として `r3` を `h4_strict45_exp` へ切替え、`primary/r2/r3=1/1/1` の `HEALTHY` 収束を確認。
  - 判定:
    - 3案の実行は完了。
    - ただし `r2/r3` は開始直後で sample 不足、`primary` も `NO_GO` のため live 切替判定は保留。
    - `h4 strict45` は PF 改善効果はあるがサンプル厚み不足を解消できず、研究候補として保持。
    - `h5` は現行では research-only（live投入は実行経路拡張後に再判定）。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.61 M20本線化に向けたlive timeframe拡張契約（2026-02-28 UTC）**:
  - 背景:
    - `r2v_m5` は `PF/WR/net` が悪化し、監査 `status=FAIL` が継続している。
    - `tfscan2_midtf` の信頼フロア（`trades_min>=20`）で候補成立するのは `m20` のみ。
  - 契約:
    - `tools/xau_autobot.py` の live実行経路で `timeframe=M20` を受理し、MT5 `TIMEFRAME_M20` へマップ可能にする。
    - 未知timeframe、または runtime MT5 パッケージが該当 `TIMEFRAME_*` 定数を持たない場合は `ValueError` で fail-closed 維持。
    - 既存受理足（`M1/M5/M15/M30/H1/H4`）の挙動は後方互換を維持する。
  - `INTERFACES.md` 更新あり（xau_autobot live timeframe受理契約 / optimize mapping 契約の明文化）。
- **V50.8-P5.62 M20 live実行対応 + E1中庸config作成（2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot.py` の `_tf_to_mt5()` を拡張し、`M20` を `TIMEFRAME_M20` へマップ。
    - `timeframe -> TIMEFRAME_*` 変換を属性名ベースに変更し、runtimeで該当定数が欠損している場合も `ValueError("unsupported timeframe: ...")` で fail-closed を維持。
  - 回帰（TDD）:
    - 追加テスト: `tools/tests/test_xau_autobot.py::TestXauAutoBotTimeframeMapping`
      - `M20` 受理
      - 未知足（`M45`）拒否
      - `TIMEFRAME_M20` 欠損時 fail-closed
    - 検証:
      - `./.venv/bin/python -m pytest -q tools/tests/test_xau_autobot.py -k "tf_to_mt5 or TimeframeMapping"` -> `3 passed`
      - `./.venv/bin/python -m pytest -q tools/tests/test_xau_autobot.py` -> `57 passed`
  - E1中庸config:
    - `tools/configs/xau_autobot.trial_v2_20260228_v50_8_14d_r2v_m20_e1.json` を追加（`timeframe=M20`, `session=06-22`, `atr_ratio=0.85-1.55`, `ema_gap=0.12-1.8`, `pullback=0.25`, `sl/tp=1.7/2.6`, `hybrid`）。
  - 事前検証（readiness）:
    - `data/reports/xau_autobot_readiness_20260228_r2v_m20_e1_eval45d.json`
      - `verdict=NO_GO`, `trades=121`, `PF=0.8680`, `return=-3.47%`, `max_dd=6.38%`
    - `data/reports/xau_autobot_readiness_20260228_r2v_m20_e1_eval60d.json`
      - `verdict=NO_GO`, `trades=148`, `PF=0.7729`, `return=-7.11%`, `max_dd=8.58%`
  - 判定:
    - M20 live実行そのものは技術的に可能になったが、今回の「中庸固定値」は過去45/60dでは優位性不足。
    - 本線切替は `paper forward` で 3d/7d gate を確認してから判定する。
- **V50.8-P5.63 M5停止 + M20(E1) 14日forward開始契約（2026-02-28 UTC）**:
  - 目的:
    - 本線を `r2v_m5` から `r2v_m20_e1` へ切替え、14日 forward 観測を開始する。
  - 契約:
    - primary run meta（`xau_autobot_trial_v2_current_run.json` / `..._r1.json`）は `trial_v2_20260228_v50_8_14d_r2v_m20_e1` を正本とする。
    - 既存 `r2v_m5` live loop は停止し、primary の重複起動を残さない。
    - `trial_v2_start.sh` で `trial_live=1` を維持したまま、config は `xau_autobot.trial_v2_20260228_v50_8_14d_r2v_m20_e1.json` を使用する。
    - 切替直後の評価は `INVALID_TRIAL` を許容し、3日観測（Observability/Readiness）を優先する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.64 M20 primary cutover実施（2026-02-28 UTC）**:
  - 実施:
    - `r2v_m5` primary live loop を停止し、`trial_v2_start.sh` で `trial_v2_20260228_v50_8_14d_r2v_m20_e1` を primary 起動。
    - run meta を同期:
      - `data/reports/xau_autobot_trial_v2_current_run.json`
      - `data/reports/xau_autobot_trial_v2_current_run_r1.json`
    - 初期評価を生成:
      - `data/reports/xau_autobot_live_report_trial_v2_20260228_v50_8_14d_r2v_m20_e1.json`
      - `data/reports/xau_autobot_trial_judge_trial_v2_20260228_v50_8_14d_r2v_m20_e1.json`
      - `data/reports/xau_autobot_operational_audit_20260228_r2v_m20_e1_refresh1_now0355.json`
      - mirror: `data/reports/v50_8_trial_judge_trial_v2_20260228_v50_8_14d_r2v_m20_e1.json`
      - cutover refresh: `data/reports/v50_8_run_refresh_20260228_0358_r2v_m20_cutover.json`
  - 実測:
    - process: `m20_primary_config=1`, `legacy_m5_primary_config=0`
    - judge: `verdict=INVALID_TRIAL`, `window_days=0.0006450487731481481`, `closed_positions=0`
    - audit: `status=INSUFFICIENT_DATA`, `runtime_snapshot_count=6`, `runtime_metrics_source=journal`
  - 判定:
    - `M5 -> M20` の primary 切替は完了。
    - 現時点は開始直後で観測不足のため、3日 gate（observability/readiness）まで継続観測とする。
- **V50.8-P5.65 案A research-only正本化（M45/H2/H5/H3, 2026-02-28 UTC）**:
  - 正本パラメータ:
    - `CANONICAL_PLAN = A`
    - `ENTRY_ORDER = M45 -> H2 -> H5 -> H3`
    - `LIVE_ACCEPT_TF = [M1,M5,M15,M20,M30,H1,H4]`
    - `RESEARCH_ACCEPT_TF = [M45,H2,H3,H5]`
    - `PER_STRATEGY_JUDGE_MODE = rolling_45d (M45/H2), rolling_60d (H3/H5)`
    - `PORTFOLIO_KPI_MODE = monthly_only (月利3%/5%)`
    - `RISK_INTERFACE = portfolio同時保有上限2`
  - 研究運用契約:
    - `M45/H2/H3/H5` は optimize/readiness + judge/audit の research 経路で比較し、live 実行経路へは投入しない。
    - `tools/xau_autobot.py` は live mode で `M45/H2/H3/H5` を fail-closed 拒否し、誤投入を防止する。
  - PROMOTION_GATE（option2 着手条件）:
    - `M45/H2` が rolling window で `PF>=1.20` かつ `net>0` かつ `DD<=7%` を満たし、
      `closed>=8 (M45)` / `closed>=6 (H2)` を達成した場合のみ live拡張検討へ進む。
  - INTERFACES 更新あり（`xau_autobot.py` mode/timeframe 契約、`trial_judge` rolling mode、`operational_audit` profile 契約）。
- **V50.8-P5.66 research観測欠損是正（2026-02-28 UTC）**:
  - 目的:
    - research batch で `audit=INSUFFICIENT_DATA` が頻発する原因（`gap_reject_rate` 欠損）を解消し、Plan A の rolling 判定を再現性ある形で監査可能にする。
  - 契約:
    - research 実行は runtime journal 出力を既定 ON とし、最低限 `signal_eval_count/gap_reject_count/spread_reject_count/session_reject_count/maxpos_reject_count` を記録する。
    - `gap_reject_rate` は `gap_reject_count / signal_eval_count` を正本分母として扱う（旧 schema は `gate_check_count` 互換を維持）。
    - 非標準TF（特に `M45/H5`）の再集約は `RESAMPLE_ANCHOR=UTC_00:00`, `RESAMPLE_OFFSET_MINUTES=0` を正本契約として固定する。
  - 期待効果:
    - 研究結果の `gap_reject_rate` がN/A化せず、同一configの環境差（バー境界差）による再現不能リスクを抑制する。
  - INTERFACES 更新あり（`xau_autobot_data.py` resample anchor 契約、`xau_autobot_readiness.py` runtime journal 契約、`trial_v2_eval` effective 判定出力）。
- **V50.8-P5.67 M45/H2 収益実用バッチ契約（2026-02-28 UTC）**:
  - 目的:
    - 「観測できる研究」から「稼ぐ検証」へ移行し、`M45 v1/v1.1` と `H2 v1/v2` の実用性を `180d` で比較する。
  - 契約:
    - 比較対象4本を同一データ条件（`ticker=GC=F`, `period=180d`, `assumed_cost_side=0.0002`）で同時実行する。
    - 判定窓は `rolling_45d` を 5窓（スライド）で評価し、各窓 `PF/closed/maxDD/net` を記録、採用判定は `min PF` を主指標にする。
    - `H2 v2` の reversion 絞り込みは research-only 契約として `reversion_max_atr_ratio_to_median` と `reversion_max_ema_gap_over_atr` を追加し、hybrid の reversion 発火を条件付き許可にする。
  - INTERFACES 更新あり（`xau_autobot_readiness.py` research-only hybrid reversion guard 契約）。
- **V50.8-P5.68 M45/H2 比較バッチ実施（2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot_readiness.py` に research-only hybrid reversion guard 実装（`reversion_max_atr_ratio_to_median`, `reversion_max_ema_gap_over_atr`）。
    - 新規 config:
      - `tools/configs/xau_autobot.trial_v2_20260228_m45_trendcore_v1_1.json`
      - `tools/configs/xau_autobot.trial_v2_20260228_h2_hybrid_v2.json`
  - 回帰:
    - `pytest`（xau_autobot 系主要8ファイル）で `139 passed`。
  - 比較実行:
    - `180d` 比較結果: `data/reports/xau_autobot_research_summary_20260228_profit_batch_180d_m45h2_compare_v2.json`
    - `60d` 比較結果: `data/reports/xau_autobot_research_summary_20260228_profit_batch_60d_m45h2_compare_v2.json`
    - `60d trailing` 比較結果: `data/reports/xau_autobot_research_summary_20260228_profit_batch_60d_m45h2_compare_trailing_v2.json`
  - 実測:
    - `180d` は provider 制約で `M45(15m)` が実データ `bars=77, coverage_days=2.594` に縮退し、`m45_pair` は `no_active_windows`（比較不能）。
    - `180d` の `H2` は成立し、`min_pf_active` 基準で `h2_v2` が `h2_v1` を上回る（`h2_v2=1.9994`、`h2_v1=0.0`）。
    - `60d trailing` では `m45_v1_1` が `m45_v1` を上回る（`min_pf_active=3.4798`、`active_window_count=5`）一方、`gap_reject_rate=0.8165` で目標 `<=0.70` は未達、`min_closed_active=3` で件数目標も未達。
    - `60d trailing` の `H2` は `h2_v2` が `h2_v1` を上回る（`min_pf_active=1.4975` vs `0.9230`、`gap_reject_rate=0.6242` vs `0.7974`）が、`min_closed_active=4` で件数目標（`>=10`）は未達。
  - 判定:
    - `M45/H2` の「180d rolling 4-5窓同時比較」は、現データ供給（Yahoo intraday）では `M45` が成立しないため、データソース拡張（MT5/export等）なしでは完遂不可。
- **V50.8-P5.69 MT5 M15 long-source再評価契約（2026-02-28 UTC）**:
  - 目的:
    - `M45` の `180d rolling_45d` を成立させるため、research データソースを Yahoo から MT5/export 由来の `M15` 長期ソースへ切替える。
  - 契約:
    - `xau_autobot_data.py` は research 用に `data_source=mt5_csv` を受理し、`period` 末尾窓を切り出して評価に使用する。
    - 入力CSVは `timestamp,open,high,low,close`（追加列は無視）を受理し、非標準TFは既存契約 `RESAMPLE_ANCHOR=UTC_00:00` / `RESAMPLE_OFFSET_MINUTES=0` で再集約する。
    - `optimize/readiness` は `--data-source mt5_csv --source-csv <path>` を受理し、`source-csv` 未指定時は fail-closed とする。
  - 実行ターゲット:
    - `M45 v1/v1.1/v1.2` と `H2 v2` を同一データ（XAUUSD, M15, 240d/365d）で rolling 評価し、`min PF(active)` と全窓条件で採用判定する。
  - INTERFACES 更新あり（`xau_autobot_data.py`, `xau_autobot_optimize.py`, `xau_autobot_readiness.py` の data-source 契約）。
- **V50.8-P5.70 MT5 M15 long-source実施（2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot_data.py` に research専用 `data_source=mt5_csv` を追加。
      - `source_csv_path` から `timestamp,open,high,low,close` を読込（追加列は無視）。
      - `period` 末尾窓で切り出し後、既存 `UTC_00:00` アンカー契約で `M45/H2/H3/H5` 再集約を継続。
    - `tools/xau_autobot_optimize.py` / `tools/xau_autobot_readiness.py` に
      `--data-source {auto,yahoo,mt5_csv}` / `--source-csv` を追加（`mt5_csv` で未指定時 fail-closed）。
    - 比較用 config を追加:
      - `tools/configs/xau_autobot.trial_v2_20260228_m45_trendcore_v1_2.json`
  - データ取得:
    - Windows MT5 から `XAUUSD M15` を `365d` export し、
      `data/historical/XAUUSD_M15_mt5_365d.csv`（`rows=23519`）を生成。
    - 範囲: `2025-02-28T07:15:00Z` ～ `2026-02-27T23:45:00Z`。
  - 回帰:
    - `pytest`（xau_autobot系主要8ファイル）で `144 passed`。
  - 比較実行:
    - `data/reports/xau_autobot_research_summary_20260228_profit_batch_mt5_m15_365d_m45h2_compare_v3.json`
    - `data/reports/xau_autobot_research_summary_20260228_profit_batch_mt5_m15_365d_m45h2_compare_v3.tsv`
  - 実測（rolling 45d, trailing 5窓）:
    - `m45_group` 勝者: `m45_v1_1`（`min_pf_active=1.1185`, `active_windows=5`）。
    - `h2_group` 勝者: `h2_v1`（`min_pf_active=1.1559`, `active_windows=5`）。
      - `h2_v2` は全体PF/損益は改善（`overall_pf=1.2259`, `net=+4593`）だが、
        1窓で `pf=0` が発生し `min_pf_active` 基準では敗北。
  - 判定:
    - MT5 long-source への切替で `M45 180d/365d` 比較不能問題（Yahoo 15m制約）は解消。
    - live 経路契約（research-only TF 拒否）は変更なし。
- **V50.8-P5.71 cost-sweep判定（M45 v1.1 / H2 v1, 2026-02-28 UTC）**:
  - 目的:
    - 採用候補を `M45 v1.1 + H2 v1` に固定し、`assumed_cost_side=0.0002/0.0003/0.0004` で rolling 耐性を確認する。
  - 実施:
    - 全窓（1日スライド）評価:
      - `data/reports/xau_autobot_research_summary_20260228_costsweep_mt5_m15_365d_m45v11_h2v1.json`
      - `data/reports/xau_autobot_research_summary_20260228_costsweep_mt5_m15_365d_m45v11_h2v1.tsv`
    - trailing 5窓（45d window / 30d step）評価:
      - `data/reports/xau_autobot_research_summary_20260228_costsweep_mt5_m15_365d_m45v11_h2v1_trailing5.json`
      - `data/reports/xau_autobot_research_summary_20260228_costsweep_mt5_m15_365d_m45v11_h2v1_trailing5.tsv`
    - 判定条件:
      - 各45d窓で `closed>=6` / `PF>=1.10` / `maxDD<=7%`（`closed<6` は inactive ではなく FAIL）。
  - 実測（要点）:
    - 全窓（1日スライド, 320窓）:
      - `M45 v1.1`: `fail_closed_count=78`, `fail_pf_count=153..184`（cost増で悪化）, `fail_dd_count=0`
      - `H2 v1`: `fail_closed_count=68`, `fail_pf_count=173..210`（cost増で悪化）, `fail_dd_count=0`
    - trailing 5窓:
      - `M45 v1.1`: `fail_closed_count=2`（`worst_closed=2`）, `0.0003` 以上で `fail_pf_count=1`
      - `H2 v1`: `fail_closed_count=2`（`worst_closed=4`）, `0.0003` 以上で `fail_pf_count=1`
  - 判定:
    - `closed>=6` を全窓必須にすると、現状 `M45 v1.1/H2 v1` はいずれも FAIL（主因は low-frequency による窓内件数不足）。
    - DD は両戦略とも閾値内で安定しており、ボトルネックは `closed` と `PF` の窓耐性。
- **V50.8-P5.72 E0/E1 実行評価（M15 executor + M45 filter, 2026-02-28 UTC）**:
  - 目的:
    - `M45/H2` 単体運用ではなく、`M15` を執行エンジン、`M45 v1.1` を bias フィルタとして使う構成（E1）が実運用判定を満たすかを確認する。
  - 実装:
    - 追加 config:
      - `tools/configs/xau_autobot.trial_v2_20260228_m15_executor_v1.json`
    - 比較:
      - `E0`: `M15 executor v1`（フィルタなし）
      - `E1`: `M15 executor v1 + M45 v1.1 bias filter`（`LONG/SHORT` 同方向のみ許可、`NEUTRAL` は no-trade）
  - 判定条件:
    - `rolling_30d`（1日スライド, 全窓）
    - 各窓 `closed>=12`, `PF>=1.10`, `maxDD<=7%`
    - cost sweep: `assumed_cost_side=0.0002/0.0003/0.0004`
  - 成果物:
    - `data/reports/xau_autobot_research_summary_20260228_m15_e0e1_m45filter_costsweep_rolling30d.json`
    - `data/reports/xau_autobot_research_summary_20260228_m15_e0e1_m45filter_costsweep_rolling30d.tsv`
  - 実測（335窓）:
    - `E0`:
      - `cost=0.0002`: `pass_window_count=0`, `fail_pf_count=335`, `fail_dd_count=96`
      - `cost=0.0003`: `pass_window_count=0`, `fail_pf_count=335`, `fail_dd_count=242`
      - `cost=0.0004`: `pass_window_count=0`, `fail_pf_count=335`, `fail_dd_count=309`
    - `E1`:
      - `cost=0.0002`: `pass_window_count=9`, `fail_closed_count=16`, `fail_pf_count=319`, `fail_dd_count=0`
      - `cost=0.0003`: `pass_window_count=4`, `fail_closed_count=16`, `fail_pf_count=324`, `fail_dd_count=0`
      - `cost=0.0004`: `pass_window_count=2`, `fail_closed_count=16`, `fail_pf_count=330`, `fail_dd_count=0`
  - 判定:
    - `E1` は `E0` 比で DD を大幅に抑制したが、PFと窓内件数フロアを全窓で満たせず、現設定では `NO_GO`。
    - `E0` は回転は十分だが PF/DD が崩壊しており、現設定のまま live 接続不可。
- **V50.8-P5.73 Regime-Switch Executor 実装契約（2026-02-28 UTC）**:
  - 背景:
    - `E0(M15)` は相場状態選別が弱く、`E1(+M45 filter)` は DD 改善はあるが期待値不足。
  - 契約:
    - `M45 v1.1` を単純フィルタではなく「モード切替司令塔」として扱う。
    - 執行は `M5`（live受理TF）で、`TREND/REVERSION` を別モードとして分離する。
    - 切替は hysteresis:
      - `regime_strength >= 2.35 -> TREND`
      - `regime_strength <= 2.05 -> REVERSION`
      - それ以外は前モード維持。
    - `TREND` は `M45 bias` 同方向のみ許可。
    - `REVERSION` は trend bias 強制なし（mode gate でトレンド相場の逆張りを回避）。
  - 評価契約:
    - `rolling_30d`, `step=1d`, 主戦場 `cost_side=0.0003`（必要に応じ `0.0002/0.0004` 併走）。
    - 各窓 `closed>=12`, `PF>=1.10`, `maxDD<=7%` を pass 条件とする。
  - INTERFACES 更新あり（`xau_autobot_regime_switch_eval.py` と regime-switch config 契約）。
- **V50.8-P5.74 M20 executor + M45 soft gate 比較契約（2026-02-28 UTC）**:
  - 背景:
    - `M5 regime-switch` は DD 改善を示したが、`pass_window_count` と `worst_pf` が悪化し、月利向けの期待値を維持できない。
  - 契約:
    - 評価対象を `M20` へ戻し、2本比較で固定する。
      - `E3`: `M20 executor` 単体（trend, reversion OFF）
      - `E4`: `M20 executor + M45 bias gate`（逆方向のみ禁止）
    - gate は hard-lock ではなく soft gate を正本にする。
      - `bias=LONG -> short 禁止`
      - `bias=SHORT -> long 禁止`
      - `bias=NEUTRAL -> 制限なし`
    - 評価は `rolling_30d`, `step=1d`, 主戦場 `cost_side=0.0003` を維持。
    - pass 条件は従来どおり各窓 `closed>=12`, `PF>=1.10`, `maxDD<=7%`。
  - 観測契約（追加）:
    - evaluator 出力に `mode_time_share`, `trade_count_by_mode`, `pf_by_mode`, `reject_reason_breakdown` を含める。
  - INTERFACES 更新あり（`xau_autobot_m20_bias_gate_eval.py` と M20 config 契約）。
- **V50.8-P5.75 E3/E4 実装・評価（M20 baseline vs M45 soft gate, 2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot_m20_bias_gate_eval.py` を追加し、`E3/E4` 比較を `rolling_30d` で評価可能にした。
    - 追加config:
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1.json`（E3）
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate.json`（E4, `block_opposite`）
    - 追加テスト:
      - `tools/tests/test_xau_autobot_m20_bias_gate_eval.py`
  - 実行条件:
    - `source=data/historical/XAUUSD_M1_mt5_365d.csv`
    - `period=365d`
    - `window=30d`, `step=1d`
    - `cost_side=0.0003`
    - pass条件 `closed>=12`, `PF>=1.10`, `maxDD<=7%`
  - 成果物:
    - `data/reports/xau_autobot_research_summary_20260228_e3e4_m20_m45softgate_cost0003_rolling30d.json`
    - `data/reports/xau_autobot_research_summary_20260228_e3e4_m20_m45softgate_cost0003_rolling30d.tsv`
  - 実測:
    - `E3_m20_executor`: `pass_window_count=57/335`, `fail_pf=254`, `fail_closed=28`, `worst_pf=0.1983`, `worst_closed=6`, `worst_max_dd=0.0598`
    - `E4_m20_m45_soft_gate`: `pass_window_count=67/335`, `fail_pf=242`, `fail_closed=41`, `worst_pf=0.0998`, `worst_closed=5`, `worst_max_dd=0.0558`
  - 解釈:
    - soft gate は `pass_window_count` と `fail_pf` を改善し、DDも微改善。
    - 一方で `closed` 低下と `worst_pf` 劣化が残るため、現時点では両者とも採用条件未達。
- **V50.8-P5.76 E5（confidence gate + bias flip cooldown）実装・評価（2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot_m20_bias_gate_eval.py` を拡張し、以下を追加。
      - `m45_gate_min_strength_to_block_opposite`（強トレンド時のみ gate 適用）
      - `m45_neutral_max_strength`（NEUTRAL 判定）
      - `cooldown_m20_bars_after_bias_flip`（bias flip 後のエントリー停止）
      - `neutral_min_ema_gap_over_atr`, `neutral_pullback_atr`（NEUTRAL時のみ保守化）
      - 追加診断: `gate_active_time_share`, `cooldown_block_count`
    - 追加config:
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate_e5.json`
    - 追加テスト:
      - `tools/tests/test_xau_autobot_m20_bias_gate_eval.py` に E5挙動（gate inactive bypass / bias flip cooldown / neutral mode）を追加。
  - 実行条件:
    - 比較: `E4` vs `E5`
    - `source=data/historical/XAUUSD_M1_mt5_365d.csv`
    - `period=365d`, `rolling_30d`, `step=1d`, `cost_side=0.0003`
    - pass条件 `closed>=12`, `PF>=1.10`, `maxDD<=7%`
  - 成果物:
    - `data/reports/xau_autobot_research_summary_20260228_e4e5_m20_m45confgate_cost0003_rolling30d.json`
    - `data/reports/xau_autobot_research_summary_20260228_e4e5_m20_m45confgate_cost0003_rolling30d.tsv`
  - 実測:
    - `E4_m20_m45_soft_gate`: `pass_window_count=67/335`, `worst_pf=0.0998`, `gate_active_time_share=1.0`, `cooldown_block_count=0`
    - `E5_m20_m45_conf_gate`: `pass_window_count=65/335`, `worst_pf=0.1080`, `gate_active_time_share=0.6258`, `cooldown_block_count=25`
  - 解釈:
    - E5 は `worst_pf` を小幅改善したが、`pass_window_count` が E4 を下回り、`worst_max_dd` も悪化。
    - 停止条件（`pass_window_count < E4`）に該当し、E5は現時点 `NO_GO`。
- **V50.8-P5.77 E6（SL後 loss cooldown）実装・評価（2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot_m20_bias_gate_eval.py` を拡張し、`after_loss_cooldown_m20_bars` を追加。
      - canonical: `SL` クローズ時のみ cooldown 発火（`TP`/反転クローズでは非発火）。
      - cooldown 中は新規エントリーを全面停止（long/short）。
    - 追加診断:
      - `loss_cooldown_trigger_count`
      - `loss_cooldown_block_count`
      - `loss_cooldown_block_bars_total`
      - `loss_cooldown_block_time_share`
      - `loss_streak_p95`
    - 追加config:
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate_e6.json`
    - 追加テスト:
      - `tools/tests/test_xau_autobot_m20_bias_gate_eval.py` に loss cooldown 判定/連敗統計テストを追加。
  - 実行条件:
    - 比較: `E4` vs `E6`
    - `source=data/historical/XAUUSD_M1_mt5_365d.csv`
    - `period=365d`, `rolling_30d`, `step=1d`, `cost_side=0.0003`
    - pass条件 `closed>=12`, `PF>=1.10`, `maxDD<=7%`
  - 成果物:
    - `data/reports/xau_autobot_research_summary_20260228_e4e6_m20_m45_losscooldown_cost0003_rolling30d.json`
    - `data/reports/xau_autobot_research_summary_20260228_e4e6_m20_m45_losscooldown_cost0003_rolling30d.tsv`
  - 実測:
    - `E4_m20_m45_soft_gate`: `pass_window_count=67/335`, `worst_pf=0.0998`, `worst_closed=5`, `loss_cooldown_block_time_share=0.0`
    - `E6_m20_m45_loss_cooldown`: `pass_window_count=64/335`, `worst_pf=0.1463`, `worst_closed=5`, `loss_cooldown_trigger_count=102`, `loss_cooldown_block_count=140`, `loss_cooldown_block_time_share=0.0297`, `loss_streak_p95=6.0`
  - 解釈:
    - E6 は `worst_pf` を改善し DD も微改善したが、`pass_window_count` が E4 を下回った。
    - 停止条件（`pass_window_count < 67/335`）に該当し、E6は現時点 `NO_GO`。
- **V50.8-P5.78 E7（executor期待値構造の最小変更）実装契約（2026-02-28 UTC）**:
  - 背景:
    - E4/E5/E6 の結果から、gate/cooldown はテール改善に有効だが `pass_window_count` を押し上げる主因になっていない。
  - 契約:
    - `E4` の gate（`block_opposite`）は固定し、executor 側パラメータのみ変更して比較する。
    - 比較セット:
      - `E7-1`: `sl/tp` のみ変更（`1.7/2.6 -> 1.6/2.9`）
      - `E7-2`: `ema_gap/pullback` のみ変更（`0.12 -> 0.15`, `0.25 -> 0.23`）
      - `E7-3`: E7-1 + E7-2 の合成
    - 評価順:
      - まず `E7-1`、次に `E7-3`（必要に応じて `E7-2` を追加検証）
  - 評価条件:
    - `rolling_30d`, `step=1d`, `cost_side=0.0003`
    - pass条件 `closed>=12`, `PF>=1.10`, `maxDD<=7%`
  - 採用基準:
    - `pass_window_count >= 75/335`
    - `worst_closed >= 8`
    - `worst_pf >= 0.12`
  - 停止条件:
    - `pass_window_count < 67/335`（E4未満）
    - または `worst_closed` が継続的に悪化（`<=7` 頻発）
- **V50.8-P5.79 E7-1/E7-3 実行評価（2026-02-28 UTC）**:
  - 実装:
    - 追加config:
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate_e7_1.json`
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate_e7_2.json`
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate_e7_3.json`
    - `E7-1` と `E7-3` を `E4` 基準で順次比較（`E7-2` は未実行）。
  - 実行条件:
    - `source=data/historical/XAUUSD_M1_mt5_365d.csv`
    - `period=365d`, `rolling_30d`, `step=1d`, `cost_side=0.0003`
    - pass条件 `closed>=12`, `PF>=1.10`, `maxDD<=7%`
  - 成果物:
    - `data/reports/xau_autobot_research_summary_20260228_e4e7_1_m20_cost0003_rolling30d.json`
    - `data/reports/xau_autobot_research_summary_20260228_e4e7_1_m20_cost0003_rolling30d.tsv`
    - `data/reports/xau_autobot_research_summary_20260228_e4e7_3_m20_cost0003_rolling30d.json`
    - `data/reports/xau_autobot_research_summary_20260228_e4e7_3_m20_cost0003_rolling30d.tsv`
  - 実測（E4 reference）:
    - `E4_m20_m45_soft_gate`: `pass_window_count=67/335`, `worst_pf=0.0998`, `worst_closed=5`
    - `E7_1_m20_r_improve`: `pass_window_count=92/335`, `worst_pf=0.0000`, `worst_closed=4`
    - `E7_3_m20_r_filter_combo`: `pass_window_count=78/335`, `worst_pf=0.0000`, `worst_closed=4`
  - 判定:
    - `pass_window_count` は E7-1/E7-3 ともに E4超え。
    - ただし採用基準（`worst_pf>=0.12` かつ `worst_closed>=8`）を両者とも満たせず、`worst_pf=0` が致命的。
    - 現時点では E7採用不可。次分岐（E8: M20 trend/reversion 二系統）へ進む条件を満たす。
- **V50.8-P5.80 active PF 指標契約（2026-02-28 UTC）**:
  - 背景:
    - `pass_window_count` が改善しても `worst_pf=0` が発生し、薄い窓（`closed<closed_floor`）由来ノイズで評価が破壊されるケースを確認。
  - 契約:
    - `pf_active` は `closed>=closed_floor` の窓でのみ定義する。
    - 運用判定向け summary は `worst_pf` に加えて以下を必須化する。
      - `active_window_count`
      - `worst_pf_active`
      - `p05_pf_active`
      - `p05_closed`
    - `worst_pf_active/p05_pf_active` は active窓のみから算出し、`closed` 不足窓の統計ノイズを分離する。
  - 適用範囲:
    - `tools/xau_autobot_m20_bias_gate_eval.py` の比較レポート出力（JSON/TSV）。
- **V50.8-P5.81 active PF 指標適用 + E4/E7-1 再評価（2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot_m20_bias_gate_eval.py` に active PF 集計を追加。
      - `pf_active = (closed>=closed_floor) の窓のみ定義`
      - `active_window_count`
      - `worst_pf_active`
      - `p05_pf_active`
      - `p05_closed`
    - `tools/tests/test_xau_autobot_m20_bias_gate_eval.py` に `pf_active/percentile` のテストを追加。
  - 成果物:
    - `data/reports/xau_autobot_research_summary_20260228_e4e7_1_m20_cost0003_rolling30d_activepf.json`
    - `data/reports/xau_autobot_research_summary_20260228_e4e7_1_m20_cost0003_rolling30d_activepf.tsv`
  - 実測:
    - `E4_m20_m45_soft_gate`: `pass_window_count=67/335`, `active_window_count=294`, `worst_pf_active=0.0998`, `p05_pf_active=0.2235`, `p05_closed=8`
    - `E7_1_m20_r_improve`: `pass_window_count=92/335`, `active_window_count=289`, `worst_pf_active=0.0000`, `p05_pf_active=0.2675`, `p05_closed=8`
  - 解釈:
    - `p05_pf_active` では E7-1 が E4 を上回る一方、`worst_pf_active=0` は残存。
    - E8比較は `worst_pf_active/p05_pf_active/p05_closed` を同一指標として継続する。
- **V50.8-P5.82 E8（二状態 M20 executor）実装契約（2026-02-28 UTC）**:
  - 背景:
    - `worst_pf_active=0` が active窓でも残存し、E7単体の executor 調整ではテールが消えない。
  - 契約:
    - E8 は `M20` 執行を `TREND/NON_TREND` の2状態へ分離し、`M45` を司令塔に使う。
    - 状態遷移（hysteresis）:
      - `state=NON_TREND` かつ `m45_regime_strength >= 2.35` で `TREND`
      - `state=TREND` かつ `m45_regime_strength <= 2.25` で `NON_TREND`
      - それ以外は状態維持
    - gate 適用:
      - `TREND` 状態のみ `block_opposite`（M45逆方向禁止）
      - `NON_TREND` 状態は gate 無効（両方向許可）
    - E8-T（TREND executor）:
      - `sl/tp=1.6/2.9`, `atr_ratio=0.85-1.55`, `ema_gap=0.12-1.80`, `pullback_atr=0.25`, `strategy_mode=trend`
    - E8-R（NON_TREND executor）:
      - `atr_ratio=0.80-1.30`, `ema_gap=0.08-0.90`, `pullback_atr=0.30`, `strategy_mode=reversion`, `reversion_atr=0.18`, `reversion_sl/tp=0.9/1.35`
  - 評価契約:
    - 既存と同じ `rolling30d/step=1d/cost=0.0003`、`closed>=12 & PF>=1.10 & DD<=7%`。
    - 比較軸は `pass_window_count` に加え、`worst_pf_active/p05_pf_active/p05_closed` を正本指標として固定。
    - `worst_pf_active` を出した窓の内訳（`closed_by_state/pf_by_state/bias_gate_reject_count_trend`）を追跡可能にする。
- **V50.8-P5.83 E8実装 + E4/E7-1/E8 比較実行（2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot_m20_bias_gate_eval.py`
      - `--switch-config` / `--switch-id` / `--switch-label` を追加。
      - E8二状態シミュレーションを追加（`next_two_state_mode`, `select_gate_policy_for_state`）。
      - `worst_active_window_breakdown`（`closed_by_state/pf_by_state/bias_gate_reject_count_trend`）を summary へ追加。
    - 追加config:
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_regime_switch_e8.json`
    - テスト:
      - `tools/tests/test_xau_autobot_m20_bias_gate_eval.py` に E8状態遷移テストを追加。
  - 回帰:
    - `PYTHONPATH=. ./.venv/bin/pytest -q tools/tests/test_xau_autobot.py tools/tests/test_xau_autobot_data.py tools/tests/test_xau_autobot_optimize.py tools/tests/test_xau_autobot_readiness.py tools/tests/test_xau_autobot_trial_judge.py tools/tests/test_xau_autobot_trial_v2_eval.py tools/tests/test_xau_autobot_operational_audit.py tools/tests/test_xau_autobot_m20_bias_gate_eval.py tools/tests/test_xau_autobot_regime_switch_eval.py`
    - 結果: `143 passed`
  - 比較実行:
    - `data/reports/xau_autobot_research_summary_20260228_e4e7_1e8_m20_cost0003_rolling30d.json`
    - `data/reports/xau_autobot_research_summary_20260228_e4e7_1e8_m20_cost0003_rolling30d.tsv`
  - 実測（cost=0.0003）:
    - `E4`: `pass_window_count=67/335`, `worst_pf_active=0.0998`, `p05_pf_active=0.2235`, `p05_closed=8`
    - `E7-1`: `pass_window_count=92/335`, `worst_pf_active=0.0000`, `p05_pf_active=0.2675`, `p05_closed=8`
    - `E8`: `pass_window_count=25/335`, `worst_pf_active=0.2125`, `p05_pf_active=0.3226`, `p05_closed=9`
  - 判定:
    - E8 は `worst_pf_active` と `p05_*` は改善したが、`pass_window_count` が大きく低下。
    - 現行条件（全窓 `closed>=12 & PF>=1.10 & DD<=7%`）では E8は採用不可。
- **V50.8-P5.84 E9-1（E7-1固定 + 状態依存gate）契約（2026-02-28 UTC）**:
  - 背景:
    - E7-1 は `pass_window_count` を確保できる一方、`worst_pf_active=0` のテールが残る。
    - E8 はテール改善と引き換えに `pass_window_count` が大幅低下した。
  - 契約:
    - executorは E7-1（`M20`, `SL/TP=1.6/2.9`）で固定し、`TREND/NON_TREND` で executor を切替えない。
    - gate 適用のみ状態依存にする。
      - `TREND` 状態: `block_opposite`
      - `NON_TREND` 状態: `none`
    - 状態遷移は E8 と同じ hysteresis を使用。
      - `switch_trend_on=2.35`, `switch_trend_off=2.25`, `switch_initial_state=non_trend`
  - 採用判定（E7-1比較）:
    - `pass_window_count >= 92/335` を維持
    - `worst_pf_active > 0`
    - `p05_pf_active >= 0.2675`
- **V50.8-P5.85 E9-1 実行評価（2026-02-28 UTC）**:
  - 実装:
    - 追加config:
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_regime_switch_e9_1.json`
    - E9-1 は evaluator 既存の two-state gate 実装を再利用し、`trend_mode/non_trend_mode` を E7-1同一executorに固定（executor切替なし）。
  - 比較実行:
    - `data/reports/xau_autobot_research_summary_20260228_e7_1e9_1_m20_cost0003_rolling30d.json`
    - `data/reports/xau_autobot_research_summary_20260228_e7_1e9_1_m20_cost0003_rolling30d.tsv`
  - 実測（cost=0.0003）:
    - `E7-1`: `pass_window_count=92/335`, `worst_pf_active=0.0000`, `p05_pf_active=0.2675`, `p05_closed=8`
    - `E9-1`: `pass_window_count=92/335`, `worst_pf_active=0.0000`, `p05_pf_active=0.2675`, `p05_closed=8`
  - 補足:
    - E9-1 の `state_time_share` は `trend=0.6347/non_trend=0.3653`、`gate_active_time_share=0.0667` を確認。
    - ただし window summary は E7-1 と同値で、採用基準の `worst_pf_active>0` を満たせない。
  - 判定:
    - E9-1 は「passを維持」は達成したが、PF=0 active窓は解消できず採用不可。
- **V50.8-P5.86 E10（E7-1派生 sweep）探索契約 + r3切替方針（2026-02-28 UTC）**:
  - 背景:
    - E7-1 は `pass_window_count` は維持できるが、`worst_pf_active=0` が残存。
    - E9-1 でも同テールは解消できず、executor最小変更のみでは下振れ遮断が不足。
  - 実施（研究評価）:
    - `E7-1` を基準に `cooldown/gate/SLTP/pullback` の小規模 sweep（7候補）を実施。
    - 成果物:
      - `data/reports/xau_autobot_research_summary_20260228_e10_sweep_m20_cost0003_rolling30d.json`
      - `data/reports/xau_autobot_research_summary_20260228_e10_sweep_step30_cost0003.json`
      - `data/reports/xau_autobot_research_summary_20260228_e10_c2_costsweep_step30.json`
  - 実測（E10候補）:
    - `E10_c2`（`after_loss_cooldown_m20_bars=2`）が sweep 最上位。
      - rolling30d（step=1d）:
        - `pass_window_count=105/335`（E7-1比 `+13`）
        - `worst_pf_active=0.1367`（E7-1の `0.0` を解消）
        - `p05_pf_active=0.2996`
      - 非重複30d（step=30d, cost=0.0003）:
        - `avg_monthly_pct=-0.8367`, `median_monthly_pct=-1.2967`, `min_monthly_pct=-4.5747`
      - cost感度（step=30d）:
        - `cost=0.0002 -> avg_monthly_pct=-0.4681`
        - `cost=0.0003 -> avg_monthly_pct=-0.8367`
        - `cost=0.0004 -> avg_monthly_pct=-1.2039`
  - 契約:
    - `E10_c2` は「テール改善を確認した探索候補」として採用する。
    - ただし `avg_monthly_pct<0` のため **primary 切替は行わず**、`r3` 探索枠で forward 観測する。
    - `primary=r2v_m20_e1` は維持し、`r3` のみ `E10_c2` へローテーションする。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.87 r3探索を E10_c2 へ実切替（2026-02-28 UTC）**:
  - 実施:
    - 探索configを追加:
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2.json`
      - 主要差分: `after_loss_cooldown_m20_bars=2`, `magic=560486`, `comment=x3u_260228_m20e10c2`
    - `current_run_r3` を更新:
      - `data/reports/xau_autobot_trial_v2_current_run_r3.json`
      - `run_id=trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2`
    - `xau_autobot_live_loop_guard.py --include-r3` で不足loopを自動再起動し、`primary/r2/r3=1/1/1` に収束。
  - 生成成果物:
    - `data/reports/xau_autobot_live_report_trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2.json`
    - `data/reports/xau_autobot_trial_judge_trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2.json`
    - `data/reports/v50_8_trial_judge_trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2.json`
    - `data/reports/xau_autobot_operational_audit_20260228_m20_e10_c2_refresh1_now1343.json`
    - `data/reports/v50_8_run_refresh_20260228_1342_r3_e10_c2.json`
  - 実測（切替直後）:
    - guard: `status=HEALTHY`（expected `primary/r2/r3` 全て `count=1`）
    - judge（r3）: `verdict=INVALID_TRIAL`, `window_days=0.0010`, `closed_positions=0`, `monthly_return_pct=0.0`
    - audit（r3）: `status=INSUFFICIENT_DATA`, `runtime_metrics_source=journal`, `snapshot_count=12`
  - 判定:
    - ローテーションは完了。
    - 3日 gate までは観測不足フェーズとして `r3=E10_c2` の forward を継続する。
  - 通信ポート/メッセージ契約は変更しないため `INTERFACES.md` 更新は不要。
- **V50.8-P5.90 E10最終2サイクル契約（2026-02-28 UTC）**:
  - 方針:
    - `M20 + M45` 枝は **最大2サイクルで終了**する。
    - 追加の gate 派生（E11+）は行わず、TREND側 executor 条件の最小変更のみ試す。
  - サイクル1（E10, 必須）:
    - ベースは `E7-1 + E4 gate`（`block_opposite`）を維持。
    - TREND状態だけ以下を上書き:
      - `min_ema_gap_over_atr: 0.12 -> 0.18`
      - `pullback_atr: 0.25 -> 0.23`
  - サイクル2（条件付き）:
    - サイクル1が閾値を満たす場合のみ `non-overlap 30d`（`step=30d`）で再確認する。
  - 最終停止条件（同時達成必須）:
    - `pass_window_count >= 90/335`
    - `p05_pf_active >= 0.27`
    - `non-overlap 30d` で `zero_win_active_window_count <= 1`
  - 未達時:
    - `M20 + M45` 現枝は打ち切り、別仮説（時間帯制御/イベント回避/別執行ロジック）へ移行する。
- **V50.8-P5.91 E10 2サイクル実行結果（2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot_m20_bias_gate_eval.py` に TREND時のみ executor 入力を上書きする `trend_override_*` 契約を追加。
    - 追加config:
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate_e10.json`
  - 回帰:
    - `pytest -q tools/tests/test_xau_autobot_m20_bias_gate_eval.py` -> `20 passed`
  - サイクル1（rolling30d, step=1d, cost=0.0003）:
    - `data/reports/xau_autobot_research_summary_20260228_e7_1e10_m20_cost0003_rolling30d.json`
    - `E10`: `pass_window_count=92/335`, `p05_pf_active=0.341955`, `worst_pf_active=0.0`
    - 閾値判定:
      - `pass_window_count >= 90/335` -> PASS
      - `p05_pf_active >= 0.27` -> PASS
  - サイクル2（non-overlap 30d, step=30d, cost=0.0003）:
    - `data/reports/xau_autobot_research_summary_20260228_e7_1e10_m20_cost0003_step30_nonoverlap.json`
    - `zero_win_active_window_count=1`（active窓 `closed>=12` かつ `pf==0` の窓数）
    - 閾値判定:
      - `zero_win_active_window_count <= 1` -> PASS
  - 総合:
    - ユーザー指定3条件を満たしたため、`E10` の2サイクル検証を完了。
    - 契約どおり本枝はここで終了し、`E11+ gate派生` は実施しない。
- **V50.8-P5.92 E10 live接続正本化（2026-02-28 UTC）**:
  - 研究枝の最終成果物を `E10` に固定する。
    - canonical candidate:
      - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate_e10.json`
    - 根拠:
      - `pass_window_count=92/335`
      - `p05_pf_active=0.341955`
      - `non-overlap 30d zero_win_active_window_count=1/10`
  - live昇格契約:
    - `LIVE_ACCEPT_TF` は維持（`[M1,M5,M15,M20,M30,H1,H4]`）。
    - live実装は `M20 executor` に対して **derived M45 soft gate + TREND override** を適用する。
    - `M45` 判定は `M15` 由来の再集約を正本とし、`RESAMPLE_ANCHOR=UTC_00:00`, `RESAMPLE_OFFSET_MINUTES=0` を固定する。
  - live段階評価（探索ではなく昇格判定）:
    - 14日 shadow:
      - `closed>=6`, `PF>=1.05`, `DD<=4%`
    - 30日 micro-live:
      - `closed>=12`, `PF>=1.10`, `net>0`
      - `non-overlap 30d zero_win_active_window_count<=1`
    - 月利3%判定は上記を満たした後に実施する。
- **V50.8-P5.93 E10 live経路実装（2026-02-28 UTC）**:
  - 実装:
    - `tools/xau_autobot.py` に `derived M45 commander` を実装し、`M15 -> (factor=3) -> M45` の再集約を live実行中に適用。
    - `m45_bias_gate_policy` / `m45_neutral_policy` を live評価に接続し、`block_opposite/hard_lock` を実シグナルへ反映。
    - `trend_override_*` を live評価に接続し、`TREND` 状態のみ `min_ema_gap_over_atr` と `pullback_atr` を上書き。
    - `m45_commander_config_path` を追加し、`M45` profile JSON から commander EMA/ATR/threshold を hydrate する。
  - fail-closed 契約:
    - gate/override 有効時は `timeframe=M20` 必須。
    - `m45_commander_source_timeframe=M15` 必須。
    - `m45_commander_resample_anchor=UTC_00:00` かつ `m45_commander_resample_offset_minutes=0` 必須。
    - commander データ不足/設定不備時は `action=BLOCKED`, `reason=m45_commander_unavailable` を返して新規発注を停止。
  - 反映config:
    - `tools/configs/xau_autobot.trial_v2_20260228_m20_executor_v1_m45_softgate_e10.json` に `m45_commander_config_path` と resample契約キーを追加。
  - 回帰:
    - `pytest -q tools/tests/test_xau_autobot.py` -> `62 passed`
    - `python -m py_compile tools/xau_autobot.py tools/tests/test_xau_autobot.py` -> OK
- **IHトラック停止（2026-02-26, user option=1）**:
  - `IH monthly` 系（`ih_opt_*`）の新規 run 起票と追加ゲートを停止。
  - 既存 `P6/P6.3` は postmortem として保持し、改善投資は `XAU単独トラック` に集中する。
- **Legend lifecycle hotfix（2026-02-26）**:
  - root cause: `swimmy-school` が旧プロセスで動作中に overflow deathmatch が実行され、Legend名戦略が `GRAVEYARD` へ再流出した。
  - **Legend Phase1 revalidation immutability 契約**: `handle-v2-result` の Phase1 経路は `:LEGEND` 戦略を `:B/:GRAVEYARD` へ遷移させない。再検証はメトリクス更新のみ行い、ランクは `:LEGEND` を維持する。
  - **No-op ensure-rank DB resurrection 契約**: `ensure-rank` は `old-rank == new-rank` の no-op ケースでも、DB rank が archived（`:GRAVEYARD/:RETIRED`）かつ target が active（`B/A/S/LEGEND`）なら DB rank を自己修復（upsert）する。
- **CPCV criteria-fail 再投入契約（2026-02-26）**:
  - root cause: `run-a-rank-cpcv-batch` が `:criteria-fail` を「シグネチャ変更がない限り再投入不可」と扱い、A候補が長時間 `Skipped ... dispatch cooldown` で固定化するケースを確認。
  - 契約:
    - `:criteria-fail` は専用TTL経過後に再投入可能（`*cpcv-criteria-fail-retry-interval*`）。
    - `:runtime-fail/:inflight` は従来どおり `*cpcv-strategy-retry-interval*` で再試行。
    - `:passed` はシグネチャ変更がない限り再投入しない。
  - 目的: 無期限ロックを避けつつ、CPCV連打によるスループット浪費を抑制する。
  - interface 変更なし（`INTERFACES.md` 更新不要）。
- **CPCV pass判定整合（2026-02-26）**:
  - root cause: Guardian の `CPCV_RESULT.is_passed` が `median_sharpe>=0.5 && pass_rate>=0.5` で判定され、S昇格契約（`pass_rate>=0.70 && median_maxdd<0.12`）と不整合だった。
  - 契約:
    - `CPCV_RESULT.is_passed` は **S Stage2 gate**（`pass_rate>=0.70` かつ `median_maxdd<0.12`）を表す。
    - Lisp 側の `:criteria-fail/:passed` 分類と再投入クールダウンはこの意味に依存する。
  - 目的: `pass_rate 0.50-0.69` の結果を誤って `:passed` 固定化しない。
  - interface semantics 変更あり（`INTERFACES.md` 更新要）。
- **V50.7 B1R探索スナップショット（2026-02-24）**:
  - `A9`（taiki seed47直撃）は `fix6d` で `top3_oos_ok=1` を確認し、完了条件を達成。
  - `A11`（taiki seed23追補, fix6e）は `top3_oos_ok=1`（`vwapvr@720` が `oos_ok=true`）を確認し、seed23回復を実測。
  - `A12`（fix10ミックス最終評価）で `both_players_pass_count=4/5`（`fix10_overlap={11,23,47,83}`）を達成し、`b1r_completed=true` を確認。
  - `A13`（Armada OOS再ランク実装）で `--oos-rerank-pool` を導入し、`fix10a`（seed47）で `top3_oos_ok=1` の回復を実測。
  - `A14`（C1 refresh fix10反映版）で `strict={投入可:0, 保留:4, 再探索:1}`、`proxy={投入可:0, 保留:5, 再探索:0}` を確認。`deploy_decision` は両ビューとも `保留`。
  - `A15`（L3 paper readiness更新）で `armada_paper_readiness_20260223_fix10refresh.json` を生成し、`decision=HOLD`（`paper_trade_count=0/20`, `slippage_samples=0/20`）を確認。
  - `A17`（paper evidence現況, 2026-02-24）で `trade_logs.execution_mode={SHADOW:0, PAPER:0, LIVE:1}` を再確認。`primary (SHADOW+PAPER)=0/20` のまま未進捗。
  - `A19` 追補（`armada_paper_readiness_20260224_followup2.json`, `generated_at=2026-02-24T12:56:29Z`）でも `decision=HOLD`（`paper_trade_count=0/20`, `slippage_samples=0/20`）を再確認。`swimmy-armada-paper-readiness.service` 手動実行でも `status=0/SUCCESS` かつ `armada_paper_readiness_20260224_fix10refresh.json`（`generated_at=2026-02-24T12:58:06Z`）を確認。
  - `A20`（A-rank復帰とpaper evidence再開）は完了。`reseed_active_b.py` 実適用後に `:A>=1` を維持（最新実測 `:A=4`）し、`trade_logs.execution_mode={LIVE:1, SHADOW:2, PAPER:0}` で条件2（`SHADOW/PAPER` 増分）も達成。
  - founder 3通貨監視（`founder_rank_watch_20260223_121322`）は `sample 169`（`2026-02-24 03:35 JST`）以降 `B=1/Graveyard=2` へ逸脱。根因は `A/B conformance` ではなく `Operation Black Death (Low Sharpe)`。
  - founder 再監視（`founder_rank_watch_20260224_114359.service`）では、`sample 16`（`2026-02-24 22:06 JST`）で一時 `B=0/Graveyard=3` を観測。`cull-pool-overflow` の Founder保護欠落を是正後、`sample 17`（`2026-02-24 22:11 JST`）で `B=3/Graveyard=0` 復帰を確認。
  - `prune-low-sharpe-strategies` に founder recovery 例外（`founder-phase1-recovery-passed-p`）を追加し、`Phase1 recovery` と prune 経路の整合を修正済み（単体回帰テストで確認）。
  - `A19` は再評価完了。`armada_paper_readiness_20260225_runtime_window_default.json`（`generated_at=2026-02-25T03:11:21.387053+00:00`）で `decision=GO` を確認。
    - 判定条件は `Synthetic-Close-Probe-*` を除外し、runtime guard を直近 `20` 件（`runtime_window_trade_count=20`, `runtime_window_net_pnl=1.1031132936477661`）で評価。
    - `swimmy-armada-paper-readiness.timer` は `disabled` のまま（定期実行は停止維持、必要時に手動再計測）。
  - 方針確定（2026-02-25）:
    - ユーザー選択 `option=2` により「再評価GOを採用」を正本化。
    - 同日午前の打ち切り判断は履歴扱いとし、運用継続判断は `A19再評価GO` を優先する。
  - 収益化トラックは期限固定で運用（ユーザー承認, 2026-02-25 JST）:
    - `2026-03-03 23:59 JST`: `paper_trade_count>=20` かつ `slippage_sample_count>=20` 未達なら停止。
    - `2026-03-17 23:59 JST`: fixed forward 判定で `net_pnl>0` かつ `PF>=1.10` 未達なら停止。
    - `2026-03-18 JST`: 継続/撤退を最終決定（未達ならEA運用停止）。
  - `V50.8` 実行開始（2026-02-25）:
    - baseline: `data/reports/v50_8_baseline_20260225.json`
    - candidate rank: `data/reports/v50_8_candidate_rank_20260225.json`（最新選抜 `period=30d`, 月利換算 `10.0742%`）
    - trial judge: `data/reports/v50_8_trial_judge_trial_v2_20260225_v50_8_30d.json`（`INVALID_TRIAL`, `window_days=0.00038194877314814816`、開始直後）
    - cycle再確認で `data/reports/xau_autobot_cycle_summary_20260224_repush_30d.json` の `monthly_return_est_pct=10.0742`（`trades=89`, `pf=1.7745`）を確認し、`V50.8-P2` 正本runを `trial_v2_20260225_v50_8_30d` へ切替。
  - `V50.8-P2` 追補（2026-02-25）:
    - 実運用runを `trial_v2_20260225_v50_8_30d` へ切替（config: `tools/configs/xau_autobot.trial_v2_20260225_v50_8_30d.json`）。
    - `xau_autobot_live_loop.ps1` は `magic=560075`, `comment=xau_autobot_trial_v2_20260225_v50_8_30d` で稼働中。
    - 最新 `data/reports/v50_8_trial_judge_trial_v2_20260225_v50_8_30d.json` は `INVALID_TRIAL`（開始直後, `window_days=0.00038194877314814816`）。
  - `V50.8-P4` 追補（2026-02-25, identity整合プローブ）:
    - `trial_v2_20260225_identity_probe`（config: `tools/configs/xau_autobot.tuned_auto_active.json`）で trial judge を実行。
    - `data/reports/xau_autobot_trial_judge_trial_v2_20260225_identity_probe.json` は `trial_valid=true`, `verdict=NO_GO`（`window_days=14.0`）。
    - 実測: `closed_positions=27`, `pf=0.6023`, `win_rate=0.2963`, `net_profit=-12355.0`。
    - `after_magic_filter=53`, `after_comment_prefix_filter=27` を確認し、主因は identity不一致ではなく実成績不足（PF/WR/Net）と確定。
  - `V50.8-P5` 追補（2026-02-25, 収益改善ラウンド1・再最適化）:
    - 30d向けに entry制約を絞った再最適化を実施（`candidate_count=1296`）。
    - 成果物:
      - `data/reports/xau_autobot_optimize_20260225_v50_8_p5_r1.jsonl`
      - `tools/configs/xau_autobot.trial_v2_20260225_v50_8_30d_r1.json`
    - rank1候補:
      - `fast/slow=30/140`, `pullback_atr=0.3`, `sl/tp=2.0/3.0`, `session=8-17`, `atr_band=0.95-1.30`, `score=0.5536`
    - 運用判断:
      - 実運用runは `trial_v2_20260225_v50_8_30d` を維持（14日窓リセット回避）。
      - `r1` は次回切替候補として保持。
    - `V50.8-P5.3` 追補（2026-02-25, controlled cutover 実施）:
      - 実運用runを `trial_v2_20260225_v50_8_30d_r1` へ切替。
      - `xau_autobot_live_loop.ps1` は `magic=560076`, `comment=xau_autobot_trial_v2_20260225_v50_8_30d_r1` で稼働中。
      - `data/reports/xau_autobot_trial_v2_current_run.json` を `run_id=trial_v2_20260225_v50_8_30d_r1` へ更新。
      - `data/reports/xau_autobot_trial_judge_trial_v2_20260225_v50_8_30d_r1.json` は `INVALID_TRIAL`（開始直後, `window_days=0.0005366872453703703`）。
      - `data/reports/v50_8_trial_judge_trial_v2_20260225_v50_8_30d_r1.json` / `data/reports/v50_8_monthly_decision_20260225.json` を更新（`decision=NO_GO` 継続）。
      - interface 変更はなく、`INTERFACES.md` 更新は不要。
    - `V50.8-P5.4` 追補（2026-02-26, single-runner clean-up 実施）:
      - root cause: Windows 側で `xau_autobot.py --live` が複数config（`trial_v2_20260222`/`tuned_auto_active`/`live_named_*`/旧trial）で同時稼働し、trial 集計が混線。
      - `Swimmy-XAU-Cycle` を `Disabled` へ変更し、Startup launcher `Swimmy-XAU-Exec.vbs` を `.disabled_20260226_084917` へ退避。
      - 競合プロセスを停止し、稼働を `trial_v2_20260225_v50_8_30d_r1` の1本へ収束。
      - 再評価（`2026-02-25T23:52:17Z`）:
        - live report: `total_deals=16`, `after_symbol_filter=16`, `after_magic_filter=0`, `after_comment_prefix_filter=0`
        - trial judge: `INVALID_TRIAL`, `window_days=0.7154219328703704`, `closed_positions=0`
      - 含意:
        - 計測混線は解消。未達主因は「trial対象（magic/comment一致）の約定未発生」。
    - 次アクション（V50.8-P5.5, 実行予定）:
      - 単発診断で `r1` は `BLOCKED:session`（UTC=2, 許可帯 8-17）を確認。
      - 24h化プローブでも `BLOCKED:volatility` を確認。
      - trial 計測母集団の確保を優先し、`r2` を `24h session + ATR比フィルタ緩和` で起動する。
      - interface 変更はなく、`INTERFACES.md` 更新は不要。
    - `V50.8-P5.5` 追補（2026-02-26, entry unblocking 実施）:
      - `tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_r2.json` を追加。
      - 変更点: `session=0-23`, `atr_ratio_filter=0.0-999.0`, `magic/comment=560077/xau_autobot_trial_v2_20260226_v50_8_30d_r2`。
      - 実運用runを `trial_v2_20260226_v50_8_30d_r2` へ切替し、**XAU trial 対象config**（`..._30d_r2.json`）の単独稼働を確認。
      - 再評価（`2026-02-26T00:07:00Z`）:
        - `trial_valid=false`, `verdict=INVALID_TRIAL`, `window_days=0.0006847736574074074`
        - `summary={closed_positions:0, profit_factor:0.0, win_rate:0.0, net_profit:0.0}`
      - 更新成果物:
        - `xau_autobot_trial_judge_trial_v2_20260226_v50_8_30d_r2.json`
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r2.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r2.json`
    - `V50.8-P5.5` 追補（2026-02-26, dual-run 並走）:
      - `r1`（本線）と `r2`（探索）を並走起動。
        - `r1` config: `tools/configs/xau_autobot.trial_v2_20260225_v50_8_30d_r1.json`（`magic=560076`）
        - `r2` config: `tools/configs/xau_autobot.trial_v2_20260225_v50_8_30d_r2.json`（`magic=560077`）
      - run meta を分離:
        - 正本（本線）: `data/reports/xau_autobot_trial_v2_current_run.json` -> `trial_v2_20260225_v50_8_30d_r1`
        - 副本（探索）: `data/reports/xau_autobot_trial_v2_current_run_r2.json` -> `trial_v2_20260225_v50_8_30d_r2`
      - 最新判定（2026-02-26 00:01 UTC）:
        - `r1`: `window_days=0.7221140405324074`, `verdict=INVALID_TRIAL`, `closed_positions=0`
        - `r2`: `window_days=0.00015801098379629629`, `verdict=INVALID_TRIAL`, `closed_positions=0`
      - 集約レポート: `data/reports/v50_8_dual_run_status_20260226.json`
    - `V50.8-P5.6` 追補（2026-02-26, root cause確定）:
      - trial config の `comment` が MT5上限31文字を超過しており、`xau_autobot.py` 起動時に fail-closed で停止することを再現確認。
        - 対象: `tools/configs/xau_autobot.trial_v2_20260225_v50_8_30d_r1.json` / `..._r2.json` / `tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_r2.json` / `..._r3.json`
        - 実測: 各 `comment` 長 = 42 文字（例: `xau_autobot_trial_v2_20260226_v50_8_30d_r2`）
        - 再現: `python3 tools/xau_autobot.py --config tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_r2.json --poll-seconds 10 --loop --live`
        - 例外: `ValueError: comment exceeds MT5 max length 31`
      - 含意:
        - trial run は「entry条件」以前に起動時点で停止しうるため、`closed_positions=0` の主因に設定不整合が混在。
      - 対応方針:
        - `comment` を 31文字以下に修正し、trial start 経路にも preflight を追加して再発防止（fail-closedを起動前に顕在化）。
      - ホットフィックス適用（2026-02-26）:
        - `tools/configs/xau_autobot.trial_v2_20260225_v50_8_30d_r1.json`:
          - `comment: xaut_v2_250225_30d_r1`（21文字）
        - `tools/configs/xau_autobot.trial_v2_20260225_v50_8_30d_r2.json`:
          - `comment: xaut_v2_250225_30d_r2`（21文字）
        - `tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_r2.json`:
          - `comment: xaut_v2_250226_30d_r2`（21文字）
        - `tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_r3.json`:
          - `comment: xaut_v2_250226_30d_r3`（21文字）
      - 検証:
        - 全 `tools/configs/xau_autobot.trial_v2_*.json` の comment 長が `<=31` を満たすことを確認。
        - `python3 tools/xau_autobot.py --config tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_r2.json --poll-seconds 10 --loop --live` で
          `comment exceeds MT5 max length` は再発せず、次段の `MetaTrader5 Python package is missing`（WSL環境差分）まで進むことを確認。
      - 再発防止実装:
        - `tools/xau_autobot_trial_v2_start.sh` に preflight を追加し、trial起動前に config を検証。
        - `reason=trial_config_invalid_comment_length` / `trial_config_not_found` / `trial_config_invalid_json` を明示して fail-closed。
        - `tools/tests/test_xau_autobot_trial_v2_start.py` を追加し、31文字超 comment が run meta 書き込み前に拒否されることを回帰テスト化。
    - `V50.8-P5.6` 追補（2026-02-26, r2sc close反映）:
      - `trial_v2_20260226_v50_8_30d_r2sc` を再評価し、`trial_valid=true` / `verdict=NO_GO` を確認（`INVALID_TRIAL` は脱却）。
      - 実測（`xau_autobot_live_report_trial_v2_20260226_v50_8_30d_r2sc.json`）:
        - `closed_positions=3`
        - `net_profit=-5232.0`
        - `diagnostics={after_magic_filter:6, after_comment_prefix_filter:3}`
      - 含意:
        - `comment長/truncation` 起因の集計不一致は解消済み。
        - 現在の未達主因は純粋に実運用成績不足（PF/WR/Net）であり、次段はパラメータローテーションの成績改善に集中できる。
    - `V50.8-P5.7` 追補（2026-02-26, r1sc ローテーション）:
      - `r2sc` は `trial_valid=true` まで進んだ一方、`closed_positions=3`, `net_profit=-5232.0` で `verdict=NO_GO`。
      - 改善ラウンド継続として `trial_v2_20260226_v50_8_30d_r1sc` へローテーション。
        - config: `tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_r1sc.json`
        - `magic/comment`: `560080/xaut_v2_260226_r1sc`
      - 初回再評価（起動直後）:
        - `xau_autobot_trial_judge_trial_v2_20260226_v50_8_30d_r1sc.json`
        - `trial_valid=false`, `verdict=INVALID_TRIAL`, `window_days=0.00593607337962963`, `closed_positions=0`
      - 含意:
        - 発注経路は有効（`BLOCKED` ではなく `HOLD` 観測）だが、run窓初期のため判定は未成熟。
    - `V50.8-P5.8` 追補（2026-02-26, r1s2 daily judge refresh）:
      - `trial_v2_20260226_v50_8_30d_r1s2` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価。
      - 反映:
        - `xau_autobot_trial_judge_trial_v2_20260226_v50_8_30d_r1s2.json`
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r1s2.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r1s2.json`
        - `xau_autobot_trial_watchdog_trial_v2_20260226_v50_8_30d_r1s2.json`
      - 現況:
        - `trial_valid=false`, `verdict=INVALID_TRIAL`, `window_days=0.0033762395138888885/14`
        - `summary={closed_positions:0, profit_factor:0.0, win_rate:0.0, net_profit:0.0}`
        - `watchdog={decision:CONTINUE, triggered:false, window_hours:0.08102974833333333/24}`
        - `decision=NO_GO`, `actual_monthly_return_pct=0.0`
      - 単発シグナル診断:
        - `xau_autobot_live_loop.ps1 -Live -Once` は `action=HOLD`（`BLOCKED` ではない）。
      - 含意:
        - 現状は reject/guard block ではなく、シグナル未成立による待機。
    - `V50.8-P5.9` 追補（2026-02-26, r2sc 副run再開）:
      - `r1s2` を本線のまま維持し、`r2sc` を `current_run_r2`（lock分離）で再起動。
      - `xau_autobot_trial_v2_current_run_r2.json` は `run_id=trial_v2_20260226_v50_8_30d_r2sc`, `started_at_utc=2026-02-26T11:15:39.881278+00:00`。
      - 再評価:
        - `xau_autobot_trial_judge_trial_v2_20260226_v50_8_30d_r2sc.json`
        - `trial_valid=false`, `verdict=INVALID_TRIAL`, `window_days=0.00036742836805555554`
        - `watchdog={decision:CONTINUE, triggered:false, window_hours:0.008818280833333332/24}`
      - 集約更新:
        - `v50_8_dual_run_status_20260226.json` を `primary=r1s2`, `secondary=r2sc` で再生成。
      - 稼働確認:
        - `...xau_autobot.trial_v2_20260226_v50_8_30d_r1s2.json` と `...r2sc.json` の live loop 2本が同時稼働。
      - 含意:
        - KPI 判定正本は `r1s2` のまま、`r2sc` は約定発生観測用トラックとして運用。
    - `V50.8-P5.10` 追補（2026-02-26, r2rv 探索ローテーション）:
      - entry発生優先探索として `r2a`（trend）を生成したが、単発診断は `action=HOLD` で不採用。
      - `reversion` 探索config `tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_r2rv.json` を追加（`magic=560083`, `comment=xaut_v2_260226_r2rv`）。
      - `xau_autobot_live_loop.ps1 -Live -Once` で `action=ORDER`, `retcode=10009 (Request executed)` を確認。
      - 副runを `trial_v2_20260226_v50_8_30d_r2rv` へ切替:
        - `xau_autobot_trial_v2_current_run_r2.json` を更新（run_id/config/started_at 反映）。
        - `xau_autobot_trial_judge_trial_v2_20260226_v50_8_30d_r2rv.json` / `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r2rv.json` / `v50_8_gap_analysis_20260226_runtime_r2rv.json` を生成。
      - 2本集約:
        - `v50_8_dual_run_status_20260226.json` を `primary=r1s2`, `secondary=r2rv` へ更新。
      - 観測:
        - `r2rv` live report は `open_snapshot={open_positions:1, open_volume:0.01, open_floating_profit:-120.0}`（建玉あり）を確認。
      - 含意:
        - 探索runは「約定可能性」から「クローズ実績取得」フェーズへ移行。
    - `V50.8-P5.11` 追補（2026-02-26, r1s2/r2rv daily refresh #2）:
      - `r1s2`（本線）/`r2rv`（探索）を再評価し、`v50_8_trial_judge_*`・`v50_8_gap_analysis_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_monthly_decision_20260225.json` を再同期。
      - 現況:
        - `r1s2`: `verdict=INVALID_TRIAL`, `trial_valid=false`, `window_days=0.03507241158564815`, `closed_positions=0`
        - `r2rv`: `verdict=INVALID_TRIAL`, `trial_valid=false`, `window_days=0.004892941828703704`, `closed_positions=0`
      - `r2rv` ランタイム:
        - `xau_autobot_live_report_trial_v2_20260226_v50_8_30d_r2rv.json` で `open_snapshot={open_positions:1, open_volume:0.01, open_floating_profit:80.0}`。
      - 含意:
        - `r2rv` は建玉維持フェーズで、クローズ確定（`closed_positions>0`）まで KPI 指標は進展しない。
    - `V50.8-P5.12` 追補（2026-02-26, r2rv monitoring loop）:
      - `r2rv` を約20秒間隔で5サイクル監視し、`closed_positions>0` を待機。
      - 監視中 `open_floating_profit` 推移:
        - `404 -> 512 -> 496 -> 488 -> -276`
      - 同期更新:
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r1s2.json`
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r2rv.json`
        - `v50_8_gap_analysis_20260226_runtime_r1s2.json`
        - `v50_8_gap_analysis_20260226_runtime_r2rv.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_monthly_decision_20260225.json`
      - 現況:
        - `r1s2`: `verdict=INVALID_TRIAL`, `window_days=0.03716072996527778`, `closed_positions=0`
        - `r2rv`: `verdict=INVALID_TRIAL`, `window_days=0.008349592465277778`, `closed_positions=0`
        - `r2rv` は `open_positions=1` を維持（`open_floating_profit=-276.0`）。
      - 含意:
        - 監視ウィンドウ内ではクローズ未発生。KPI判定は `NO_GO` 継続。
    - `V50.8-P5.13` 追補（2026-02-26, r1s2/r3 daily refresh #2）:
      - 副run を `r3` として再評価し、`v50_8_trial_judge_*`・`v50_8_gap_analysis_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_monthly_decision_20260225.json` を再同期。
      - 現況:
        - `r1s2`: `verdict=INVALID_TRIAL`, `window_days=0.09867541818287036`, `closed_positions=0`, `open_positions=1`, `open_floating_profit=909.0`
        - `r3`: `verdict=INVALID_TRIAL`, `window_days=0.026244582094907407`, `closed_positions=0`, `open_positions=1`, `open_floating_profit=950.0`
      - watchdog:
        - `r1s2`: `window_hours=2.3682100363888887`, `decision=CONTINUE`
        - `r3`: `window_hours=0.6379718408333334`, `decision=CONTINUE`
      - 判定:
        - 本線 `r1s2` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.14` 追補（2026-02-26, r1s2/r3 refresh #3 + run-meta正規化）:
      - 実行実態を再確認し、副run正本を `r3` に固定。
        - live loop: `tools/configs/xau_autobot.trial_v2_20260226_v50_8_30d_r1s2.json` + `..._r3.json`
        - run meta副本: `data/reports/xau_autobot_trial_v2_current_run_r2.json` は `run_id=trial_v2_20260226_v50_8_30d_r3`
      - `r1s2` / `r3` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、以下を再同期:
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r1s2.json`
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r3.json`
        - `v50_8_gap_analysis_20260226_runtime_r1s2.json`
        - `v50_8_gap_analysis_20260226_runtime_r3.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_monthly_decision_20260225.json`
      - 併せて primary 別名メタを同期:
        - `xau_autobot_trial_v2_current_run_r1.json` を `xau_autobot_trial_v2_current_run.json` と同一化。
      - 現況:
        - `r1s2`: `verdict=INVALID_TRIAL`, `window_days=0.10073652298611112`, `closed_positions=0`, `open_positions=1`, `open_floating_profit=1403.0`
        - `r3`: `verdict=INVALID_TRIAL`, `window_days=0.028305582743055554`, `closed_positions=0`, `open_positions=1`, `open_floating_profit=1443.0`
      - watchdog:
        - `r1s2`: `window_hours=2.4176765516666667`, `decision=CONTINUE`
        - `r3`: `window_hours=0.6793339858333333`, `decision=CONTINUE`
      - 判定:
        - KPI 判定正本（本線 `r1s2`）は `decision=NO_GO` 継続。
    - `V50.8-P5.15` 追補（2026-02-27, option2 monitor-only）:
      - ユーザー選択 `2`（外部ジョブは停止せず、監視・集計のみ継続）を適用。
      - 実行実態:
        - run meta 正本: `xau_autobot_trial_v2_current_run.json` -> `trial_v2_20260227_v50_8_30d_r3u_h1`
        - run meta 副本: `xau_autobot_trial_v2_current_run_r2.json` -> `trial_v2_20260226_v50_8_30d_expA`
      - 監視評価（起動停止なし）:
        - `trial_v2_20260227_v50_8_30d_r3u_h1` を再評価:
          - `verdict=INVALID_TRIAL`, `window_days=0.00226896587962963`, `closed_positions=0`
          - watchdog: `decision=CONTINUE`, `window_hours=0.05445518111111111`
        - `trial_v2_20260226_v50_8_30d_expA` を再評価:
          - `verdict=INVALID_TRIAL`, `window_days=0.3926040634375`, `closed_positions=0`
          - watchdog: `decision=CONTINUE`, `window_hours=9.4224975225`
      - 集約更新:
        - `v50_8_dual_run_status_20260226.json` を `primary=r3u_h1`, `secondary=expA` へ更新。
        - `v50_8_monthly_decision_20260225.json` を primary=`r3u_h1` へ同期（`decision=NO_GO` 継続）。
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json` / `v50_8_gap_analysis_20260226_runtime_expA.json` を追加。
      - 異常観測:
        - `r3` は `magic=560083` で約定発生（`after_magic_filter=5`）したが、履歴 comment が `xaut_v2_260226_r` で `r3` の prefix（`xaut_v2_260226r3`）に不一致。
        - 結果として `after_comment_prefix_filter=0` となり、trial 集計に取り込めない状態を確認。
    - `V50.8-P5.15` 追補（2026-02-27, option2 monitor-only refresh #2）:
      - run meta 変化:
        - `xau_autobot_trial_v2_current_run_r2.json` が `trial_v2_20260227_alpha3_r2` へ更新されたことを確認。
        - 正本は `primary=trial_v2_20260227_v50_8_30d_r3u_h1`, `secondary=trial_v2_20260227_alpha3_r2`。
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.0038764968518518518`, `closed_positions=0`, `watchdog.window_hours=0.09153305305555556`
        - `alpha3_r2`: `verdict=INVALID_TRIAL`, `window_days=0.0010516959143518519`, `closed_positions=0`, `watchdog.window_hours=0.021047405277777775`
      - 集約更新:
        - `v50_8_dual_run_status_20260226.json`（`primary=r3u_h1`, `secondary=20260227_alpha3_r2`）
        - `v50_8_monthly_decision_20260225.json`（primary=`r3u_h1` 基準、`decision=NO_GO` 継続）
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_20260227_alpha3_r2.json`
        - `v50_8_monitor_only_status_20260227.json`
    - `V50.8-P5.24` 追補（2026-02-27, option2 monitor-only refresh #3）:
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.013386783958333334`, `closed_positions=0`, `watchdog.window_hours=0.321282815`
        - `alpha3_r2`: `verdict=INVALID_TRIAL`, `window_days=0.006114960462962963`, `closed_positions=0`, `watchdog.window_hours=0.14675905111111112`
      - 集約更新:
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_20260227_alpha3_r2.json`
        - `v50_8_monitor_only_status_20260227.json`
      - 判定:
        - 本線 `r3u_h1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.25` 追補（2026-02-27, option2 monitor-only refresh #4）:
      - run meta 変化:
        - `xau_autobot_trial_v2_current_run_r2.json` が `trial_v2_20260227_v50_8_30d_r2v_h1` へ更新。
        - 正本は `primary=trial_v2_20260227_v50_8_30d_r3u_h1`, `secondary=trial_v2_20260227_v50_8_30d_r2v_h1`。
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.019158778055555555`, `closed_positions=0`, `watchdog.window_hours=0.45981067333333336`
        - `r2v_h1`: `verdict=INVALID_TRIAL`, `window_days=0.0053235021643518515`, `closed_positions=0`, `watchdog.window_hours=0.12776405194444443`
      - 集約更新:
        - `v50_8_dual_run_status_20260226.json`（`primary=r3u_h1`, `secondary=r2v_h1`）
        - `v50_8_monthly_decision_20260225.json`（primary=`r3u_h1` 基準、`decision=NO_GO` 継続）
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_r2v_h1.json`
        - `v50_8_monitor_only_status_20260227.json`
    - `V50.8-P5.27` 追補（2026-02-27, option2 monitor-only refresh #5）:
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.02197481076388889`, `closed_positions=0`, `watchdog.window_hours=0.5273954583333333`
        - `r2v_h1`: `verdict=INVALID_TRIAL`, `window_days=0.008076750578703704`, `closed_positions=0`, `watchdog.window_hours=0.1938420138888889`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r3u_h1.json`
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r2v_h1.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_r2v_h1.json`
        - `v50_8_monitor_only_status_20260227.json`
      - 判定:
        - 本線 `r3u_h1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.28` 追補（2026-02-27, option2 monitor-only refresh #6）:
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.03254450289351852`, `closed_positions=0`, `watchdog.window_hours=0.7810680694444444`
        - `r2v_h1`: `verdict=INVALID_TRIAL`, `window_days=0.018644091678240743`, `closed_positions=0`, `watchdog.window_hours=0.44745820027777783`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r3u_h1.json`
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r2v_h1.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_r2v_h1.json`
        - `v50_8_monitor_only_status_20260227.json`
      - 判定:
        - 本線 `r3u_h1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.31` 追補（2026-02-27, option2 monitor-only refresh #7）:
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.03433046356481481`, `closed_positions=0`, `watchdog.window_hours=0.8239311255555555`
        - `r2v_h1`: `verdict=INVALID_TRIAL`, `window_days=0.020543085810185185`, `closed_positions=0`, `watchdog.window_hours=0.49303405944444445`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r3u_h1.json`
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r2v_h1.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_r2v_h1.json`
        - `v50_8_monitor_only_status_20260227.json`
      - 判定:
        - 本線 `r3u_h1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.32` 追補（2026-02-27, option2 monitor-only refresh #8）:
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.03589821155092592`, `closed_positions=0`, `watchdog.window_hours=0.8615570772222222`
        - `r2v_h1`: `verdict=INVALID_TRIAL`, `window_days=0.021998716284722223`, `closed_positions=0`, `watchdog.window_hours=0.5279691908333334`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r3u_h1.json`
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r2v_h1.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_r2v_h1.json`
        - `v50_8_monitor_only_status_20260227.json`
      - 判定:
        - 本線 `r3u_h1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.36` 追補（2026-02-27, option2 monitor-only refresh #9）:
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.15669373366898148`, `closed_positions=0`, `watchdog.window_hours=3.7606496080555556`
        - `r2v_h1`: `verdict=INVALID_TRIAL`, `window_days=0.14279345390046297`, `closed_positions=0`, `watchdog.window_hours=3.427042893611111`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r3u_h1.json`
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r2v_h1.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_r2v_h1.json`
        - `v50_8_monitor_only_status_20260227.json`
      - 判定:
        - 本線 `r3u_h1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.38` 追補（2026-02-27, option2 monitor-only refresh #10）:
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.1584567470949074`, `closed_positions=0`, `watchdog.window_hours=3.8029619302777777`
        - `r2v_h1`: `verdict=INVALID_TRIAL`, `window_days=0.14455645623842592`, `closed_positions=0`, `watchdog.window_hours=3.4693549497222222`
        - `r2v_h1 live`: `open_positions=1`, `open_floating_profit=249.0`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r3u_h1.json`
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r2v_h1.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_r2v_h1.json`
        - `v50_8_monitor_only_status_20260227.json`
      - 判定:
        - 本線 `r3u_h1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.41` 追補（2026-02-27, option2 monitor-only refresh #11）:
      - 監視評価（起動停止なし）:
        - `r3u_h1`: `verdict=INVALID_TRIAL`, `window_days=0.16245020913194444`, `closed_positions=0`, `watchdog.window_hours=3.8801270447222223`
        - `r2v_h1`: `verdict=INVALID_TRIAL`, `window_days=0.14870841212962962`, `closed_positions=0`, `watchdog.window_hours=3.5504479830555558`
        - `r2v_h1 live`: `open_positions=1`, `open_floating_profit=229.0`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r3u_h1.json`
        - `v50_8_trial_judge_trial_v2_20260227_v50_8_30d_r2v_h1.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u_h1.json`
        - `v50_8_gap_analysis_20260226_runtime_r2v_h1.json`
        - `v50_8_monitor_only_status_20260227.json`
      - 判定:
        - 本線 `r3u_h1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.86` 追補（2026-02-28, option2 monitor-only refresh #12）:
      - run切替（外部更新）:
        - `primary=trial_v2_20260228_v50_8_14d_r2v_m20_e1`
        - `secondary=trial_v2_20260227_h4_stable_tfscan`
        - 両runとも `decision_mode=monthly_only` / `min_days=30` 契約で評価される。
      - 監視評価（起動停止なし）:
        - `r2v_m20_e1`: `verdict=INVALID_TRIAL`, `window_days=0.40305931166666664`, `closed_positions=0`, `watchdog.window_hours=9.673423479999999`
        - `h4_stable_tfscan`: `verdict=INVALID_TRIAL`, `window_days=0.4430405016319444`, `closed_positions=0`, `watchdog.window_hours=10.632972039166667`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260228_v50_8_14d_r2v_m20_e1.json`
        - `v50_8_trial_judge_trial_v2_20260227_h4_stable_tfscan.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_20260228_v50_8_14d_r2v_m20_e1.json`
        - `v50_8_gap_analysis_20260226_runtime_20260227_h4_stable_tfscan.json`
        - `v50_8_monitor_only_status_20260227.json`
      - 判定:
        - 本線 `r2v_m20_e1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.88` 追補（2026-02-28, option2 monitor-only refresh #13）:
      - 監視評価（起動停止なし）:
        - `r2v_m20_e1`: `verdict=INVALID_TRIAL`, `window_days=0.41120753370370366`, `closed_positions=0`, `watchdog.window_hours=9.868980808888889`
        - `h4_stable_tfscan`: `verdict=INVALID_TRIAL`, `window_days=0.45118969225694444`, `closed_positions=0`, `watchdog.window_hours=10.828552614166666`
        - `m20_e10_c2`: `verdict=INVALID_TRIAL`, `window_days=0.004476428518518518`, `closed_positions=0`, `watchdog.window_hours=0.10743428444444444`
      - 監査更新:
        - `xau_autobot_operational_audit_20260228_r2v_m20_e1_refresh2_now1347.json`
        - `xau_autobot_operational_audit_20260228_h4_stable_tfscan_refresh2_now1347.json`
        - `xau_autobot_operational_audit_20260228_m20_e10_c2_refresh2_now1347.json`
        - 3runとも `status=INSUFFICIENT_DATA`, `runtime_metrics_source=journal`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260228_v50_8_14d_r2v_m20_e1.json`
        - `v50_8_trial_judge_trial_v2_20260227_h4_stable_tfscan.json`
        - `v50_8_trial_judge_trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_20260228_v50_8_14d_r2v_m20_e1.json`
        - `v50_8_gap_analysis_20260226_runtime_20260227_h4_stable_tfscan.json`
        - `v50_8_monitor_only_status_20260227.json`
        - `v50_8_run_refresh_20260228_2247_r2v_m20_h4stable_e10c2.json`
      - 判定:
        - 本線 `r2v_m20_e1` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.89` 追補（2026-03-01, option2 monitor-only refresh #14）:
      - run切替（外部更新）:
        - `primary=trial_v2_20260228_m20_executor_v1_m45_softgate_e10_shadow14d`（`started_at_utc=2026-02-28T15:17:29.639880+00:00`）
        - `secondary=trial_v2_20260227_h4_stable_tfscan`
        - `explore=trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2`
      - 監視評価（起動停止なし）:
        - `e10_shadow14d`（primary）: `verdict=INVALID_TRIAL`, `window_days=0.0009189423495370371`, `closed_positions=0`, `watchdog.window_hours=0.02205461638888889`
        - `h4_stable_tfscan`（secondary）: `verdict=INVALID_TRIAL`, `window_days=0.5149248658333333`, `closed_positions=0`, `watchdog.window_hours=12.35819678`
        - `e10_c2`（explore）: `verdict=INVALID_TRIAL`, `window_days=0.06821157918981481`, `closed_positions=0`, `watchdog.window_hours=1.6370779005555556`
      - 監査更新:
        - `xau_autobot_operational_audit_20260228_m20_e10_shadow14d_refresh1_now1518.json`
        - `xau_autobot_operational_audit_20260228_h4_stable_tfscan_refresh4_now1518.json`
        - `xau_autobot_operational_audit_20260228_m20_e10_c2_refresh4_now1518.json`
        - 3runとも `status=INSUFFICIENT_DATA`, `runtime_metrics_source=journal`
      - 集約更新:
        - `v50_8_trial_judge_trial_v2_20260228_m20_executor_v1_m45_softgate_e10_shadow14d.json`
        - `v50_8_trial_judge_trial_v2_20260227_h4_stable_tfscan.json`
        - `v50_8_trial_judge_trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2.json`
        - `v50_8_dual_run_status_20260226.json`
        - `v50_8_dual_run_status_20260227.json`
        - `v50_8_monthly_decision_20260225.json`
        - `v50_8_gap_analysis_20260226_runtime_20260228_m20_executor_v1_m45_softgate_e10_shadow14d.json`
        - `v50_8_gap_analysis_20260226_runtime_20260227_h4_stable_tfscan.json`
        - `v50_8_monitor_only_status_20260227.json`
        - `v50_8_run_refresh_20260301_0019_e10shadow_h4stable_e10c2.json`
      - 判定:
        - 本線 `e10_shadow14d` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.15` 追補（2026-02-27, option1適用 / r3u正本同期）:
      - ユーザー選択 `1` に従い、`r3u` を正本 run として運用継続。
      - 実行:
        - `r3u` / `expA` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価。
      - run meta 正規化:
        - `xau_autobot_trial_v2_current_run.json` と `xau_autobot_trial_v2_current_run_r1.json` を `run_id=trial_v2_20260226_v50_8_30d_r3u` に統一。
        - `xau_autobot_trial_v2_current_run_r2.json` は `run_id=trial_v2_20260226_v50_8_30d_expA` を維持。
      - 同期更新:
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r3u.json`
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_expA.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u.json`
        - `v50_8_gap_analysis_20260226_runtime_expA.json`
        - `v50_8_dual_run_status_20260226.json`（`primary=r3u`, `secondary=expA`）
        - `v50_8_monthly_decision_20260225.json`（本線 `r3u` 基準へ再同期）
      - 現況:
        - `r3u`: `verdict=INVALID_TRIAL`, `window_days=0.38935184353009256`, `closed_positions=0`, `watchdog.window_hours=9.34444424472222`
        - `expA`: `verdict=INVALID_TRIAL`, `window_days=0.38390410063657404`, `closed_positions=0`, `watchdog.window_hours=9.213698415277777`
      - 判定:
        - 本線 `r3u` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
    - `V50.8-P5.15` 追補（2026-02-27, option1継続 / r3u+expA再同期 #2）:
      - 実行:
        - `r3u` / `expA` を `XAU_AUTOBOT_TRIAL_MIN_CLOSED_POSITIONS=12` + `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価。
      - 同期更新:
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r3u.json`
        - `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_expA.json`
        - `v50_8_gap_analysis_20260226_runtime_r3u.json`
        - `v50_8_gap_analysis_20260226_runtime_expA.json`
        - `v50_8_dual_run_status_20260226.json`（`primary=r3u`, `secondary=expA`）
        - `v50_8_monthly_decision_20260225.json`（本線 `r3u` 基準へ再同期）
      - 現況:
        - `r3u`: `verdict=INVALID_TRIAL`, `window_days=0.3925358163425926`, `closed_positions=0`, `watchdog.window_hours=9.420859592222223`
        - `expA`: `verdict=INVALID_TRIAL`, `window_days=0.3870921385416667`, `closed_positions=0`, `watchdog.window_hours=9.290211325`
      - 判定:
        - `r3u/expA` の judge threshold は双方 `min_closed_positions=12` に統一。
        - 本線 `r3u` の `v50_8_monthly_decision_20260225.json` は `decision=NO_GO` 継続。
  - `V50.8-P6` 追補（2026-02-25, IH monthly10ゲート）:
    - 既存forward 3ランを `tools/mt5_ih_promotion_gate.py`（`monthly>=10%`）で一括評価し、`data/reports/v50_8_mt5_monthly10_scan_20260225.json` を生成。
    - 判定は `accepted_count=0`。best は `ih_opt_monthly3_20260224_224129` でも `monthly_cagr_pct=2.3078`（`trades=3`, `PF=0.0`）。
    - `ih_opt_monthly10_20260225_001800_utf16.ini` 起動は Terminal log で確認済み（`2026-02-25 14:06:44 JST` 初期化、`14:06:52 JST` testing started）。
    - `logs/mt5_monthly10_wait_and_gate_20260225_215746.log` で `reports detected, running gate` を確認し、判定 `data/reports/mt5/ih_opt_monthly10_20260225_001800.decision.json` を生成。
    - 判定は `accept_for_promotion=false`（`monthly_cagr_pct=2.2477`, `trades=3`, `PF=0.0`, `DD=11.0348`）。
    - `v50_8_mt5_monthly10_scan_20260225.json` を再生成し、`decision_files=4` へ更新（`accepted_count=0` 維持）。
    - runtime進捗スナップショット `data/reports/v50_8_monthly10_runtime_status_20260225.json` は `latest_progress_pct=99`（`07:42 JST`）、`completed=true`。
    - `ih_opt_monthly15_20260225_152054` は完了（2026-02-26 17:14 JST gate完了）。
      - `logs/mt5_monthly15_wait_and_gate_20260226_084916.log` で `reports detected, running gate` を確認。
      - 判定: `data/reports/mt5/ih_opt_monthly15_20260225_152054.decision.json`
      - 結果: `accept_for_promotion=false`（`monthly_cagr_pct=2.2929`, `trades=3`, `PF=0.0`, `DD=10.7971`）。
      - runtime: `data/reports/v50_8_monthly15_runtime_status_20260226.json` は `completed=true`。
  - `V50.8-P6.3` 追補（2026-02-26, KPI 3%再判定）:
    - 既存5ランへ `min_monthly_return_pct=3.0` を適用して再評価。
    - 成果物:
      - `data/reports/mt5/*.monthly3target.decision.json`（5件）
      - `data/reports/v50_8_mt5_monthly3target_scan_20260226.json`
    - 結果:
      - `accepted_count=0`（`decision_files=5`）
      - best は `ih_opt_monthly3_20260224_224129.monthly3target.decision.json`（`monthly_cagr_pct=2.3078`, `trades=3`, `PF=0.0`）。
  - `fix7b` は guardian 側 `Broken pipe (os error 32)` により出力欠損（`FAILED_PARTIAL`）だが、B1R達成判定は `fix10` 系成果物を正本とする。
- **Rust (Guardian)**: `V15.x` Full Duplex, Risk Gate実装済み。Daily Loss Limit: -¥5000。
- **MQL5 (Bridge)**: `V15.2` Multi-TF対応。
- **Lisp (Brain/School)**: `V50.6` Pure Lisp Daemon。SQLite移行完了。
- **Multi-Symbol Evolution**: `swimmy.core::*supported-symbols*`（既定 `USDJPY/EURUSD/GBPUSD`）を「進化・候補生成の対象」として扱う。起動時の Founder 注入（`recruit-special-forces`）は supported symbols ごとに Founder を展開し、`strategy.symbol` を正しく付与して backtest を回す（EURUSD/GBPUSD が `A Candidate Funnel` に出ない問題の正本修正）。
  - **Symbol Name Contract (P12.5)**: symbol override で生成する Founder 変種は、名前にも symbol を含める（例: `...-EURUSD`）。これにより `check-symbol-mismatch` が「名前とsymbolの取り違え」を実際にブロックできる。
  - **Duplicate/Correlation Scope**: `add-to-kb` / Founder preflight の correlation screening（Jaccard/Highlander）は **(timeframe × direction × symbol) の同一カテゴリ内のみ**で適用し、**同一ロジックの multi-symbol 展開**（例: USDJPY と EURUSD）をブロックしない。
- **MCP Gateway**: read-only/backtest-execのみ有効。trade-capableは封印（403固定）。
- **Backtest Service**: Python ZMQサービス（`SWIMMY_BACKTEST_SERVICE=1` 時に有効）。BrainからのBACKTESTを 5580 で受信し、結果を 5581 で返却。
- **Lifecycle**: Rank（Incubator/B/A/S/Legend/Graveyard/Retired）が正義。Tierロジックは廃止（保存はRankディレクトリ）。
- **Timeframe Canonical Contract**: 戦略の内部時間足は **分（minutes, int）** を正本とする。既定スコープは 8TF バケット（`5/15/30/60/240/1440/10080/43200`）だが、進化/バックテスト探索では任意TF（例: `36/120/300/3600` 分）を許容する。カテゴリ分割・相関判定・Pattern Gate 判定は有限バケットへ正規化して扱い、探索候補集合は budget 制御で上限化する。
- **Aux Services**: Data Keeper / Notifier / Risk Gateway / Pattern Similarity Service / Inference Worker は **S式 + schema_version=1** のみ受理（ZMQでJSONは受理しない）。
- **Dispatcher S式 bool互換契約**: `safe-read-sexp` / `internal-process-msg` は Rust `serde_lexpr` 由来の `#t/#f` を `t/nil` と同義で受理し、sharp-boolean を含む受信S式を `Unsafe/invalid SEXP` として誤棄却しない。
- **Dispatcher invalid S式可観測性契約**: `Unsafe/invalid SEXP` ログには payload 先頭プレビュー（`head`）を含め、破損入力の発生源をログだけで特定できる状態を正本とする。
- **Polymarket OpenClaw（任意）**: Polymarket（予測市場）向けの自動エントリーサブシステム。cycle/signal-sync は user systemd、status/notifier は systemd(system) を使用し、成果物は `data/reports/polymarket_openclaw_live/` に保存する（FX コアとは独立）。
- **XAU AutoBot（任意・別系統）**: FXコア（Rust/Lisp）とは独立した MT5 補助運用。`Swimmy-XAU-Cycle` は最適化/プローブ/active config 更新のみを担当し、**実注文の正本は `Swimmy-XAU-Exec`（ONLOGON）または Startup launcher (`Swimmy-XAU-Exec.vbs`) で `tools/windows/xau_autobot_live_loop.ps1 -Live` を常駐起動すること**。`-Live` 未指定は `dry_run` となり注文は送信されない。
- **XAU Trial Isolated-Metrics 契約（V50.8-P5.4/P5.6）**: trial 判定は `magic + comment_prefix` 一致データのみを正本とし、他 run（`live_named_*`/`uncorr_*` 等）の並走を許容する。fail-closed 対象は「trial対象 run の不在・設定不整合（magic/comment）」であり、非trial run の存在自体は異常扱いにしない。
- **XAU Trial Zero-Trade Fail-Closed 契約（V50.8-P5）**: trial 実運用は `window_hours>=24` かつ `closed_positions<=0` を検知した時点で `NO_GO` とし、同一設定の継続を禁止する。`tools/xau_autobot_trial_watchdog.py` を正本監視とし、条件成立時は次候補configへの自動ローテーション（run_id再発行 + live loop再起動）を許可する。
- **XAU Trial Dual-Run 契約（V50.8-P5.5）**: `r1`（本線・KPI判定）と `r2`（探索・約定発生優先）を並走可能とする。`r1` は `data/reports/xau_autobot_trial_v2_current_run.json` を正本、`r2` は `data/reports/xau_autobot_trial_v2_current_run_r2.json` を副本とし、lock file も分離する。KPI最終判定は `r1` の trial judge を正本にし、`r2` は切替判定材料として扱う。
- **XAU MT5 Comment Length 契約（V50.8-P5.6）**: `xau_autobot.py` の発注 comment は MT5 制約に合わせて **31文字以下**を必須とする。31文字超の comment は fail-closed（起動/最適化時にエラー）とし、`ORDER_SEND` での `Invalid "comment" argument` を再発させない。加えて trial 集計の `comment_prefix` は MT5履歴側の実効値に合わせ **先頭16文字**を正本とする。
- **XAU Trial Comment-Prefix Continuity 契約（V50.8-P5.15）**: magic を再利用する run ローテーションでは、comment_prefix を不用意に変更しない。変更が必要な場合は `magic` も同時に更新する。`magic` だけ一致して `comment_prefix` が不一致の約定を大量発生させる状態（`after_magic_filter>0` かつ `after_comment_prefix_filter=0`）を運用上の不整合として扱う。
- **XAU Trend Gap Range Gate 契約（V50.8-P5.15）**: `xau_autobot.py` はエントリー判定前に `ema_gap_over_atr = abs(ema_fast - ema_slow) / atr` を算出し、`min_ema_gap_over_atr <= ema_gap_over_atr <= max_ema_gap_over_atr` のレンジ外は `HOLD/BLOCKED` として新規発注しない。既定値は `0.9..2.5`（弱トレンド誤爆と過伸展逆行の両端を回避）を正本とし、configで上書き可能とする。
- **XAU Trial KPI Split 契約（V50.8-P5.15）**: trial judge は `trial_valid`（identity整合）と `NO_GO/GO` 判定を分離し、KPIを `readiness`（`window_days` と `closed_positions`）と `performance`（`PF/WR/net_profit`）に分割して出力する。既定の readiness 件数は `closed_positions>=12`（14日窓）を正本とし、`XAU_AUTOBOT_TRIAL_MIN_CLOSED_POSITIONS` で厳格値（例:14）へ上書き可能とする。
- **XAU Gap Gate Runtime Metrics 契約（V50.8-P5.16）**: `xau_autobot.py` は各サイクルpayloadに `runtime_metrics`（`gate_check_count`, `gate_reject_gap_count`, `gap_reject_rate`, `signal_counts`）を累積同梱する。`gate_check_count` は gap 判定を実行したバーのみを加算し、`gate_reject_gap_count` は `reason=ema_gap_out_of_range` のときのみ加算する。
- **XAU Trial Summary Close-Reason 契約（V50.8-P5.16）**: `xau_autobot_live_report.py` の summary は closed positions の `close_reason_counts`（`tp/sl/other`）と `tp_sl_ratio`、`closed_per_day` を出力する。`net_profit` は従来どおり closed positions のみを正本にする（floating損益を混在させない）。
- **XAU Operational Audit Gate 契約（V50.8-P5.17）**: `tools/xau_autobot_operational_audit.py` は既定3日窓で 4 指標を監査し、`gap_reject_rate=0.15..0.45`, `tp_sl_ratio>=0.7`, `closed_per_day>=0.7`, `expectancy>0` を PASS 基準とする。データ不足時は `status=INSUFFICIENT_DATA` を返し、推測で合否を確定しない。
- **XAU Runtime Journal 契約（V50.8-P5.17）**: `xau_autobot.py` は実行payloadに `timestamp_utc` を付与し、`XAU_AUTOBOT_RUNTIME_JOURNAL_PATH`（既定: `data/reports/xau_autobot_runtime_journal_latest.jsonl`）へ JSONL 追記する。journal書き込み失敗は取引ロジックを停止させず、`WARN` 可観測化で継続する。
- **XAU Runtime Metrics 連続性契約（V50.8-P5.18）**:
  - runtime journal の既定保存先は `tools/xau_autobot.py` の repo-root から解決した `data/reports/xau_autobot_runtime_journal_latest.jsonl` とし、実行cwd依存の相対解決を正本から外す。
  - `xau_autobot_live_report.py` は `runtime_metrics`（`gate_check_count/gate_reject_gap_count/gap_reject_rate/signal_counts`）を top-level に同梱し、`runtime_metrics_source` を併記する。
  - `xau_autobot_operational_audit.py` は runtime journal に snapshot がない場合、live report の `runtime_metrics` から fallback 集計し、`runtime_metrics.source=live_report.runtime_metrics` を明示する。
- **XAU Runtime Metrics Source Priority 契約（V50.8-P5.19）**:
  - 監査の runtime 集計は `journal` を正本ソースとし、`journal.snapshot_count==0` の場合のみ `live_report.runtime_metrics` へフォールバックする。
  - 監査出力に `runtime_metrics_source` と `runtime_metrics_fallback_reason`（例: `journal_snapshot_count_zero`）を必須出力する。
  - live report が保持する runtime snapshot には `snapshot_time_utc/run_id/magic/schema_version` を含める。
- **Structured Telemetry**: `/home/swimmy/swimmy/logs/swimmy.json.log` にJSONL統合（`log_type="telemetry"`、10MBローテ）。
- **Telemetry Write Fallback**: 主要ログ `/home/swimmy/swimmy/logs/swimmy.json.log` へ書けない場合は `data/memory/swimmy.telemetry.fallback.jsonl` へフォールバックし、イベントロストを抑止する。
- **Execution Spread/Slippage Telemetry**: 注文時の `entry_bid/entry_ask/spread_pips` をログ化し、`TRADE_CLOSED` に `entry_price` が含まれる場合はスリッページ(pips)も算出・記録する。スプレッドが上限超過の場合は `execution.spread_reject` として拒否理由を記録する。
- **TRADE_CLOSED 文脈契約**: `TRADE_CLOSED` は最小学習キー（`direction/strategy_name/category`）を同梱する。受信側（Executor）は payload を正本として処理し、slot allocation キャッシュ補完に依存しない。
- **Execution Slot Allocation 契約**: 実行スロット管理の正本語彙は `slot` とし、`warrior` 呼称は廃止する。互換目的の旧識別子は段階的移行のためにのみ残し、新規実装では使用しない。
- **Trade Close Notification 契約**: 約定クローズ通知は fixed template（構造化テキスト）を正本とし、`generate-trade-result-narrative` 依存の物語通知は live 経路で使用しない。
- **Live Trade-Close Integrity 監査契約**: 運用監査は `tools/check_live_trade_close_integrity.py` を用いて、(1) `trade_logs` の `strategy_name/direction/category` が `Unknown/NIL` に劣化していないこと、(2) `swimmy.log` に `Unsafe/invalid SEXP ... POSITIONS` が再発していないこと、を継続確認する。`tools/system_audit.sh` でも同監査を WARN ステップとして実行する。履歴データを除外する必要がある場合は `LIVE_TRADE_CLOSE_AFTER_ID` で `id <= baseline` を無視できる。`DB not found` / `trade_logs` クエリエラーは WARN に落とさず FAIL（exit 1）として扱う。
- **Live Trade-Close 連続監視契約**: 実トレード発生待ちの間は `tools/watch_trade_close_loop.sh` を使って `tools/watch_trade_close_integrity.py` をタイムアウト再試行し、`success(0)` または `violation(1)` が出るまで監視を継続できる状態を維持する。
- **Edge Scorecard 契約（V50.7-P0）**: `tools/edge_scorecard.py` は日次 KPI（KPI-0: Live Edge Guard準拠、KPI-1: 7日/30日PnL健全性、KPI-2: Rank conformance違反、KPI-3: Breeder親品質率）を `data/reports/edge_scorecard_latest.json` と履歴 `data/reports/edge_scorecard/` に保存する。入力データ欠損時は例外停止せず `status=degraded` と理由を出力し、監視を fail-open 可観測化する。
- **Edge Scorecard KPI 定義契約（V50.7-P3）**:
  - KPI-0（Live Edge Guard準拠）: `deployment_gate_status` の `decision` 集計を正本とし、`LIVE_READY` 件数が 0 の場合は `degraded` とする。
  - KPI-1（実運用PnL健全性）: `trade_logs` の 7日/30日窓を正本とし、30日窓で `PF<1.05` / `WR<35%` / `net_pnl<0` / `max_loss_streak>3` のいずれかで `degraded` とする。
  - KPI-2（Rank conformanceドリフト）: `rank_conformance_latest.json` の `violations.total` を正本とし、`total>0` で `degraded` とする。
  - KPI-3（Breeder親品質率）: `strategies` の `B/A/S` を対象に `check_rank_conformance.meets_rank_criteria` で判定し、`pass_count<total_count` の rank が1つでもあれば `degraded` とする。
  - Overall 判定: `k0..k3` がすべて `ok` のときのみ `overall_status=ok`。それ以外は `overall_status=degraded`。
- **System Audit Edge Scorecard 契約（V50.7-P1）**: `tools/system_audit.sh` は `tools/edge_scorecard.py` を WARN ステップとして実行し、日次 `swimmy-system-audit.timer` で `Edge scorecard summary` を監査ログへ残す。scorecard 失敗は system audit 全体を即FAILにせず WARN 扱いで可観測化する。
- **Edge Scorecard Discord 通知契約（V50.7-P2）**: `tools/edge_scorecard.py` は `--discord-when=problem` のとき `overall_status in {degraded, critical}` でのみ通知をキューし、`overall_status=ok` は通知しない。通知経路は Notifier PUSH（`SWIMMY_PORT_NOTIFIER`/既定5562）を正本とし、webhook は `EDGE_SCORECARD_DISCORD_WEBHOOK` または `EDGE_SCORECARD_DISCORD_WEBHOOK_ENV`（既定 `SWIMMY_DISCORD_ALERTS`）から解決する。
- **Edge Scorecard 専用タイマー契約（V50.7-P4）**: `swimmy-edge-scorecard.timer` / `swimmy-edge-scorecard.service` を追加し、`tools/edge_scorecard.py` を systemd から単独実行できる状態を維持する。`system_audit` 統合とは独立に `edge_scorecard_latest.json` と履歴を日次更新できることを正本とする。
- **Edge Scorecard installer scope 契約（V50.7-P4.1）**: `tools/install_edge_scorecard_service.sh` は `SWIMMY_SYSTEMD_SCOPE=system|user` を受理し、`system` は `/etc/systemd/system`（root必須）、`user` は `~/.config/systemd/user`（非root可）へ unit を配置できる。`user` 運用時は `systemctl --user` 経由で `daemon-reload/enable/status` を実行する。
- **Edge Scorecard unit 権限契約（V50.7-P4.2）**: `systemd/swimmy-edge-scorecard.service` の正本は system scope 運用（`User=swimmy`、`Group=` 固定なし）とし、`tools/install_edge_scorecard_service.sh` は `SWIMMY_SYSTEMD_SCOPE=user` のとき配置先 unit から `User=`/`Group=` を除去した user-scope 互換コピーを生成する。これにより user manager での `Failed to determine supplementary groups (status=216/GROUP)` を回避する。
- **ORDER_OPEN コメント契約**: `comment` はトップシグナル戦略の実行文脈（`strategy_name|tf_key`）を送る。`NIL` 名や「文脈欠落による `M1` フォールバック」をコメントへ出さない。`M1` は戦略TFが実際に1分足のときのみ許容する。
- **Execution Fail-Closed 契約**: 実行文脈（`strategy_name` / `timeframe`）が欠落・不正な場合は、`NIL` や既定TFへ丸めずに**発注を中止**する。`NIL` で先に進むフォールバックを禁止する。`timeframe="NIL"` / 空文字 / 不正ラベル（例: `"UNKNOWN"`）は「不正な時間足」として fail-closed 対象にする。
- **Live Execution Go/No-Go 強制契約**: `process-category-trades` / `execute-category-trade` は Rank（B/A/S）のみで live 発注可否を決めない。`deployment_gate_status.decision == "LIVE_READY"` の戦略のみ live 実行を許可し、`BLOCKED_OOS/FORWARD_RUNNING/FORWARD_FAIL/未登録` は fail-closed で中止する（研究評価と実運用判定を完全分離）。
- **Live 実行経路の Rank件数ゲート禁止契約**: live 実行経路は「S-rank本数」などの rank件数しきい値で全体停止しない。実行可否は戦略単位の `deployment_gate_status`（`LIVE_READY`）と runtime `Live Edge Guard` を正本とする。Rank件数は監視KPI用途に限定し、発注の前段ブロッカーとしては使わない。
- **Live Edge Guard 契約（実行時）**: `deployment_gate_status=LIVE_READY` でも直近 LIVE 実績（既定: 最新40件、判定最小20件）を再審査し、`PF>=1.05` / `WR>=35%` / `net_pnl>=0` / `latest_loss_streak<=3` を満たさない戦略は fail-closed で発注を中止する。ブロック時は Discord alert と `execution.live_edge_blocked` telemetry を出力する。
- **Unknown/NIL 戦略文脈 fail-closed 契約**: 実行文脈の `strategy_name` は `NIL/UNKNOWN/NULL/NONE/空文字` を不正値として扱い、時間足が有効でも発注しない。`execution.context_missing` と同等に可観測化し、`Unknown` の学習データ混入を抑止する。
- **ORDER_OPEN Sink Guard 契約**: `safe-order` / `make-order-message`（Sender）と `SwimmyBridge ORDER_OPEN`（Receiver）は `comment` を厳格検証し、`strategy|tf` 形式不正（区切り欠落、strategy/timeframe 欠落、`NIL` 含有）を検知した場合は `SW-<magic>` 等へフォールバックせず fail-closed で中止する。
- **Fail-Closed 可観測性契約**: fail-closed で発注を中止した場合は、`notify-discord-alert` による運用アラートと `execution.context_missing` telemetry を同時出力し、運用者が即時検知できる状態を正本とする。
- **Local Storage**: `data/backtest_cache.sexp` / `data/system_metrics.sexp` / `.opus/live_status.sexp` をS式で原子保存（tmp→rename）。`backtest_cache/system_metrics` は `schema_version=1`、`live_status` は `schema_version=2`。
- **Daily PnL Aggregation**: `strategy_daily_pnl` を日次集計（00:10 JST）、非相関スコア計算に使用。
- **Graveyard/Retired 指標**: Evolution Report は DB（`get-db-rank-counts`）を正本、Libraryファイル数はドリフト検知に使用。
  - **Report表示**: Graveyard/Retired は DB値を表示しつつ、Libraryとの差分（ドリフト）も併記する（「数がリセット」誤解を防ぐ）。
  - **Drift内訳表示**: `Source Drift` は **canonical（GRAVEYARD+RETIRED の unique-name）を主指標**とし、`delta(DB-LibraryCanonical)` を正本の差分として表示する。Libraryは同名ファイルが `GRAVEYARD/` と `RETIRED/` の両方に残ることがあり、その場合 **raw dir count は overlap 分だけ二重計上**されるため、per-dir の `delta(DB-Library)` は誤読（「数がリセット」等）を誘発しやすい。従って drift 判定は canonical を優先し、raw は `overlap` とセットで説明目的に限定する。
  - **ドリフト修復**: `tools/ops/reconcile_archive_db.py` で `data/library/GRAVEYARD/`・`data/library/RETIRED/` をスキャンし、DBへ backfill / rank補正できる（非破壊、ただし大量更新のため運用タイミングに注意）。
  - **ドリフト修復の実行安定化**: 稼働中に archive ファイルが増減する環境では、`reconcile_archive_db.py` の `--grace-sec` で直近更新ファイルを保留してから補正する。`--grace-sec` の既定は `0`（無効）で、指定時は `mtime > (scan_start - grace_sec)` の archive を今回スキャン対象から除外する。これにより実行中レースで `wrong_rank` が再発し続ける現象を抑制する。
  - **ドリフト修復（自動）**: `swimmy-archive-reconcile.timer`（systemd, system scope）を `enabled` にして定期実行し、`reconcile_archive_db.py` による DB rank補正 / backfill / DB-only archive prune を自動化する。運用の既定は `--no-data-sexp`（DB肥大抑制）+ `--grace-sec`（レース緩和）+ `--prune-db-only`（backup table 退避後に prune）で、ログは `logs/archive_reconcile.log` に追記する。
  - **Archive Migration 読み込み耐性**: `migrate-existing-data` の graveyard 読み込みは行単位 `safe-read-sexp` で実行し、壊れた行をスキップして継続する。先頭5件まで `Skip malformed graveyard line` を記録し、1行の破損で全体 migration が停止しないことを正本とする。
  - **B再シード運用**: Active母集団が archive 偏重で枯渇した場合、`tools/ops/reseed_active_b.py` で `:GRAVEYARD/:RETIRED` から Stage1 B 基準通過戦略をカテゴリ（TF×Direction×Symbol）ごとに上位N抽出し、`:B` へ復元する。復元時は DB ランク更新と Library ファイル移動（`GRAVEYARD/RETIRED -> B`）を同時適用する。
    - **権限差分耐性**: strategyファイルの `:RANK/:STATUS` 書換は in-place ではなく `tmp書込 -> os.replace` の原子置換で行い、root所有ファイル混在時でもディレクトリ書込権限があれば再シードを継続できる。
    - **重複名競合の解決規約**: 同名ファイルが `B/` と archive (`GRAVEYARD/RETIRED`) の両方に存在する場合は `B/` 側を正とし、reseed 時に `:B` への DB昇格を継続する（conflictで丸ごとスキップしない）。
  - **Archive Rank 保護**: DB既存ランクが `:GRAVEYARD/:RETIRED` の場合、通常の `upsert-strategy` で `NIL/Active` に戻さない（明示的なランク遷移のみ許可）。
- **Graveyard Avoidance (P3)**: `analyze-graveyard-for-avoidance` は巨大な `data/memory/graveyard.sexp` をストリーム処理し、途中の破損フォーム（例: `unmatched close parenthesis`）で全体を中断せずにスキップして継続する。結果は `SWIMMY_GRAVEYARD_AVOID_CACHE_SEC`（既定300秒）でキャッシュし、Breeder が child 生成ごとにファイル全走査しないことを正本とする。**Read error のログは条件オブジェクトを丸ごと print せず**、`File-Position/Stream` 等の詳細を出さない（巨大ファイルの破損位置でログ出力自体が大規模割り当てになり OOM するのを防ぐ）。
- **Top Candidates 表示**: Evolution Report の Top Candidates は **Active候補のみ**（Graveyard/Retired除外）。DBの `rank=NIL` は表示上 `INCUBATOR` として扱う（NILをそのまま出さない）。
  - 並び順は `evidence-adjusted-sharpe(sharpe, trades)` を正本とし、表示は `S=<adjusted> (raw <raw>)` とする（`trades` 欠損は 0 扱い）。
- **CPCV Status 表示**: 複数Lispデーモン間で「送信」と「受信」が分離するため、CPCVステータスは `data/reports/cpcv_status.txt` を正本として表示する（`last_start_unix` を保持して N/A を避ける）。
  - **reason伝播**: `cpcv_status.txt` の `updated: ... reason: <reason>` が存在する場合、Evolution Report の `CPCV Status` 行にも reason を表示する（`no-candidates` と runtime/criteria 失敗を誤読しないため）。
  - **failed内訳**: `failed` は `send_failed + result_failed` の合算で、`result_failed` は `runtime` と `criteria` の内訳を表示する。
  - **結果分類**: `CPCV_RESULT` は `error` がある場合に `runtime` 失敗として扱う。加えて `path_count/passed_count/failed_count` がすべて 0 の結果は `error` 未付与でも **無効結果** とみなし、`criteria` ではなく `runtime` 失敗として扱う。
  - **通知対象**: CPCV個別通知は既知戦略（KBまたはDBに存在する `strategy_name`）のみ送信し、未知戦略名の結果はメトリクス/履歴には残しても Discord alert は送信しない。
  - **履歴CSV耐性**: CPCV個別通知は `data/logs/cpcv_history.csv` にも記録するが、`median_sharpe/pass_rate` などの数値が欠落・`NIL` の場合でも 0.0 として記録し、通知/受信ループを `Msg Error` で落とさない。
- **CPCV Validate (評価条件)**: Guardian の `CPCV_VALIDATE` は `strategy_params` の `indicator_type/timeframe/filter_*` を解釈して（可能なら）Backtestと同等の条件でCPCVを評価する（timeframe>1はResample、filter有効時は同一データからauxを生成してMTF filter適用）。
- **CPCV Validate メモリ契約**: Guardian の `CPCV_VALIDATE` は 1リクエスト内で `candles_file` を1回だけロードし、各 path/range 評価は同一 candle バッファのスライスを再利用する。pathごとのCSV全件再読込を禁止する。
- **CPCV Validate (S式キー解釈)**: Guardian は `CPCV_VALIDATE` のトップレベルキーを正規化して解釈する（`action` だけでなく `swimmy.school::action` / `swimmy.school:action` など package 修飾キーも受理）。
- **OOS Queue 計上**: `sent/retry` は「Backtest dispatch を受理した要求」のみ計上する。送信拒否/スロットル時は `sent` に残さず `error` として再試行対象に戻す。
- **OOS Status 表示**: `oos_status.txt`/Evolution Report の OOS 行は、`report-oos-db-metrics`（DB集計）に加えて `report-oos-failure-stats`（`data/send/db`）と `report-oos-metrics`（latency avg/min/max）を表示し、固定ゼロ値を出さない。
- **OOS 固定期間契約**: A向け OOS dispatch は `*oos-test-ratio*` の可変比率を正本にせず、`*oos-fixed-window-days*`（既定180日）で `end_ts - window` を基準に算出する。データが短い場合は利用可能な最古timestampまでを OOS 開始とし、範囲欠落で dispatch 失敗にしない。
- **Armada Replica OOS再ランク契約（V50.7-A10）**: `tools/ops/armada_player_replica.py` は `--oos-rerank-pool`（既定 `0`）を受理する。`no-oos` ではなく、かつ `oos-rerank-pool > top-per-player` の場合に限り、BT `selection_score` 上位 N 件（N=`oos-rerank-pool`）へ先行 OOS 評価を実施し、`oos_ok` 優先のキー（`oos_ok -> OOS PF -> OOS Sharpe -> OOS trades -> selection_score -> replica_score`）で再ランクして最終 `top-per-player` を確定する。`cpcv` は最終選抜後の候補に対してのみ評価する（pool全件には適用しない）。
- **実運用 Go/No-Go 契約（Rankと分離）**: Rank（B/A/S）は研究評価、ライブ投入可否は `deployment_gate_status` を正本として判定する。最小契約は `OOS pass` + `forward_days>=30` + `forward_trades>=300` + `forward_sharpe>=0.70` + `forward_pf>=1.50`。判定は `BLOCKED_OOS` / `FORWARD_RUNNING` / `FORWARD_FAIL` / `LIVE_READY` を使う。
- **Forward Evidence Source 契約**: `forward_trades/forward_sharpe/forward_pf` は paper-forward を正本とし、`trade_logs.execution_mode` の `SHADOW/PAPER` を優先的に集計する。互換目的で `LIVE` も含められるが、`LIVE_READY` 判定に「LIVE実績のみ」を必須条件として使わない（循環ゲート防止）。
- **Shadow Paper Timeout Close 契約**: `close-a-rank-shadow-positions` は `SL/TP` 到達に加え、`opened_at` から `*shadow-max-hold-seconds*`（既定 3600 秒）を超えた shadow slot を timeout close し、`execution_mode=:shadow`・`hit=:timeout` で `trade_logs` に記録する。これにより shadow 証拠が「未決済滞留」で停止し続けない状態を正本とする。
- **Forward Status 表示**: `data/reports/forward_status.txt` を正本として保持し、Evolution Report に Forward Go/No-Go 集計（LIVE_READY件数、FORWARD_RUNNING件数、失敗理由）を表示する。
- **Legacy WFV 隔離契約**: WFV（`_IS/_OOS`）は分析専用とし、`move-strategy` / Rank遷移 / archive移動に関与させない。既定は `*wfv-enabled*=nil` で、明示有効化時も「分析テレメトリの記録」のみ許可する。
- **Notifications**: Max Age Retirement と Stagnant C-Rank の `Strategy Soft-Killed (Cooldown)` は個別通知を抑制し、**1時間ごと**に「合計件数＋上位5件名」でサマリ送信。
- **School Heartbeat Tick**: `data/heartbeat/school.tick` は School の独立tick（既定60秒）で更新する。長時間サイクル中でも heartbeat を更新し、Evolution report staleness alert の `heartbeat_age` がサイクル完了待ちで誤検知しないようにする。
- **School Wisdom Cadence**: `phase-7-wisdom-update` は毎サイクル実行しない。`SWIMMY_WISDOM_UPDATE_INTERVAL_SEC`（既定1800秒）で間隔制御し、重い `analyze-veterans` を常時経路から外す。
- **School Rank Evaluation Cadence**: `phase-4-purge` の `run-rank-evaluation` は毎サイクル実行しない。`SWIMMY_RANK_EVAL_INTERVAL_SEC`（既定60秒）で間隔制御し、初回は即時実行・interval 未満はスキップする（毎秒ループでの A/B 昇降格スラッシングを抑止）。
- **School Wisdom メモリ契約**: `analyze-veterans` は `unique-strats/candidates/copy-list+sort` の大規模中間リストを作らず、単一パス（de-dup + filter）で `Top-N`（既定50）だけを保持する。大量KB時の一時メモリ膨張を抑える。
- **Pattern Similarity Client Timeout 契約**: Lisp REQ client timeout は `SWIMMY_PATTERN_SIMILARITY_TIMEOUT_MS`（ms, 既定30000）を正本とし、`<1000` は `1000` へ丸める。サービス遅延時の即時 `EAGAIN` 連打で gate が常時 `UNAVAILABLE` になる状態を抑制する。timeout/error 時は REQ socket を再接続して同一 `QUERY` を1回だけ再試行し、再試行も失敗した場合のみ `GATEWAY_UNREACHABLE` を返す。
- **Pattern Similarity Query Metrics 契約**: `tools/pattern_similarity_service.py` は `QUERY` ごとの処理時間を rolling window で集計し、`STATUS.query_metrics` として `count/ok_count/error_count/avg_ms/p50_ms/p95_ms/max_ms/last_ms/last_error/updated_at` を返す。window は `SWIMMY_PATTERN_QUERY_METRICS_WINDOW`（既定200）で制御し、遅延源の可観測性を維持する。
- **Pattern Similarity Startup Liveness 契約**: `tools/pattern_similarity_service.py` は起動時に `:5564` REP socket を先に bind し、`data/patterns/` の初期 index load はバックグラウンドで継続する。初期ロード状態は `STATUS.index_loader`（`status/started_at/finished_at/loaded/error`）で可視化し、ロード完了前の `QUERY` は `No index for symbol/timeframe` を返して fail-closed する（service 自体は応答不能にしない）。
- **Pattern Similarity Backend Warmup 契約**: embedding backend（clip/vector）の初期化は起動時バックグラウンドで行い、状態を `STATUS.backend_loader`（`status/started_at/finished_at/clip_ready/vector_ready/error`）で可視化する。`QUERY` 経路で cold-load を同期実行して応答を長時間ブロックしない。
- **Pattern Similarity Backend Degradation 契約**: `QUERY` は重み付き優先 backend が load中/失敗で利用できない場合でも、他 backend が利用可能なら fail-soft で等重みフォールバックする。全backendが利用不可のときのみ `search error: no usable backend` を返す。
- **KB統合収集の計算量契約**: `collect-all-strategies-unpruned` は DB + Library の重複統合を `strategy_name` ハッシュ集合で処理し、重複除外を O(n) で維持する。重複名がある場合は DB 側を正として保持する。
- **Strategy Lookup Index 契約**: `init-db` は `strategies` に `idx_strategies_rank_sharpe (rank, sharpe)` と `idx_strategies_category_rank (timeframe, direction, symbol, rank)` を必須作成し、ランク検索とカテゴリ別選抜の全表走査を回避する。
- **Evolution Daemon 表示**: Evolution Report の `System Status` 行は固定文言ではなく、`systemctl is-active swimmy-evolution.service` を正本に表示する。`systemctl` 取得不能時のみ heartbeat 更新時刻で補助判定し、停止中に `Active` と誤表示しない。
- **Evolution Report 保存先**: レポート保存は `*evolution-report-path*` を正本とし、`write-evolution-report-files` は固定パスを直接書かない。テスト/運用で保存先をバインド可能にして本番 `data/reports/evolution_factory_report.txt` の意図しない上書きを防ぐ。
  - **テスト隔離**: `run-all-tests` は `*evolution-report-path*` を `data/memory/swimmy-tests-evolution-report.txt` へバインドし、本番レポートを汚染しない。
- **Test Telemetry 隔離契約**: `deftest` 実行は単体呼び出し（`(swimmy.tests::test-...)`）でも telemetry 出力先を `data/memory/swimmy-tests-telemetry*.jsonl` にバインドし、本番 `logs/swimmy.json.log` へテスト由来 WARN/telemetry を混入させない。
- **Backtest Status 保存先**: `maybe-log-backtest-recv` の backtest status 書き込み先は `swimmy.main::*backtest-status-path*` を正本とし、固定パス `data/reports/backtest_status.txt` を直接書かない（テスト/監査で保存先をバインド可能にして本番 status を汚染しない）。

## 決定事項
- **アーキテクチャ**: Rust Guardianを中心としたハブ＆スポーク。
- **永続化**: SQLite (`swimmy.db`) と Sharded Files (`data/library/`) のハイブリッド。
- **サービス管理**: Systemdによるコア4サービス＋補助サービス体制。
- **System Audit**: `tools/system_audit.sh` を正本とし、systemd(system) を監査・自動修復（daemon-reload + enable + restart）。`DRY_RUN=1` で修復をスキップ。`SUDO_CMD` で sudo 実行方法を上書き可能（例: `SUDO_CMD="sudo"` で対話式許可）。`sudo -n` が使えない環境でも `systemctl` 直実行で監査を継続し、監査自体をスキップしない。**このフォールバック自体は運用上正常であり WARN にしない**（健康状態のWARNはサービス/監査項目の実体に限定）。`.env` を自動読み込みして Discord 設定を拾う。
  - **Live Trade-Close 監査パラメータ**: `LIVE_TRADE_CLOSE_DB` / `LIVE_TRADE_CLOSE_LOG` / `LIVE_TRADE_CLOSE_LOOKBACK_MINUTES` / `LIVE_TRADE_CLOSE_TAIL_LINES` / `LIVE_TRADE_CLOSE_AFTER_ID` / `LIVE_TRADE_CLOSE_REQUIRE_RECENT_TRADES` を `tools/system_audit.sh` から `tools/check_live_trade_close_integrity.py` に引き渡す。通常は historical 不良行を避けるため `LIVE_TRADE_CLOSE_AFTER_ID=<baseline_id>` を使う。
  - **Polymarket OpenClaw（任意）**: `swimmy-polymarket-openclaw.timer` が `enabled` のときのみ `tools/polymarket_openclaw_status.py --fail-on-problem` を監査に含める。timer が無効（`disabled/static/not-found` 等）なら OpenClaw は「意図的に無効化」とみなし、監査は `SKIP (disabled)` 表示で WARN にしない（stale 誤検知を防ぐ）。
    - **Statusのdisabled扱い**: `tools/polymarket_openclaw_status.py` は cycle timer が `enabled` でない場合 `Health: disabled` として扱い、`--fail-on-problem` 指定でも exit 0 とする（OpenClaw停止中に status ファイルが更新されず stale になるのは仕様のため）。
  - **sudo -n 不可フォールバック**: `sudo -n` が使えない場合でも監査は `systemctl` 直実行（status-only）で継続し、**フォールバック自体は WARN にしない**。修復（enable/restart）が必要な運用では `SUDO_CMD="sudo"`（対話式）または passwordless sudo を前提とする。
  - **sudo 可用性の判定（systemctl限定NOPASSWD対応）**: `sudo -n true` の可否ではなく、`SUDO_CMD systemctl is-active swimmy-brain.service` の実行可否で「非対話 sudo が systemctl に使えるか」を判定する。これにより「systemctl だけ NOPASSWD（allowlist sudoers）」の環境でも restart 修復が動作する。
  - **権限不足時の修復スキップ**: `Interactive authentication required`（polkit）および `sudo: a password is required`（sudoers非許可）は **FAIL 扱いにせず WARN で skip** し、監査を継続する。
  - **enable 実行のノイズ抑制契約**: auto-repair は `systemctl is-enabled` を先に確認し、既に `enabled/enabled-runtime` の unit には `enable` を再実行しない。`restart/status` のみ NOPASSWD が許可され、`enable` だけ拒否される環境で不要な権限 WARN を増やさない。
  - **Pattern Similarity fallback 健全判定**: `swimmy-pattern-similarity.service` が未登録/停止でも、`tools/pattern_similarity_service.py` 実プロセスが稼働し `:5564` が LISTEN なら監査上は稼働扱いとする（systemd未管理である旨は WARN で残す）。
  - **Pattern Similarity のsystemd復帰**: systemd修復（`SUDO_CMD` で sudo 実行可能）が行える場合、unit が inactive なのに fallback プロセスが稼働している状態は運用ドリフトとして扱い、fallback を停止して `enable/restart` により systemd 正本へ復帰させる。
    - **安全規約**: unit の `LoadState=not-found`（未インストール）の場合は fallback を停止しない（停止すると 5564 が無に落ちるため）。この場合は WARN で継続し、先に `sudo bash tools/install_services.sh`（または同等の unit 配置）を促す。
  - **Dashboard表示整合**: `tools/dashboard.py` の `PatternSim` 表示は systemd unit 状態だけでなく fallback 健全判定（`pattern_similarity_service.py` + `:5564` LISTEN）を参照し、unit未登録でも誤って常時 `inactive` と表示しない。
  - **権限不足時の修復挙動**: `enable/restart` が `Interactive authentication required` で失敗する環境では修復を FAIL 扱いにせず WARN でスキップし、監査の観測結果（status/dashboard/log/DB）を継続する。
  - **Deep Audit スケーリング**: `tools/deep_audit.lisp` は archive-heavy DB（`strategies` が数十万行）でも完走することを正本とし、全件 `SELECT data_sexp` → S式復元のような巨大 materialize を監査で行わない。監査は `get-db-rank-counts` / `get-library-rank-counts` / `get-library-archive-canonical-count` / `map-strategies-from-db`（limit付き）などのストリーミング観測で実施する（Archive drift は per-dir mismatch に加えて Library canonical/overlap も併記して誤読を防ぐ）。
- **運用**: ログはDiscordに集約。`./tools/monitor_evolution.sh` で状況確認。
- **運用（Brain起動）**: `swimmy-brain` は systemd 経由のみで起動する。cron watchdog `tools/check_guardian_health.sh` が **systemd MainPID 以外**の `/home/swimmy/swimmy/run.sh` を自動停止する（MainPID が取得できない場合は `run.sh` を全停止）。
- **運用（systemd正本）**: Swimmy FX コアは systemd(system) を正本とし、systemctl --user は診断用途のみ。Polymarket OpenClaw は user systemd（`systemctl --user`）を正本（cycle/signal-sync）とし、status/notifier は systemd(system) で監査する。
- **Evolution Loop 排他契約**: `tools/evolution_daemon.py` は `school-daemon.lisp` の稼働を監視し、後発で school が起動した場合は自身の SBCL 子プロセス（`run_lisp_evolution.lisp`）を停止して待機へ戻る。`SWIMMY_ALLOW_PARALLEL_EVOLUTION=1` 指定時のみ並列実行を許可する。
- **Rank一本化**: ライフサイクル判断は Rank のみ。Tierは判断ロジックから除外（ディレクトリもRankへ移行）。
- **研究評価と実運用判定の分離**: Rank（B/A/S）は研究の評価指標として維持し、ライブ投入可否は `deployment_gate_status` の Go/No-Go 判定を正本とする。S-Rank 単独では自動的に live-ready とみなさない。
- **Rank閾値（vNext / Balanced）**: Stage 1 固定閾値を `B: Sharpe>=0.15 PF>=1.05 WR>=35% MaxDD<25%`、`A: Sharpe>=0.45 PF>=1.30 WR>=43% MaxDD<16%`、`S: Sharpe>=0.75 PF>=1.70 WR>=50% MaxDD<10%` に更新する。
- **Rank TradeEvidence Floor**: Aは `trade evidence >= 50`、Sは `trade evidence >= 100` を必須とする。`run-rank-evaluation` で既存A/Sにも floor sweep を適用し、`evaluate-a-rank-strategy` は floor 未達を即時 `:B` へ降格して先へ進めない。
- **S Rank Conformance Sweep**: `run-rank-evaluation` は既存 `:S` 戦略に対しても `check-rank-criteria :S` を再評価し、基準逸脱した戦略を `:A`（A基準通過時）または `:B` へ降格する。trade floor のみ満たす S を残留させない。
- **Aランク WR下限の扱い**: 高RR例外を設けず、Aの `WR>=43%` を一律適用する（実装/レポート/テストを同一基準で運用）。
- **A基準不合格内訳の可視化**: Evolution/Backtest系レポートには A Stage1 基準の不合格内訳（Sharpe/PF/WR/MaxDD）を常時表示し、昇格停滞の要因を定点観測できるようにする。
- **A Near-Miss 可視化**: Evolution Report は Bランク候補のうち `a-base-deficit-score` が小さい戦略（A Stage1 に近い候補）を表示し、各候補の不足ゲート（Sharpe/PF/WR/MaxDD）を明示する。ランク閾値や昇格ゲートは変更しない。
- **レポート表示整形**: Evolution Report の `%` 表記は単一 `%` を正本とする（`%%` 表示を出さない）。A Near-Miss 候補は `strategy_name` 単位で重複を除外して表示する。
- **候補名短縮表示**: Evolution Report の候補名は先頭のみの切り詰めを禁止し、必要時は「先頭 + 末尾」を保持した短縮表示にする（同一prefixで別戦略が同名に見える衝突を防止）。
- **Validation Coverage 表示**: Evolution Report に OOS/CPCV の DB累計カバレッジ（全体/Active）を表示し、`CPCV Status` の瞬間値が 0 のときでも「未実行」か「過去実行済みで現行バッチ対象なし」かを判別できるようにする。
- **A Gate Pressure 表示**: Evolution Report に `Active B` 母集団の A Stage1 圧力（`pass_all` と Sharpe/PF/WR/MaxDD 各ゲート通過件数、および PF 近傍帯）を表示し、Sharpe上位でも A/S が 0 の主因が OOS/CPCV 以前の Stage1 かどうかを即時判別できるようにする。
- **昇格ゲート（vNext）**: Stage 2 を `A: OOS Sharpe>=0.35 かつ コスト控除後Expectancy>0`、`S: CPCV pass_rate>=70% かつ median MaxDD<12%` とし、A/S共通で `MC prob_ruin<=2%` と `DryRun実測スリッページ上限` を満たすことを必須にする。
- **昇格ゲート実装値（2026-02-11）**:
  - `A Expectancy`: `net_expectancy_pips = calculate-avg-pips(strategy) - *max-spread-pips*` を使用し、`net_expectancy_pips > 0` を必須とする（暫定的に既存スプレッド上限をコスト近似として採用）。
  - `MC gate`: `school-monte-carlo` の `prob_ruin`（`MaxDD > 20%` の発生確率）を使い、`prob_ruin <= 0.02` を必須とする。
    - 実装既定: `strategy-pnl-history` が **30トレード以上**ある場合のみ判定し、`iterations=250` で評価する（不足時は不合格）。
    - **証拠不足の自己修復（Backfill）**: trade evidence（`strategy-trades` 等）が十分（>=30）なのに `strategy-pnl-history` が欠落している場合、`include_trades` 付き BACKTEST を自動 dispatch して trade_list を回収する（戦略ごとにスロットル）。
  - `DryRun gate`: `execution.slippage` 由来の `slippage_pips` 実測値の `p95(abs(slippage_pips))` を使い、`p95 <= *max-spread-pips*` を必須とする（サンプル不足時は不合格）。
    - 実装既定: 戦略ごとに `execution.slippage` を蓄積し、**20サンプル以上**で `p95` を算出する（不足時は不合格）。
    - **証拠収集（約定確認時）**: MT5 が `POSITIONS` に `entry_price` を含める環境では、Pending→Slot 昇格（約定確認）時に `entry_price` を使って slippage を算出し、DryRun slippage サンプルへ追加できる（trade close を待たずに証拠を蓄積）。
    - **証拠収集（shadow close）**: shadow slot のクローズ時は、slot が保持する `entry_bid/entry_ask/entry` から `slippage-pips-from-fill` を算出し、`dryrun_slippage_samples` へ追加する。shadow fill は quote fill 前提のため、通常は `0.0` 近傍のサンプルになる。
    - 永続化方針: `dryrun_slippage_samples` テーブルへ保存し、戦略ごとに最新 `*dryrun-slippage-sample-cap*` 件（既定200件）を保持する。再起動後もゲート判定を継続できるようにする。
    - 削除ポリシー: `*dryrun-slippage-max-age-seconds*` が正の値のとき、`dryrun_slippage_samples` の古い行（`observed_at` が保持期間外）を戦略単位で削除する。`NIL` は期間削除を無効化。
- **選抜/投票スコア**: Selection Score は Sharpe + PF + WR + (1-MaxDD) を合成（重み: 0.4 / 0.25 / 0.2 / 0.15）。投票ウェイトは `1.0 + 0.6*score` を `0.3–2.0` にクランプ。
- **Graveyard/Retiredの正**: Evolution ReportはDB、Libraryはドリフト検知の正本（`data/library/GRAVEYARD/*.lisp` / `RETIRED/*.lisp`）。
- **Graveyard Cache 取得契約**: `load-graveyard-cache` は `strategies` から `sl/tp/symbol` の構造化列を優先取得し、`data_sexp` の全件デシリアライズを通常経路で行わない。列取得が使えない環境のみ `data_sexp` 経路へフォールバックする。
- **Archive Drift Reconcile 契約**: `tools/ops/reconcile_archive_db.py` は Library→DB 補完だけでなく、DB側余剰アーカイブ名（DB-only）件数を可視化する。必要時はオプションで DB-only 行をバックアップテーブルへ退避してから prune できる（既定は非破壊）。
- **Archive Reconcile Canonical Count 契約**: `reconcile-archive-library-with-db` の DB↔Library 比較は `count(*)`（行数）ではなく `strategy_name` の canonical 件数を正本とする。`strategies` 側に同名 archive 行が重複していても差分ゼロ時は hydration ループへ入らず、全件ファイル存在チェックの長時間走査を起こさない。
- **Archive Reconcile Streaming Hydration 契約**: `reconcile-archive-library-with-db` の hydration 候補取得は archive 全件の一括 materialize を禁止し、`rowid DESC` の keyset paging（小ページ反復）で必要件数（`gap` と `max-additions`）に達した時点で停止する。archive-heavy DB（数十万行）でも 1 サイクル内で GC/CPU 張り付きによる `Cycle Complete` 停滞を起こさないことを正本とする。
- **B案方針**: 内部ZMQ＋補助サービス境界をS式へ統一。**ZMQはS式のみでJSONは受理しない**。外部API境界はJSON維持。**ローカル保存はS式即時単独（backtest_cache/system_metrics/live_statusを .sexp に統一）**。Structured TelemetryはJSONLログに集約。
- **MT5プロトコル**: Brain→MT5 は S式を正本（ORDER_OPEN は `instrument` + `side`）。
- **Executor Pending契約**: `swimmy.globals:*pending-orders*`（UUID→(timestamp,retry,msg)）の `msg` は `ORDER_OPEN` V2 の `instrument/side/lot` を正本キーとして扱う。`ORDER_ACK` / `ORDER_REJECT` 受信時は同一UUIDの pending を即時除去し、retry/timeout へ残存させない。
- **Execution Link Freshness Gate契約**: `safe-order` は `ORDER_OPEN` 送信前に MT5 実行リンクの鮮度を検証し、`guardian heartbeat` または `ACCOUNT_INFO` が stale の場合は fail-closed で注文を中止する。中止時は `swimmy.globals:*pending-orders*` に enqueue せず、`execution.link_stale` telemetry と（スロットル付き）運用アラートで可観測化する。
- **Executor Pending Pause契約**: `check-pending-orders` は MT5 実行リンク（guardian heartbeat / ACCOUNT_INFO）が stale の間、pending retry/timeout を停止する。stale 中は pending を保持し、再送・timeout通知を行わない（復旧後に通常 retry 判定へ戻る）。
- **MT5 Bridge Command Drain契約**: `SwimmyBridge` は `OnTimer` ごとに Execution SUB (`:5560`) の受信キューを複数件 drain する。1tick1件処理で queue を滞留させない。`HEARTBEAT` は symbol ルーティング前に処理し、`_Symbol` 不一致で無視しない。
- **MT5 Bridge DeadMan 受信優先契約**: `SwimmyBridge` の `OnTimer` は Dead Man's Switch 判定より先に `:5560` 受信キューを drain し、キュー済み `HEARTBEAT` が未処理のまま誤クローズしない。
- **MT5 Bridge ACK/REJECT 到達性契約**: `SwimmyBridge` は `ORDER_ACK` / `ORDER_REJECT` 送信で短時間再送を行い、送達を at-least-once とする。受信側（Dispatcher）は同一 `id` の重複受信を idempotent に処理する。
- **MT5 Bridge ORDER_OPEN Sink Guard契約**: `SwimmyBridge` は受信 `ORDER_OPEN` の `comment` を `strategy|tf` 形式で検証し、欠落/形式不正/`NIL`/不正TFは `ORDER_REJECT` で fail-closed する。`SW-<magic>` などへのフォールバックを禁止する。
- **MT5 Bridge ORDER_OPEN Instrument契約**: `SwimmyBridge` は `ORDER_OPEN` の `instrument/symbol` に具体シンボルを要求し、`ALL` は `INVALID_INSTRUMENT`、空値と nil-like（`NIL/NULL/NONE`）は `MISSING_INSTRUMENT` として `ORDER_REJECT` で fail-closed する。
- **MT5 Bridge POSITIONS S式整合契約**: `SwimmyBridge` が送る `POSITIONS` は `(data . (...))` を含む整形式 alist とし、0件でも `(data . ())` を返す。括弧不整合メッセージを禁止する（Dispatcher の `Unsafe/invalid SEXP` 誤棄却を防ぐ）。
- **MT5 ORDER_REJECT 可観測化契約**: Dispatcher は `ORDER_REJECT` を受信したら pending UUID を即時除去する。さらに `reason` が `MISSING_INSTRUMENT/INVALID_INSTRUMENT/MISSING_COMMENT/INVALID_COMMENT_FORMAT/MISSING_STRATEGY/MISSING_TIMEFRAME/INVALID_COMMENT_TF` の場合は運用異常として Discord alert を発火し、受信側 fail-closed を見逃さない。送信側再送（at-least-once）による同一 `id+reason` の短時間重複受信では alert を重複発火しない（idempotent alert）。
- **MT5 Bridge REQ_HISTORY TF正規化契約**: `SwimmyBridge` は `REQ_HISTORY.tf` を大文字小文字非依存で正規化し、`MN/MN1` および minutes文字列（例: `60/240/1440/10080/43200`）を標準TFへ変換する。非標準minutes（例: `300`）は `M1` 配信へフォールバックし、上位層のresampleを前提とする。
- **MT5 Bridge CLOSE_SHORT_TF 保護契約**: `SwimmyBridge` は `POSITION_COMMENT` の `tf_key` を minutes に正規化して `>=1440m`（D1以上）を保護する。旧コメント形式互換のため `|D1`/`|W1`/`|MN`/`|MN1` サフィックス判定も維持する。
- **MT5 Bridge S式受信互換契約**: `SwimmyBridge` の受信パーサは key-value を dot形式 `(<key> . <value>)` と shorthand形式 `(<key> <value>)` の双方で解釈する。`close_all` など真偽値は `true/false`, `t/nil`, `1/0`, `#t/#f` を受理する。
- **Pattern Similarity Service**: 5564(REQ/REP) で **S式のみ**受理。QUERY入力はOHLCVのS式、画像生成はサービス側（バイナリ送信は禁止）。
- **Inference Worker**: 5565(REQ/REP) で **S式のみ**受理（`type="INFERENCE"`）。`SWIMMY_PORT_INFERENCE` でポート上書き可能。
- **Pattern Similarity 実装状態（Phase 1/2）**: `tools/pattern_similarity_service.py` は `STATUS/BUILD_INDEX/QUERY` 契約を提供し、`data/patterns/` の index をロードする。埋め込み backend は `clip-vit-b32`（画像）と `vector-siamese-v1`（学習済みSiamese）を併用可能で、`QUERY` は backend別確率と混合確率を返す。ベクトル学習器は `tools/pattern_vector_dl.py` / `tools/train_pattern_vector_model.py` で管理し、学習済みモデルは `SWIMMY_PATTERN_DL_MODEL_PATH`（既定 `data/patterns/models/vector_siamese_v1.pt`）からロードする。
- **Pattern Similarity Decision Policy**: `QUERY` は `intended_direction`（BUY/SELL）を受け取り、歪み検知（volume/range/price-band concentration）を通過した場合のみ `follow/fade/no-trade` を算出する。`SWIMMY_PATTERN_POLICY_MODE` は `shadow/soft-enforce/full-enforce` を取り、既定は `shadow`（助言のみ、強制停止なし）。
- **Pattern Similarity Ensemble Weight**: `SWIMMY_PATTERN_ENSEMBLE_VECTOR_WEIGHT` は vector backend の混合重み（clip は `1-w`）を表す。2026-02-17 の比較ベンチ結果に基づき、既定値は `0.00`（clip優先）とする。
- **Pattern Backend Auto Calibration**: `tools/pattern_backend_calibration_update.py` が定期ベンチを実行し、`data/reports/pattern_backend_calibration_latest.json`（評価レポート）と `data/patterns/models/ensemble_weight.json`（推奨重み）を更新する。重みファイルは `vector_weight`（global）に加えて `symbol_timeframe_weights`（`<SYMBOL>:<TF>` -> `0.0..1.0` 数値）を持てる。`tools/pattern_similarity_service.py` は `SWIMMY_PATTERN_ENSEMBLE_WEIGHT_FILE`（既定 `data/patterns/models/ensemble_weight.json`）を優先し、`symbol_timeframe_weights` → global `vector_weight` → `SWIMMY_PATTERN_ENSEMBLE_VECTOR_WEIGHT` の順で実行時重みを決定する。
- **Pattern Backend Calibration Health Audit**: `tools/system_audit.sh` は `tools/pattern_backend_calibration_status.py` を呼び出し、`swimmy-pattern-backend-calibration.timer` の有効状態と `data/reports/pattern_backend_calibration_latest.json` の鮮度（既定48時間以内）を監査する。異常時は WARN として可視化する。
- **Pattern DB**: `data/patterns/` に npz + FAISS を保存、SQLiteはメタ情報のみ。
- **時間足データ方針**: M1は **10M candles/シンボル** 保存。M5/M15/M30はM1からリサンプル。H1/H4/D1/W1/MN1は直取得。任意TFは minutes(int) を正本として M1+resample 経路で評価可能にする。
- **Pattern Gate**: H1以上の足確定時に評価、TF一致のみ適用。距離重み確率（k=30 / 閾値0.60）に加えて `decision_action` を実売買側で解釈し、`follow` は不一致時 0.70x、`fade` は 0.55x、`no-trade` は 0.35x へロット減衰する（停止強制は行わず最小ロットで fail-soft）。低歪み局面（`distortion_passed=false`）はノイズ回避のため gate 適用をスキップできる。**ライブ/OOS/CPCV/バックテストに適用**。
- **Signal Confidence Gate**: `process-category-trades` の最終候補シグナルに確度ゲートを適用する。`confidence < 0.20` はエントリー見送り、`0.20 <= confidence < 0.35` はロット `0.55x`、`>= 0.35` は通常ロット。confidence欠落時は後方互換として `1.0` 扱い。
- **ラベル評価幅**: M5/M15=4時間、H1/H4=1日、D1=1週間、W1/MN1=1か月（ATR基準のUp/Down/Flat）。
- **サンプルストライド**: M5=30分(6本)、M15=1時間(4本)、H1/H4/D1/W1/MN1=1本。
- **画像ウィンドウ本数**: M5=120、M15=120、H1=120、H4=120、D1=120、W1=104、MN1=120。
- **VAP**: 価格帯別出来高はMT5ティック由来で生成（**ヒストリカルはData Keeperにティック履歴保存**）。
- **Tick API**: Data Keeper に `GET_TICKS` / `ADD_TICK` を実装し、VAP用のティック履歴を取得できる（newest-first, `start_time/end_time` フィルタ対応）。
- **Backtest Phase方針**: Phase1=2011-2020、Phase2=2021-CSV末尾(rolling end_time)。Backtest要求に `phase`/`range_id` と `start_time`/`end_time` を含める。Evolution Reportに Phase2 end_time を明記する。
- **Startup Liveness**: Brain起動時は「受信ループ（Backtest結果/Guardian stream）」へ先に入る。重い一括処理（Deferred Backtest Flush）は **後回し＋レート制限**で段階的に実行する（起動で詰まらせない）。`SWIMMY_DEFERRED_FLUSH_BATCH`（1回の送信上限、0で無効）と `SWIMMY_DEFERRED_FLUSH_INTERVAL_SEC`（実行間隔秒）で調整する。
- **OOS Queue Startup Cleanup**: 起動時に `oos_queue` を全クリアし、OOS再キューは通常の検証ループで再投入する（古い request_id を残さない）。
- **Brain Bootstrap**: `run.sh` は `brain.lisp` を優先し、欠落時はASDF直起動へフォールバックする。
- **Backtest Option表現**: `Option<T>` は空/1要素リストを正本（例: `(timeframe 1)` / `(timeframe)`）。
- **Backtest Result Contract**: `BACKTEST_RESULT` は常に `request_id` を含める（相関/キュー整合のため必須）。
- **OOS Result Apply Fallback 契約**: `BACKTEST_RESULT` の `-OOS` 結果適用時、受信側は in-memory `find-strategy` 失敗だけで `Strategy not found` としない。`strategies.data_sexp`（DB）から当該戦略を復元できる場合は OOS 指標更新/queue完了/昇格判定を継続し、in-memory と DB の双方で不在のときのみ `oos_queue=error` とする。
- **Backtest Request Contract**: `BACKTEST` 要求は `request_id` を必須とする。`request-backtest-v2`（Phase1 Screening）を含むすべての送信経路で相関IDを付与し、欠落時の `request_id="MISSING"` error結果を通常評価メトリクスとして扱わない。
- **Phase1 Result 名正規化契約**: `BACKTEST_RESULT.result.strategy_name` が `*_P1` の場合、受信側は `"_P1"` を除去した基底名で `apply-backtest-result` / DB更新を行う。`_P1` 結果は RR/QUAL の進捗バッファに加算しない。
- **Founder Recovery Prune 保護契約**: `prune-low-sharpe-strategies` は `B` ランク戦略でも、`founder-phase1-recovery-passed-p` を満たす founder 候補（例: `Hunted-*`）を `Operation Black Death (Low Sharpe)` で `:graveyard` に落とさない。Phase1 recovery で一度 `:B` を許可した評価軸（Sharpe/PF/Trades/MaxDD）と prune 経路を整合させる。
- **Founder Recovery Overflow Culling 保護契約**: `cull-pool-overflow`（DEATHMATCH）は founder recovery 条件（`founder-phase1-recovery-passed-p`）を満たす `:B` 戦略を overflow victim に選ばない。pool上限超過時は非保護候補を優先して cull し、Founder回復直後の再埋葬を防ぐ。
- **Backtest Result 末尾サフィックス正規化契約**: `BACKTEST_RESULT.result.strategy_name` の `-RR/-QUAL/-OOS/_P1` 正規化は末尾一致のみで実施する。基底名中の `-QUAL-...` などは削除せず、`<base-with-QUAL-token>-QUAL` のような名称でも基底名を破壊しない。
- **Backtest Bool 正規化契約**: Backtest/CPCV の内部S式で `filter_enabled` などの bool は `#t/#f` を正本とする。`t/nil` シンボルが混入する入力は Backtest Service で正規化して Guardian へ中継する。S式の構文正規化に失敗した場合でも、既知 bool キー（例: `filter_enabled`）はフォールバックで `t/nil`→`#t/#f` へ置換して Guardian へ渡す。
- **Backtest Service 運用整合契約**: `swimmy-backtest.service` を正本とし、systemd が inactive の状態で 5580 に手動 `backtest_service.py` が LISTEN している状態をドリフトとして扱う。監査で検知し、運用に修復を促す。
- **Dashboard Drift 可視化**: `tools/dashboard.py` は `swimmy-backtest` の systemd 状態に加えて 5580 listener と MainPID の整合（drift有無）を表示し、inactive/manual 混在を即時判別できるようにする。
- **Backtest Knob 役割契約**: `SWIMMY_BACKTEST_MAX_PENDING` / `SWIMMY_BACKTEST_RATE_LIMIT` は **Lisp送信側**（`school-backtest-utils.lisp`）のスロットル設定。`SWIMMY_BACKTEST_MAX_INFLIGHT` は **Backtest Service側**（`tools/backtest_service.py`）の並列inflight上限であり、`MAX_PENDING` は service inflight を直接制御しない。
- **Backtest Throttle**: `SWIMMY_BACKTEST_MAX_PENDING` と `SWIMMY_BACKTEST_RATE_LIMIT` で送信抑制。`pending = submit - recv` が上限超過またはレート未達のときは即時送信せず、`backtest-send-queue` に再キューする（キュー容量不足時のみ `:throttled` で拒否）。
- **Backtest Pending Rebase 契約**: `pending = submit - recv` が長時間の部分欠落で過大ドリフトした場合、送信側は `submit` を安全側へリベースして `pending` を上限近傍へ戻す。これにより `pending` が `MAX_PENDING` を恒久的に超え続けて RR/QUAL dispatch が永久停止する状態を防ぐ（結果処理自体は継続）。
- **Backtest Throttle 診断ログ**: throttleログは `pending上限超過` と `rate未達` を原因別に表示する。`pending` だけを表示して rate throttle を誤診しないことを正本とする。
- **Backtest Rate Limit 運用値**: `SWIMMY_BACKTEST_RATE_LIMIT` は運用チューニング対象とし、2026-02-12 時点の適用値は `140`（従来 `100`）。`pending` が低いのに `rate limit` 再キューが連発する場合は段階的に見直す（例: 100→120→140）。
- **Backtest Queue 実装契約**: `backtest-send-queue` の enqueue/dequeue は O(1) を維持する（`length`/`nconc` に依存しない）。高頻度スロットル時にキュー操作コストが送信ループの律速にならないことを正本とする。
- **Backtest Queue 上限設定**: `backtest-send-queue` の容量は `SWIMMY_BACKTEST_SEND_QUEUE_MAX` で調整可能（未指定時は既定値）。運用側で burst 耐性を増やす際はこの値を優先して調整する。
- **Backtest Service Workers**: `tools/backtest_service.py` は複数 Guardian worker を並列起動できる（`SWIMMY_BACKTEST_WORKERS`、既定はCPU数ベースで自動決定）。受信ループは inflight を管理して非同期に結果を返し、`pending` 張り付き時の処理詰まりを緩和する。
- **Backtest Worker/Inflight 運用値**: `SWIMMY_BACKTEST_WORKERS` と `SWIMMY_BACKTEST_MAX_INFLIGHT` は運用チューニング対象。2026-02-13 時点の適用値は `WORKERS=3`, `MAX_INFLIGHT=6`（既定 `4` / `2*workers`）。メモリ圧迫時は worker を先に下げ、throughput低下が許容できない場合のみ段階的に戻す。
- **Deferred Flush pacing**: `flush-deferred-founders` は Backtest レート制限時に送信間隔（`1 / SWIMMY_BACKTEST_RATE_LIMIT` 秒）で dispatch し、同一tick内の即時 `:throttled` 連発による `1件/tick` 近傍への失速を抑制する。
- **RR Batch pacing**: `batch-backtest-knowledge` も受理済み dispatch ごとに送信間隔（`1 / SWIMMY_BACKTEST_RATE_LIMIT` 秒）を挿入し、RRバッチ内で即時 `:throttled` が連発して `Queued: 1` 近傍へ失速するのを抑制する。
- **Backtest Dispatch 計上契約**: RR/QUAL/Deferred/OOS の dispatch 計上は「受理された送信状態」のみ対象とする。`NIL` / `:throttled` は非受理として expected/sent に含めない。
- **Backtest Progress Timeout 契約**: `check-timeout-flushes` による進捗通知は「途中経過」として扱い、RR/QUAL/CPCV の `*_results_buffer` と `*_expected_*` をクリアしない。進捗通知後は `*_start_time*` を更新して、同一進捗の連投スパムを防ぐ。
- **Backtest Progress 可観測性契約**: RR/QUAL の進捗通知は `Progress` 件数だけでなく `Throughput (results/sec)` と `ETA` を併記し、単発スナップショットを「停止/失速」と誤読しないようにする。
- **Backtest Top Results 表示契約**: Discord の `Top Strategy Results` は Sharpe 単独表示にしない。`PF/WR/MaxDD` を同時表示し、A/S未到達の主要因（PF/WR不足）をメッセージ内で即時判読できる形を正本とする。
- **Evolution Top Candidates 表示契約**: Evolution Report の `Top Candidates` は raw Sharpe ではなく trade evidence 補正後 Sharpe（`evidence-adjusted-sharpe`）を主指標として並べる。表示は `S=<adjusted> (raw <raw>)` とし、低頻度戦略の上振れ誤読を防ぐ。
- **Breeder Phase1 必須化**: `add-to-kb` は `source=:breeder` かつ `require-bt=T` の場合、（startup除く）Sharpe値に関わらず `run-phase-1-screening` を必ず要求し、初期ランクを `:incubator` に固定する。Phase1結果でのみ `:B/:graveyard` へ遷移させる。
- **Breeder 呼び出し契約**: `run-breeding-cycle` は Breeder生成物投入時に `add-to-kb(... :source :breeder :require-bt t)` を使用し、運用経路で上記 Phase1 必須化を常時有効にする。
- **Legend交配統合契約**: `run-legend-breeding` の子戦略投入は直接 `push` を禁止し、`add-to-kb(... :source :breeder :require-bt t)` 経由に統一する。Legend由来の子も通常Breeder childと同じ検証フロー（Phase1）を通す。
- **Breeder 親カウント計上契約**: `increment-breeding-count` は `add-to-kb` が受理（`:added` または `:queued-phase1`）した親ペアに対してのみ実行する。`add-to-kb` reject 経路（duplicate/correlation/graveyard など）で親の breeding quota を消費しない。
- **Legend Breeding 完了件数契約**: `run-legend-breeding` の完了件数は「即時KB投入」だけでなく `:queued-phase1` 受理も含めた accepted child 件数を返す。Phase1 queue の進捗を `0 children` と誤表示しない。
- **Breeding Cadence 契約**: `phase-6-breeding` は `SWIMMY_BREEDING_CYCLE_INTERVAL_SEC`（既定60秒）で実行間隔を制御し、1秒ループごとの交配を行わない。interval未達時は breeding phase をスキップして fail-soft 継続する。
- **Phase1 Pending 永続化契約**: `add-to-kb` が `:queued-phase1` で admission defer する場合でも、候補戦略を `rank=nil` のまま `strategies` へ upsert してから `run-phase-1-screening` を送信する。これによりプロセス再起動や pending map 消失後でも `handle-v2-result` の DB fallback（`%load-strategy-from-db-for-phase1`）で結果適用を継続できる状態を正本とする。
- **Breeder PF回復圧契約**: 低PF・WR充足ペア（`avg_pf <= 1.15` かつ `avg_wr >= 0.43`）では PF回復モードを強制し、通常の PF bias より高い RR floor と scale floor を適用する。PF不足が主因のカテゴリで Sharpe偏重交配を抑え、PF改善方向を優先する。
- **Breeder 補完ペア距離ゲート契約**: 遺伝距離ゲートは通常ペアを `>=0.03` で維持しつつ、PF/WR 補完ペアは `>=0.01`、partial recovery ペアは `>=0.02` まで緩和する。`indicators=nil` 個体が多い局面で補完交配が `too similar` で飢餓化しないことを正本とする。
- **Scout語彙廃止契約**: 新規作成/デフォルト/フォールバックで `:scout` を生成しない。未移行データ互換として `:scout` は `:incubator` と同等に扱うが、遷移先・表示・保存は `:incubator` を正本とする。
- **B-Rank Culling 保持契約**: `run-b-rank-culling-for-category` は A候補に選ばれなかった B戦略を全量 `graveyard` に送らない。カテゴリごとに少なくとも `*culling-threshold*` 件（または A候補キュー件数の大きい方）を B基盤として残し、超過分のみ prune する。
- **B-Rank Culling 既定閾値**: `*culling-threshold*` の既定値は 20 とし、通常運用ではカテゴリごとの B 基盤を 20 件まで維持する。
- **B-Rank Culling スコア契約**: prune順は Sharpe 偏重にせず、A Stage1 基準（Sharpe/PF/WR/MaxDD）からの欠損度にペナルティを与える。A基準から遠い B を優先的に cull し、A基準に近い B 基盤を残す。
- **B-Rank Culling PF優先契約**: A基準欠損ペナルティは PF不足を最優先で重く扱う（PF欠損 > WR/Sharpe/MaxDD）。Sharpe高値でも PF未達のBが残留し続けるドリフトを抑え、A Stage1 `PF>=1.30` 通過候補の比率改善を優先する。
- **B-Rank Culling PF帯優先契約**: B基盤の保持順は `A PF pass (PF>=1.30)` → `PF near [1.24,1.30)` → `others` を優先し、同一帯内で culling score を比較する。PF帯をまたいで Sharpe 単独で逆転させない。
- **B-Rank Bootstrap Window 契約**: `run-b-rank-culling-for-category` の bootstrap は `count < culling-threshold` でも「A母集団が小さい間」は継続する。既定 `*culling-bootstrap-max-a-count*` は `8` とし、`A<=8` までは below-threshold カテゴリで B→A 昇格キューを止めない。
- **Rank整合スイープ契約（A/B/S）**: `run-rank-evaluation` は trade-evidence floor と S conformance に加え、A/B の基準逸脱も毎サイクルで是正する。A基準不適合は `:B` へ降格し、B基準不適合は `:graveyard` へ遷移させる（「基準外ランク残留」を許容しない）。
- **Rank conformance 日次比較契約**: `tools/check_rank_conformance.py` は昇降格差分を「前回実行比」ではなく「前日スナップショット比」で算出する。履歴ディレクトリ（`data/reports/rank_conformance/`）から前日以前の最新レポートを基準として `promotion_count/demotion_count/by_route` を出力し、同日内の再実行で差分が消える状態を防ぐ。
- **Breeder Edge-First 選抜契約**: 親選抜 `strategy-breeding-priority-score` は rank/generation のみで優先しない。Stage1品質（Sharpe/PF/WR/MaxDD）と OOS 実績を重み付けし、閾値未達ペナルティを与えて「再現性の弱い親」への交配偏重を抑制する。
- **Breeder A-Base Priority 契約**: 親選抜の閾値ペナルティ既定値は B 基準ではなく A Stage1 基準（`Sharpe>=0.45/PF>=1.30/WR>=43%/MaxDD<16%`）に合わせる。ランク閾値自体は変更せず、交配順位づけだけを A 到達寄りへ最適化する。
- **Breeder OOS Bonus Guard 契約**: `strategy-breeding-priority-score` の OOS ボーナスは、A-base 未達の親では減衰（既定 0.20x）して適用する。低Sharpe個体が OOS 単独で過優先されるドリフトを抑制し、A/S 生成フローを fail-soft で安定化する。
- **Breeder Timeframe Focus 契約（S-flow）**: Sランク生成フローの既定では `M5` を breeder 子時間足から除外する。`*breeder-timeframe-excluded-minutes*` は既定 `(5)`、`*breeder-timeframe-priority-minutes*` は既定 `(60 300)`（`H1/H5`）とし、親由来の base TF が除外対象でも child は許可TFへフォールバックして `M5` 固定化を避ける。
- **Breeder Short-TF Mutation Floor 契約（S-flow）**: 親時間足が両方とも短期（既定 `<=30m`）の場合、child TF 選択の mutation rate に下限（`*breeder-timeframe-short-parent-mutation-floor*`、既定 `0.55`）を適用する。`M15/M30` 固定化を抑制し、`H1/H5` 優先プールへの遷移確率を fail-soft で引き上げる。
- **Breeder Short-TF Partner Bias 契約（S-flow）**: 親時間足が短期（既定 `<=30m`）のとき、親ペア選抜 `breeding-partner-score` は `H1/H5` 優先lane候補へ加点し、短期候補（`M15/M30`）へ減点する。これにより mutation 以前の親選抜段階で短TF同士の再結合を抑え、S向け中期足探索を前段から促進する。
- **Breeder 親品質ハードゲート契約**: `can-breed-p` は非Legend親に対して Stage1 B 基準（Sharpe/PF/WR/MaxDD）を必須化する。優先度ペナルティのみで弱エッジ親を交配に残す fail-open を禁止し、基準未達親は fail-closed で親候補から除外する。`run-breeding-cycle` と `run-legend-breeding`（B側親）も同じ `can-breed-p` で足並みを揃える。
- **Breeder OOSハードゲート契約**: `can-breed-p` は A/S 親に `OOS Sharpe >= 0.35` を必須化する。OOS 欠落または閾値未達の A/S 親は fail-closed で交配対象から除外し、研究ランクのみでの親流入を抑止する。
- **Breeder ランク整合ハードゲート契約**: `can-breed-p` は A/S 親に対して「自ランク基準への適合」を必須化する。A親は A基準（TradeEvidence/A Stage1/OOS）未達なら fail-closed、S親は S基準（TradeEvidence/S Stage1/CPCV）未達なら fail-closed で交配対象から除外する。
- **Deferred Flush 制御**: `SWIMMY_DEFERRED_FLUSH_BATCH` で1回のフラッシュ数を制限し、`SWIMMY_DEFERRED_FLUSH_INTERVAL_SEC` でフラッシュ間隔を制御（0は無制限/即時）。
- **Backtest CSV Override**: `SWIMMY_BACKTEST_CSV_OVERRIDE` が設定されている場合、Backtestの `candles_file` は指定パスを優先する。
- **Backtest CSV Override運用例**: `SWIMMY_BACKTEST_CSV_OVERRIDE=/path/to/USDJPY_M1_light.csv` で軽量CSVに差し替える。
- **非相関スコア通知**: A/S昇格時に日次PnL相関から「非相関スコア」を算出しDiscord通知。**非相関はランクではなくポートフォリオ指標**（単一戦略の並びは維持）。
- **Pair Strategy (実装済)**: ペアを**独立エンティティ**としてDB永続化し、選抜ペアのみ overlay に反映する。`pair_strategies` テーブルで `pair_id/構成A/B/weight/評価指標/rank/last_updated` を保持し、`trade_logs` の `pair_id` を引き続き利用する。選抜は **ハイブリッド枠**（シンボル×TFごとに `*pair-slots-per-tf*` 上限、同一ランキングで単一と競争）で実施。昇格ゲートは**OOS合成評価（A）**と**CPCV合成評価（S）**を必須とし、trade_list不足時は昇格不可。trade_listは OOS/CPCV/Backtest の履歴から合成し、CPCVは `CPCV_RESULT` の trade_list 永続化を前提にする。日次 00:10 の PnL 集計後に `refresh-pair-strategies` → `refresh-pair-active-defs` を実行し、DB選抜されたペアのみ `*pair-active-defs*` に反映する。

## 既知のバグ/課題
- **WSL IP**: MT5側の設定 (`InpWSL_IP`) は **空がデフォルト**。手動指定が必須。
- **Backtest Status**: `data/reports/backtest_status.txt` の `last_request_id` と `pending` を監視。
- **Backtest停滞アラート契約**: `Backtest停滞` は pending/inflight が正のときだけ発報する。CPCV-only フェーズや idle（未投入）時は「最終受信時刻が古い」だけでアラートを出さない。
- **Watchdog Silence Timeout契約**: `swimmy-watchdog` の Brain silence 判定は `TIMEOUT_WARN/ BLOCK/ CLOSE` の3段階を維持しつつ、実効値の下限を `120/300/600s` とする。環境値がこれより小さい場合は clamp して運用し、30〜90秒級の通常無通信区間で `BRAIN TIMEOUT` を誤発火させない。
- **Watchdog Startup Grace契約**: `swimmy-watchdog` は `swimmy-brain` の MainPID 変更（再起動）を検知したら、初回 Brain信号を受信するまで startup grace（既定900秒）中は silence timeout 判定を抑止する。起動直後の初期化中に `swimmy-brain` を再キルして再起動ループへ入ることを禁止する。
- **Band Alias Binding契約**: `evaluate-strategy-signal` は `BOLLINGER` を `BB` 同義として扱い、`UPPER-BAND/LOWER-BAND`（および `*-PREV`）を alias 束縛する。`bb-upper/bb-lower` 系と `upper-band/lower-band` 系が混在しても `unbound variable` で評価停止しない。
- **Logic Symbol Package Normalization契約**: `evaluate-strategy-signal` は `entry/exit` ロジック中の参照シンボルを package 非依存で解決する。`COMMON-LISP-USER::SMA-20` や `SWIMMY.TESTS::LOWER-BAND` のような外部packageシンボルでも、同名の評価用束縛へ alias 解決し `unbound variable` で評価停止しない。
- **Signal Candidate Scope契約**: `collect-strategy-signals` は active rank（`:B/:A/:S/:LEGEND`）のみを評価対象にする。`:GRAVEYARD/:RETIRED/NIL` rank は評価ループへ入れず、エラー連打とCPU飽和を抑止する。
- **Shadow Paper Timeout Close 契約**: `close-a-rank-shadow-positions` は SL/TP ヒットに加えて、shadow保持時間が上限を超えた場合も `:timeout` 理由でクローズし、`trade_logs.execution_mode='SHADOW'` の学習行を必ず記録する。保持上限は `*shadow-max-hold-seconds*`（秒）で制御し、`<=0` は timeout 無効とする。
- **Legacy Keyword Logic Normalization契約**: `evaluate-strategy-signal` は legacy shorthand（例: `((:RSI-BELOW 10))`, `((:RSI-ABOVE 90))`, `((:CROSS-OVER :SMA 50 :SMA 200))`, `((:CROSS-UNDER ...))`）を正規化してから評価する。`illegal function call`/compile-error ストームを防ぎ、旧Legend定義を fail-open ではなく安全に解釈する。
- **Backtest Debug**: `SWIMMY_BACKTEST_DEBUG_RECV=1` で受信状況を `data/reports/backtest_debug.log` に追記（内部ZMQはS式のみのため、Backtest Serviceの戻りもS式であることが前提）。
- **Backtest Option値**: Guardian `--backtest-only` の `Option<T>` は「空/1要素リスト」で表現（例: `(data_id "USDJPY_M1")` / `(data_id)` / `(start_time 1700000000)`）。
- **データ不整合**: MT5とLisp間のヒストリカルデータ差異。
- **MT5 order_send Disk error（V50.8-P5.29, build5647事象）**: `2026-02-27 09:03-09:34 JST` の `MetaTrader 5 build 5647` で `accepted market` 直後に `failed ... [Disk error]` が連続する事象を確認。`2026-02-27 12:14 JST` の build `5648` 更新後は同一 terminal/data path で `deal ... done` が連続記録され（`12:17 JST` 台）、現時点では「恒常的な約定不能ブロッカー」ではなく **build5647時点のインシデント** として扱う。
- **再起動耐性**: Guardianのリスク状態 (`risk_state.json`) の永続化は実装済みだが、クラッシュ時の整合性は要監視。
- **メモリ**: `load-graveyard-cache` はデフォルトのSBCLヒープで枯渇する場合がある（診断時は `--dynamic-space-size 2048` 以上を推奨）。
- **レポート手動更新**: `tools/ops/finalize_rank_report.sh` は `tools/sbcl_env.sh` を読み込み、`SWIMMY_SBCL_DYNAMIC_SPACE_MB`（未指定時 4096MB）で `finalize_rank_report.lisp` を実行する。
- **レポート手動更新（副作用抑制）**: `tools/ops/finalize_rank_report.sh` / `finalize_rank_report.lisp` は既定で「集計のみ（metrics refresh + report generation）」を実行し、rank評価（culling/昇格）は実行しない。rank評価を含める場合は明示的に `SWIMMY_FINALIZE_REPORT_RUN_RANK_EVAL=1` を指定する。

## 直近の変更履歴
- **2026-03-01**: V50.8-P5.89（option2 monitor-only refresh #14）を反映。`primary=trial_v2_20260228_m20_executor_v1_m45_softgate_e10_shadow14d`（切替時刻: `2026-02-28T15:17:29.639880+00:00`）/ `secondary=trial_v2_20260227_h4_stable_tfscan` / `explore=trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`xau_autobot_operational_audit_20260228_{m20_e10_shadow14d,h4_stable_tfscan,m20_e10_c2}_refresh*_now1518.json` を生成。`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226/20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_20260228_m20_executor_v1_m45_softgate_e10_shadow14d.json`・`v50_8_gap_analysis_20260226_runtime_20260227_h4_stable_tfscan.json`・`v50_8_monitor_only_status_20260227.json`・`v50_8_run_refresh_20260301_0019_e10shadow_h4stable_e10c2.json` を再同期。最新は `e10_shadow14d={window_days:0.0009189423495370371, verdict:INVALID_TRIAL, closed:0}`、`h4_stable_tfscan={window_days:0.5149248658333333, verdict:INVALID_TRIAL, closed:0}`、`e10_c2={window_days:0.06821157918981481, verdict:INVALID_TRIAL, closed:0}`。判定は `decision=NO_GO` 継続。
- **2026-02-28**: V50.8-P5.88（option2 monitor-only refresh #13）を反映。`primary=trial_v2_20260228_v50_8_14d_r2v_m20_e1` / `secondary=trial_v2_20260227_h4_stable_tfscan` / `explore=trial_v2_20260228_m20_executor_v1_m45_softgate_e10_c2` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`xau_autobot_operational_audit_20260228_{r2v_m20_e1,h4_stable_tfscan,m20_e10_c2}_refresh2_now1347.json` を生成。`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226/20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_20260228_v50_8_14d_r2v_m20_e1.json`・`v50_8_gap_analysis_20260226_runtime_20260227_h4_stable_tfscan.json`・`v50_8_monitor_only_status_20260227.json`・`v50_8_run_refresh_20260228_2247_r2v_m20_h4stable_e10c2.json` を再同期。最新は `r2v_m20_e1={window_days:0.41120753370370366, verdict:INVALID_TRIAL, closed:0}`、`h4_stable_tfscan={window_days:0.45118969225694444, verdict:INVALID_TRIAL, closed:0}`、`m20_e10_c2={window_days:0.004476428518518518, verdict:INVALID_TRIAL, closed:0}`。判定は `decision=NO_GO` 継続。
- **2026-02-28**: V50.8-P5.86（option2 monitor-only refresh #12）を反映。外部更新に追従して `primary=trial_v2_20260228_v50_8_14d_r2v_m20_e1` / `secondary=trial_v2_20260227_h4_stable_tfscan` へ切替え、`XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価。`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226/20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_20260228_v50_8_14d_r2v_m20_e1.json`・`v50_8_gap_analysis_20260226_runtime_20260227_h4_stable_tfscan.json`・`v50_8_monitor_only_status_20260227.json` を同期更新。最新は `r2v_m20_e1={window_days:0.40305931166666664, verdict:INVALID_TRIAL, closed:0}`、`h4_stable_tfscan={window_days:0.4430405016319444, verdict:INVALID_TRIAL, closed:0}`、判定は `decision=NO_GO` 継続（`decision_mode=monthly_only`, `min_days=30`）。
- **2026-02-28**: V50.8-P5.65（案A research-only正本化）を反映。`CANONICAL_PLAN=A`、`ENTRY_ORDER=M45->H2->H5->H3`、`LIVE_ACCEPT_TF=[M1,M5,M15,M20,M30,H1,H4]`、`RESEARCH_ACCEPT_TF=[M45,H2,H3,H5]` を正本化。`tools/xau_autobot_trial_judge.py` に `rolling_45d/rolling_60d` decision_mode を追加し、`tools/xau_autobot_trial_v2_eval.sh` は config `timeframe` から judge default（`M45/H2->rolling_45d`, `H3/H5->rolling_60d`, それ以外 `monthly_only`）を自動選択する契約へ更新。`tools/xau_autobot_operational_audit.py` は `--profile {default,m45,h2,h3,h5}` と profile別 window/閾値を実装。`tools/xau_autobot.py` へ `--mode {live,research}` と live/research timeframe ガードを追加し、live で研究専用TFを fail-closed 拒否。research candidate config として `tools/configs/xau_autobot.trial_v2_20260228_{m45_trendcore,h2_hybrid,h5_anchor,h3_burst}_v1.json` を追加。回帰は `pytest tools/tests/test_xau_autobot_trial_judge.py tools/tests/test_xau_autobot_operational_audit.py tools/tests/test_xau_autobot_trial_v2_eval.py tools/tests/test_xau_autobot.py` で `91 passed` を確認。
- **2026-02-28**: V50.8-P5.64（M20 primary cutover実施）を反映。`r2v_m5` primary loop を停止し、`trial_v2_20260228_v50_8_14d_r2v_m20_e1` を `xau_autobot_trial_v2_current_run.json` / `..._r1.json` の正本へ切替。初期成果物 `xau_autobot_live_report_trial_v2_20260228_v50_8_14d_r2v_m20_e1.json` / `xau_autobot_trial_judge_trial_v2_20260228_v50_8_14d_r2v_m20_e1.json` / `xau_autobot_operational_audit_20260228_r2v_m20_e1_refresh1_now0355.json` を生成し、`v50_8_trial_judge_...` へ mirror。cutover集約 `v50_8_run_refresh_20260228_0358_r2v_m20_cutover.json` で `m20_primary_config=1` / `legacy_m5_primary_config=0` を確認。開始直後のため判定は `INVALID_TRIAL` / `INSUFFICIENT_DATA`。
- **2026-02-28**: V50.8-P5.62（M20 live実行対応 + E1中庸config）を反映。`tools/xau_autobot.py` の `_tf_to_mt5` を `M20` 対応へ拡張し、`TIMEFRAME_*` 欠損時も `ValueError` fail-closed を維持。TDDとして `tools/tests/test_xau_autobot.py::TestXauAutoBotTimeframeMapping` を追加し、`pytest -k "tf_to_mt5 or TimeframeMapping"`（`3 passed`）と `pytest tools/tests/test_xau_autobot.py`（`57 passed`）を確認。`tools/configs/xau_autobot.trial_v2_20260228_v50_8_14d_r2v_m20_e1.json` を追加し、readiness は `eval45d/eval60d` ともに `NO_GO`（`PF=0.868/0.773`, `return=-3.47%/-7.11%`）を記録。あわせて `INTERFACES.md` の `xau_autobot.py` timeframe受理契約と `xau_autobot_optimize.py` interval/timeframe 正規化一覧を更新。
- **2026-02-27**: V50.8-P5.59（trial_eval live loop guard 接続）を反映。`tools/xau_autobot_trial_v2_eval.sh` に live report 前の `xau_autobot_live_loop_guard.py` 呼び出しを追加し、`XAU_AUTOBOT_TRIAL_LIVE_LOOP_GUARD_ENABLED`（既定1）/`..._INCLUDE_R3`/`..._DRY_RUN`/`..._FAIL_ON_ERROR`/`..._REPORT_PATH` を導入。guard失敗は既定 fail-open（WARNのみ）で、`..._FAIL_ON_ERROR=1` のみ fail-closed。TDDは `tools/tests/test_xau_autobot_trial_v2_eval.py` に3件追加（default起動・include_r3・disabled）し、`-k live_loop_guard` で RED（`2 failed, 1 passed`）→ 実装後 GREEN（`3 passed`）を確認。回帰 `pytest tools/tests/test_xau_autobot_trial_v2_eval.py`（`11 passed`）と `unittest tools.tests.test_xau_autobot_live_loop_guard tools.tests.test_xau_autobot_trial_watchdog`（`10 tests OK`）を確認。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.58（変則時間足探索実施）を反映。`tools/xau_autobot_data.py` に `m20/m45/h2/h3` alias+resample を追加し、`tools/xau_autobot_optimize.py` の interval/timeframe 対応を `M20/M45/H2/H3` へ拡張。回帰 `./.venv/bin/python -m unittest tools.tests.test_xau_autobot_data tools.tests.test_xau_autobot_optimize` で `19 tests OK`。探索成果物 `xau_autobot_optimize_20260227_tfscan2_{m20,m45,h2,h3}_60d.jsonl`・`xau_autobot_readiness_20260227_tfscan2_*`・`xau_autobot_alpha_scan_20260227_tfscan2_midtf.json` を生成し、`trades_min>=20` の信頼条件では `m20` が第一候補。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.56（探索枠再開実施）を反映。`xau_autobot_trial_v2_current_run_r3.json` を `trial_v2_20260227_alpha3_r3b` へ更新し、`alpha3_r3b` の live/judge/audit を再生成（`xau_autobot_live_report_trial_v2_20260227_alpha3_r3b.json`, `xau_autobot_trial_judge_trial_v2_20260227_alpha3_r3b.json`, `xau_autobot_operational_audit_20260227_alpha3_r3b_refresh10*.json`）。実測は `closed=0`, `PF=0.0`, `verdict=INVALID_TRIAL`。監査は `refresh10` で `runtime_metrics_source=live_report.runtime_metrics`（`journal_snapshot_count_zero` fallback）、`--now-utc 2026-02-27T16:06:00+00:00` では `runtime_metrics_source=journal`（`snapshot_count=8`）を確認。集約 `v50_8_run_refresh_20260227_2306_r2v_alpha3r3b.json` を追加。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.53（live loop self-heal guard）を実装。`tools/xau_autobot_live_loop_guard.py` と `tools/tests/test_xau_autobot_live_loop_guard.py` を追加し、`configごとに1本` の収束ロジック（missing再起動 / duplicate停止）を正本化。回帰は `./.venv/bin/python -m unittest tools.tests.test_xau_autobot_live_loop_guard tools.tests.test_xau_autobot_trial_watchdog`（`8 tests OK`）。実行確認は `python3 tools/xau_autobot_live_loop_guard.py --dry-run` と `python3 tools/xau_autobot_live_loop_guard.py` でともに `status=HEALTHY`（`r2v_h1` 1本、`actions={terminated_duplicates:[], restarted:[]}`）。成果物 `data/reports/xau_autobot_live_loop_guard_latest.json` を更新。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.52（live単独運用への縮退）を反映。`r3u_h1/alpha3_r3a` の live loop と Windows `python --loop --live` を停止し、`r2v_h1` 単独稼働へ収束（実測 `powershell=1`, `python=1`）。`xau_autobot_trial_v2_current_run.json` / `..._r1.json` / `..._r2.json` を `trial_v2_20260227_v50_8_30d_r2v_h1` に統一。`r2v_h1` 再評価は `trial_valid=true, verdict=NO_GO, window_days=0.5691551791550926, closed=23, PF=1.0182054616384915, net=+126`、監査は `status=WARN`（`gap_reject_rate=0.010626992561105207`, `tp_sl_ratio=0.7692307692307693`, `expectancy=5.478260869565247`）。成果物 `v50_8_run_refresh_20260227_2246_single_r2v.json` / `v50_8_monitor_only_status_20260227.json` / `v50_8_monthly_nowcast_20260227.json` / `v50_8_monthly_decision_20260225.json` を更新。月次 nowcast は `11.127643049148878%` だが Go/No-Go は `failed_window_days + failed_profit_factor` で `NO_GO` 継続。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.51（monitor-only再同期 #19）を反映。3run（`r3u_h1/r2v_h1/alpha3_r3a`）を再評価し、監査 `refresh9` を再生成（`xau_autobot_operational_audit_20260227_{r3u_h1,r2v_h1,alpha3_r3a}_refresh9.json`）。集約 `v50_8_run_refresh_20260227_2241.json` を更新し、最新は `r3u_h1={trial_valid:true, verdict:NO_GO, window_days:0.5797619560300926, closed:3, PF:0.6481, net:-860, audit:FAIL}`、`r2v_h1={trial_valid:true, verdict:NO_GO, window_days:0.5659113637847222, closed:23, PF:1.0182, net:+126, audit:WARN}`、`alpha3_r3a={trial_valid:false, verdict:INVALID_TRIAL, window_days:0.07554202921296296, audit:FAIL, runtime_metrics_source:live_report.runtime_metrics}`。月次判定は `NO_GO` 維持（`failed_window_days/failed_closed_positions/failed_profit_factor/failed_win_rate/failed_net_profit/actual_monthly_below_target`）。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.50（monitor-only再同期 #17）を反映。3run（`r3u_h1/r2v_h1/alpha3_r3a`）を再評価し、監査 `refresh8` と集約を再同期（`xau_autobot_operational_audit_20260227_{r3u_h1,r2v_h1,alpha3_r3a}_refresh8.json`, `v50_8_run_refresh_20260227_2221.json`）。最新は `r3u_h1={trial_valid:true, verdict:NO_GO, window_days:0.5662239402777778, closed:3, PF:0.6481, net:-860, audit:FAIL}`、`r2v_h1={trial_valid:true, verdict:NO_GO, window_days:0.5523237585069444, closed:23, PF:1.0182, net:+126, audit:WARN}`、`alpha3_r3a={trial_valid:false, verdict:INVALID_TRIAL, window_days:0.06190907834490741, audit:FAIL, runtime_metrics_source:live_report.runtime_metrics}`。月次判定は `NO_GO` 維持（`failed_window_days/failed_closed_positions/failed_profit_factor/failed_win_rate/failed_net_profit/actual_monthly_below_target`）。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.49（monitor-only再同期 #16）を反映。3run（`r3u_h1/r2v_h1/alpha3_r3a`）を再評価し、`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_dual_run_status_20260227.json`・`v50_8_parallel3_status_20260227.json`・`v50_8_monitor_only_status_20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_run_refresh_20260227_2215.json` を再同期。最新は `r3u_h1={trial_valid:true, verdict:NO_GO, window_days:0.562277269525463, closed:3, PF:0.6481, net:-860}`、`r2v_h1={trial_valid:true, verdict:NO_GO, window_days:0.548376937337963, closed:23, PF:1.0182, net:+126}`、`alpha3_r3a={trial_valid:false, verdict:INVALID_TRIAL, window_days:0.05796034162037037}`。月次判定は `NO_GO` 維持、`reason_codes` は `failed_window_days/failed_closed_positions/failed_profit_factor/failed_win_rate/failed_net_profit/actual_monthly_below_target` へ更新。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.48（monitor-only再同期 #13）を反映。実稼働3run（`r3u_h1/r2v_h1/alpha3_r3a`）を再評価し、`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_dual_run_status_20260227.json`・`v50_8_parallel3_status_20260227.json`・`v50_8_monitor_only_status_20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_run_refresh_20260227_1207_live_running.json` を再同期。あわせて `xau_autobot_trial_v2_current_run_r3.json` を `trial_v2_20260227_alpha3_r3a` へ統一し、`alpha3_r2` を履歴runへ移行。最新は `r3u_h1={trial_valid:true, verdict:NO_GO, window_days:0.5149198039120371, closed:2, PF:1.3322, net:+395}`、`r2v_h1={trial_valid:true, verdict:NO_GO, window_days:0.5010194001273148, closed:22, PF:1.1172, net:+739}`、`alpha3_r3a={trial_valid:false, verdict:INVALID_TRIAL, window_days:0.010602790092592592, invalid_reasons={after_magic_filter,after_comment_prefix_filter}}`。月次判定は `NO_GO` 維持（`failed_window_days/failed_closed_positions/actual_monthly_below_target`）。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.47（MT5認証の部分復旧）を反映。`terminal64.exe` 明示起動で `mt5.initialize() -> ok=True` を確認し、`r3u_h1/r2v_h1` の runtime journal 更新が再開（`21:01 JST`）。再評価で `r3u_h1={window_days:0.5132, closed:2, PF:1.3322, net:+395, verdict:NO_GO}`、`r2v_h1={window_days:0.4993, closed:22, PF:1.1172, net:+739, verdict:NO_GO}` を確認。探索runは `alpha3_r3a` が実稼働し `INVALID_TRIAL`（`after_magic_filter`/`after_comment_prefix_filter`）。集約を `v50_8_run_refresh_20260227_1205.json` へ更新。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.46（MT5 authorization blocked 監視継続）を反映。`r3u_h1/r2v_h1/alpha3_r2` の再起動を再試行したが、Windows Python で `mt5.initialize() failed: (-6, 'Terminal: Authorization failed')` を再現し live loop が即終了。runtime journal 更新は `20:29 JST`、live report 更新は `20:31 JST` で停止しているため、監査は既存成果物から再集計へ切替えた。`xau_autobot_operational_audit_*_authblocked.json` / `xau_autobot_trial_judge_*_authblocked.json` / `v50_8_run_refresh_20260227_1158_authblocked.json` を生成し、3runの判定は `trial_valid=true` / `verdict=NO_GO` を維持。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.45（artifact drift resync #2）を反映。`xau_autobot_trial_judge_*` 最新値へ再追従し、`v50_8_trial_judge_*` / `v50_8_dual_run_status_20260226.json` / `v50_8_dual_run_status_20260227.json` / `v50_8_monitor_only_status_20260227.json` / `v50_8_monthly_decision_20260225.json` を再同期。最新実測は `r3u_h1={trial_valid:true, verdict:NO_GO, window_days:0.4901, closed:2, PF:1.3322, net:+395}`、`r2v_h1={trial_valid:true, verdict:NO_GO, window_days:0.4762, closed:21, PF:1.2352, net:+1342}`、`alpha3_r2={trial_valid:true, verdict:NO_GO, window_days:0.4553, closed:2, PF:1.3558, net:+497}`。月次判定は `reason_codes={failed_window_days, failed_closed_positions, actual_monthly_below_target}`、`execution_path_blocked=false` を維持。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.44（live_loop単一インスタンス契約）を反映。`xau_autobot_live_loop.ps1` の同一config多重起動が再発しうるため、config単位のロック取得を前提にした単独稼働契約を追加。重複起動時は fail-closed で新規インスタンスを拒否し、`runtime_metrics` の分母混線を防止する。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.43（option2 monitor refresh #12）を反映。`r3u_h1/r2v_h1/alpha3_r2` を run専用 `XAU_AUTOBOT_RUNTIME_JOURNAL_PATH` 指定で再評価し、3runすべてで `trial_valid=true` / `verdict=NO_GO` を確認。`v50_8_dual_run_status_20260226.json` / `v50_8_dual_run_status_20260227.json` / `v50_8_monitor_only_status_20260227.json` / `v50_8_monthly_decision_20260225.json` を同期更新し、最新実測は `r3u_h1={window_days:0.4898, closed:2, PF:1.3322, net:+395}`、`r2v_h1={window_days:0.4759, closed:21, PF:1.2352, net:+1342}`、`alpha3_r2={window_days:0.4553, closed:2, PF:1.3558, net:+497}`。月次判定は `trial_invalid` を除去して `reason_codes={failed_window_days, failed_closed_positions, actual_monthly_below_target}` を採用し、`execution_path_blocked=false` へ更新。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.42（alpha3探索runのブロック解消）を反映。`tools/configs/xau_autobot.trial_v2_20260227_alpha3_r2.json` を `session_start/end_utc=0/23`、`min/max_atr_ratio_to_median=0.0/999.0` へ更新し、3run（`r3u_h1/r2v_h1/alpha3_r2`）をクリーン再起動。再評価（`XAU_AUTOBOT_TRIAL_RUN_ID=trial_v2_20260227_alpha3_r2 tools/xau_autobot_trial_v2_eval.sh`）で `runtime_metrics={gate_check_count:2, signal_counts.HOLD:2, gap_reject_rate:0.0}` を確認し、`reason=session` 連続ブロックから脱却した状態を確認。判定系（`primary=r3u_h1` / `secondary=r2v_h1`）の契約は維持。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.41（option2 monitor-only refresh #11）を反映。`primary=trial_v2_20260227_v50_8_30d_r3u_h1` / `secondary=trial_v2_20260227_v50_8_30d_r2v_h1` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_dual_run_status_20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_{r3u_h1,r2v_h1}.json`・`v50_8_monitor_only_status_20260227.json` を再同期。現況は `r3u_h1 window_days=0.16245020913194444`、`r2v_h1 window_days=0.14870841212962962`、`r2v_h1` は `open_positions=1/open_floating_profit=229.0` を観測。ただし両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.40（live loop多重起動是正）を反映。Windows 側の `xau_autobot_live_loop.ps1` / `xau_autobot.py --live` を `Win32_Process` で列挙し、重複起動（15プロセス）を一括停止して `r3u_h1/r2v_h1/alpha3_r2` の3runのみ再起動。停止後は `powershell.exe 3 + python.exe 3` の計6プロセスへ収束し、18秒後の再計測でも `count=6` を維持。専用runtime journal（`..._r3u_h1.jsonl`/`..._r2v_h1.jsonl`/`..._alpha3_r2.jsonl`）が `run_id` 一致で更新されることを確認。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.39（multi-run run_id 復元強化 + 再起動反映）を反映。`tools/xau_autobot.py` の run_id 解決を強化し、`XAU_AUTOBOT_TRIAL_RUN_META_PATH` 未指定または未伝播時でも `xau_autobot_trial_v2_current_run_r1/r2/r3.json` を追加探索して `--config` と `trial_config` のファイル名一致が取れた run_id のみ採用するよう更新。再起動後の runtime journal 最新レコードで `magic=560092/560093/560088` がそれぞれ `trial_v2_20260227_v50_8_30d_r3u_h1` / `trial_v2_20260227_v50_8_30d_r2v_h1` / `trial_v2_20260227_alpha3_r2` を保持することを確認。回帰: `tools/tests/test_xau_autobot.py`（52件）PASS。INTERFACES 更新あり（trial run_id 解決契約に variant meta 探索を追記）。
- **2026-02-27**: V50.8-P5.38（option2 monitor-only refresh #10）を反映。`primary=trial_v2_20260227_v50_8_30d_r3u_h1` / `secondary=trial_v2_20260227_v50_8_30d_r2v_h1` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_dual_run_status_20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_{r3u_h1,r2v_h1}.json`・`v50_8_monitor_only_status_20260227.json` を再同期。現況は `r3u_h1 window_days=0.1584567470949074`、`r2v_h1 window_days=0.14455645623842592`、`r2v_h1` は `open_positions=1/open_floating_profit=249.0` を観測。ただし両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.37（filling mode適応）を反映。`tools/xau_autobot.py` の fill mode 選択を `symbol_info.filling_mode` と直近成功 mode キャッシュで優先化し、`retcode=10030 (Unsupported filling mode)` の反復を抑止。`send_market_order` / `close_opposite_positions` の初回 `type_filling` は固定 `IOC` から動的決定へ切替え、`_order_send_with_filling_fallback` の fail-closed 挙動は維持。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.36（option2 monitor-only refresh #9）を反映。`primary=trial_v2_20260227_v50_8_30d_r3u_h1` / `secondary=trial_v2_20260227_v50_8_30d_r2v_h1` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_dual_run_status_20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_{r3u_h1,r2v_h1}.json`・`v50_8_monitor_only_status_20260227.json` を再同期。現況は `r3u_h1 window_days=0.15669373366898148`、`r2v_h1 window_days=0.14279345390046297`、両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.35（execution-path回復強化）を反映。`tools/xau_autobot.py` に `retcode=5` / `Disk error` 検出時の MT5再接続（`shutdown -> initialize -> symbol_select`）+ 単回再送を追加し、一時的な約定失敗からの自己回復を実装。`order_result` には `mt5_last_error` と再接続診断（`reconnect_retried/reconnect_success/reconnect_detail`）を同梱。回帰は `tools/tests/test_xau_autobot.py`（50件）と `tools/tests/test_xau_autobot_live_report.py` + `tools/tests/test_xau_autobot_trial_v2_eval.py` + `tools/tests/test_xau_autobot_operational_audit.py`（32件）で全PASS。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.34（trial run_id復元の fail-safe）を反映。`tools/xau_autobot.py` の run_id 解決を `XAU_AUTOBOT_TRIAL_RUN_ID` 優先 + `xau_autobot_trial_v2_current_run.json` フォールバックへ拡張し、Windows 経路で環境変数が欠落した場合でも runtime journal の `run_id` が空欄化しないよう修正。フォールバック時は `--config` と run meta `trial_config` のファイル名一致を必須化し、別runへの誤帰属を fail-closed で防止。回帰: `tools/tests/test_xau_autobot.py`（48件）PASS。INTERFACES 更新あり（`XAU_AUTOBOT_TRIAL_RUN_META_PATH` / run_id解決契約）。
- **2026-02-27**: V50.8-P5.33（execution-path block監査固定）を反映。`v50_8_mt5_order_path_probe_20260227.json` を追加し、`20260227.log` 上で `accepted market` 直後に `failed ... [Disk error]` が連続する証跡を保存。`v50_8_dual_run_status_20260227.json`・`v50_8_monitor_only_status_20260227.json`・`v50_8_monthly_decision_20260225.json` に `execution_path_blocked=true` / `execution_path_block_reason=mt5_order_send_disk_error` を反映し、`reason_codes` に `infra_order_send_disk_error` を追加。現況は約定不能の外因ブロッカー継続につき `decision=NO_GO` を維持。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.32（option2 monitor-only refresh #8）を反映。`primary=trial_v2_20260227_v50_8_30d_r3u_h1` / `secondary=trial_v2_20260227_v50_8_30d_r2v_h1` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_dual_run_status_20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_{r3u_h1,r2v_h1}.json`・`v50_8_monitor_only_status_20260227.json` を再同期。現況は `r3u_h1 window_days=0.03589821155092592`、`r2v_h1 window_days=0.021998716284722223`、両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.30（並行運用モード）を反映。ユーザー指示 `並行で` に従い、`primary=r3u_h1` を維持したまま secondary を `r2v_h1`（判定系）と `alpha3_r2`（探索系）の2本へ拡張。run meta/lock を `current_run_r2|current_run_r3` と `..._r2.lock|..._r3.lock` で分離し、正本判定は `primary+r2v_h1` を維持する契約を明記。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.29（MT5発注系の外因切り分け）を反映。`retcode=5 (Disk error)` の根因を再診断するため、(1) `AutoTesting` 競合の停止、(2) `r3u_h1/r2v_h1` の再起動、(3) `xau_autobot` 停止後の単体注文診断を実施。結果は `order_check retcode=0` に対し `order_send retcode=5 (Disk error)` が `XAUUSD` と `USDJPY(FOK)` で再現し、MT5 terminal log（`data path ...D0E8209.../logs/20260227.log`）でも `accepted -> failed [Disk error]` を確認。`trades/10008785217` 退避再生成後も再現したため、戦略/判定ロジック起因は否定。現況は「約定不能の環境ブロッカー」により `closed_positions=0` と `decision=NO_GO` が継続。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.31（option2 monitor-only refresh #7）を反映。`primary=trial_v2_20260227_v50_8_30d_r3u_h1` / `secondary=trial_v2_20260227_v50_8_30d_r2v_h1` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_dual_run_status_20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_{r3u_h1,r2v_h1}.json`・`v50_8_monitor_only_status_20260227.json` を再同期。現況は `r3u_h1 window_days=0.03433046356481481`、`r2v_h1 window_days=0.020543085810185185`、両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.28（option2 monitor-only refresh #6）を反映。`primary=trial_v2_20260227_v50_8_30d_r3u_h1` / `secondary=trial_v2_20260227_v50_8_30d_r2v_h1` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_dual_run_status_20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_{r3u_h1,r2v_h1}.json`・`v50_8_monitor_only_status_20260227.json` を再同期。現況は `r3u_h1 window_days=0.03254450289351852`、`r2v_h1 window_days=0.018644091678240743`、両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.27（option2 monitor-only refresh #5）を反映。`primary=trial_v2_20260227_v50_8_30d_r3u_h1` / `secondary=trial_v2_20260227_v50_8_30d_r2v_h1` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`v50_8_trial_judge_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_dual_run_status_20260227.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_{r3u_h1,r2v_h1}.json`・`v50_8_monitor_only_status_20260227.json` を再同期。現況は `r3u_h1 window_days=0.02197481076388889`、`r2v_h1 window_days=0.008076750578703704`、両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.26（dual-run再同期 + 発注拒否根因の確定）を反映。`current_run=r3u_h1` / `current_run_r2=r2v_h1` で eval/audit を再実行し、`v50_8_dual_run_status_20260227.json`・`v50_8_monitor_only_status_20260227.json`・`v50_8_monthly_decision_20260225.json` を再同期。runtime観測は `r3u_h1: gate_check_count=7, gap_reject_rate=0.0`、`r2v_h1: gate_check_count=1, gap_reject_rate=0.0` を確認。一方で両runとも runtime journal の `ORDER` が `retcode=5 (Disk error)` で拒否され、`closed_positions=0` / `verdict=INVALID_TRIAL` が継続。現時点の主ボトルネックは戦略条件ではなく MT5 実行経路（order send失敗）と確定。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.25（option2 monitor-only refresh #4）を反映。外部ジョブ停止なしで `current_run` / `current_run_r2` を再追従し、`primary=trial_v2_20260227_v50_8_30d_r3u_h1`・`secondary=trial_v2_20260227_v50_8_30d_r2v_h1` を正本化。`tools/xau_autobot_trial_v2_eval.sh` を両runで再実行し、`v50_8_trial_judge_*`・`v50_8_gap_analysis_20260226_runtime_r3u_h1.json`・`v50_8_gap_analysis_20260226_runtime_r2v_h1.json`・`v50_8_dual_run_status_20260226.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_monitor_only_status_20260227.json` を再同期。現況は両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.24（option2 monitor-only refresh #3）を反映。`primary=trial_v2_20260227_v50_8_30d_r3u_h1` / `secondary=trial_v2_20260227_alpha3_r2` を再評価し、`v50_8_dual_run_status_20260226.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_r3u_h1.json`・`v50_8_gap_analysis_20260226_runtime_20260227_alpha3_r2.json`・`v50_8_monitor_only_status_20260227.json` を再同期。現況は両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.23（正本run再同期）を反映。`xau_autobot_trial_v2_current_run*.json` / `v50_8_dual_run_status_20260226.json` / `v50_8_monthly_decision_20260225.json` を再照合し、`primary=trial_v2_20260227_v50_8_30d_r3u_h1`・`secondary=trial_v2_20260227_alpha3_r2` の参照整合を確認。`decision=NO_GO` 継続。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.22（r3u_h1 本線継続 + reversion副run追加）を反映。`trial_v2_20260227_v50_8_30d_r3u_h1` を本線として維持しつつ、成立データ不足（`closed_positions=0`）解消のため副runに `reversion` 構成（24h・ATR帯域解放・low-gap許容）を追加。目的は「監査の観測維持」ではなく「約定/クローズ母数の確保」であり、14日 readiness（`closed>=12`）を先に満たす運用へ戻す。
- **2026-02-27**: V50.8-P5.21（option2 monitor-only refresh #2）を反映。外部ジョブ停止なしの監視専任モードで `current_run` / `current_run_r2` を再追従し、`primary=trial_v2_20260227_v50_8_30d_r3u_h1`, `secondary=trial_v2_20260227_alpha3_r2` を正本化。`r3u_h1`/`alpha3_r2` を再評価して `v50_8_dual_run_status_20260226.json`・`v50_8_monthly_decision_20260225.json`・`v50_8_gap_analysis_20260226_runtime_r3u_h1.json`・`v50_8_gap_analysis_20260226_runtime_20260227_alpha3_r2.json` を同期更新。加えて監視専用スナップショット `v50_8_monitor_only_status_20260227.json` を追加。現況は両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、本線判定 `decision=NO_GO` 継続。
- **2026-02-27**: V50.8-P5.20（r3u 成立優先ホットフィックス）を反映。`trial_v2_20260226_v50_8_30d_r3u` の runtime journal を再監査し、`ema_gap_out_of_range` が 16/16（`ema_gap_over_atr=0.023..0.360`, 既定下限 `0.9` 未満）で全拒否される root cause を確定。運用契約として「性能評価前に成立データを確保する」ため、`r3u` 後継runでは `min_ema_gap_over_atr` を実測帯へ緩和し、`session`/`ATR ratio` も成立優先設定（24h・広帯域）へ切替える。INTERFACES 変更なし。
- **2026-02-27**: V50.8-P5.18（option1継続 / r3u+expA再同期 #2）を反映。`XAU_AUTOBOT_TRIAL_MIN_CLOSED_POSITIONS=12` を明示して `r3u/expA` を再評価し、`v50_8_trial_judge_*` / `v50_8_gap_analysis_20260226_runtime_{r3u,expA}.json` / `v50_8_dual_run_status_20260226.json` / `v50_8_monthly_decision_20260225.json` を更新。現況は `r3u window_days=0.39254`、`expA window_days=0.38709`、両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO`。
- **2026-02-27**: V50.8-P5.17（option1適用 / r3u正本・expA副run同期）を反映。`trial_v2_20260226_v50_8_30d_r3u` を正本、`trial_v2_20260226_v50_8_30d_expA` を副runとして再評価し、`v50_8_trial_judge_*` / `v50_8_gap_analysis_20260226_runtime_r3u.json` / `v50_8_gap_analysis_20260226_runtime_expA.json` / `v50_8_dual_run_status_20260226.json` / `v50_8_monthly_decision_20260225.json` を再同期。`current_run_r1` は `r3u` へ統一、`current_run_r2` は `expA` を維持。現況は `r3u window_days=0.38935`, `expA window_days=0.38390`, 両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO`。
- **2026-02-26**: V50.8-P5.16（monthly decision KPI schema正規化）を反映。`v50_8_monthly_decision_20260225.json` の `kpi_target` を `primary=3.0 / stretch=5.0` へ更新し、`monthly_primary_3pct_reached` / `monthly_stretch_5pct_reached` / `target_gap_primary_pct` / `target_gap_stretch_pct` を追加。`monthly_10pct_reached` は互換保持のみとし、本線判定は `decision=NO_GO` を維持。
- **2026-02-26**: V50.8-P5.15（trial KPI分離 + trend gapレンジ導入）を反映。XAU trial の判定契約を `readiness/performance` 分離へ更新し、judge既定の `min_closed_positions` を 14日窓 `12` へ調整（環境変数で上書き可）。あわせて `xau_autobot.py` に `ema_gap_over_atr` レンジゲート（既定 `0.9..2.5`）を導入し、弱トレンド誤爆と過伸展逆行を同時に抑制する方針を正本化。
- **2026-02-26**: V50.8-P5.14（r1s2/r3 refresh #3 + run-meta正規化）を反映。実行実態が `r1s2+r3` であることを再確認し、`xau_autobot_trial_v2_current_run_r2.json` の `run_id=r3` と整合する形で副run正本を `r3` に固定。`v50_8_trial_judge_*`（`r1s2/r3`）・`v50_8_gap_analysis_20260226_runtime_r1s2.json`・`v50_8_gap_analysis_20260226_runtime_r3.json`・`v50_8_dual_run_status_20260226.json`・`v50_8_monthly_decision_20260225.json` を再同期し、`xau_autobot_trial_v2_current_run_r1.json` も primary 正本へ同期。現況は `r1s2 window_days=0.10073652298611112`、`r3 window_days=0.028305582743055554`、両runとも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線 `decision=NO_GO` を維持。
- **2026-02-26**: V50.8-P5.13（r1s2/r3 daily refresh #2）を反映。`r1s2`/`r3` を再評価し、`v50_8_trial_judge_*`・`v50_8_gap_analysis_*`・`v50_8_dual_run_status_20260226.json`・`v50_8_monthly_decision_20260225.json` を同期更新。現況は `r1s2 window_days=0.09868`、`r3 window_days=0.02624`、いずれも `closed_positions=0` / `verdict=INVALID_TRIAL`、watchdog は `CONTINUE`、本線判定 `decision=NO_GO` を維持。
- **2026-02-26**: ユーザー選択 `option=1` を反映し、IHトラックを停止。`ih_opt_*` の新規 run/追加ゲートを凍結し、`V50.8` の改善対象を `XAU単独トラック` へ一本化。
- **2026-02-26**: V50.8-P5.12（r2rv monitoring loop）を反映。`r2rv` を5サイクル監視したが `closed_positions=0` のまま。`open_floating_profit` は `404 -> 512 -> 496 -> 488 -> -276` と変動し、建玉は維持。`v50_8_*` 判定/ギャップ/dual-run/月次判定を再同期し、`decision=NO_GO` を維持。
- **2026-02-26**: V50.8-P5.11（r1s2/r2rv daily refresh #2）を反映。`r1s2` は `window_days=0.03507` で `INVALID_TRIAL` 継続、`r2rv` は `window_days=0.00489` で `INVALID_TRIAL` 継続。`r2rv` live report の `open_snapshot` は `open_positions=1`, `open_floating_profit=80.0` を観測。`v50_8_monthly_decision_20260225.json` は本線 `r1s2` 基準で再同期し `decision=NO_GO` を維持。
- **2026-02-26**: V50.8 KPI再設定（Option 3）を反映。収益KPIを **主KPI: 月利3% / ストレッチ: 月利5%** に更新し、`monthly10` 表記は履歴参照に格下げ。
- **2026-02-26**: V50.8-P6.3（KPI 3%再判定）を反映。既存5ランを `tools/mt5_ih_promotion_gate.py`（`monthly>=3%`, `trades>=5`, `PF>=1.0`, `DD<=12%`, `forward_days=366`）で再評価し、`data/reports/v50_8_mt5_monthly3target_scan_20260226.json` を生成。結果は `decision_files=5`, `accepted_count=0`、best は `ih_opt_monthly3_20260224_224129.monthly3target.decision.json`（`monthly_cagr_pct=2.3078`, `trades=3`, `PF=0.0`）。
- **2026-02-26**: V50.8-P6（monthly15 runtime）を完了更新。`logs/mt5_monthly15_wait_and_gate_20260226_084916.log` で `17:14 JST` の `reports detected, running gate` を確認し、`data/reports/mt5/ih_opt_monthly15_20260225_152054.decision.json` を生成。判定は `accept_for_promotion=false`（`monthly_cagr_pct=2.2929`, `trades=3`, `PF=0.0`, `DD=10.7971`）、`data/reports/v50_8_monthly15_runtime_status_20260226.json` は `completed=true`。
- **2026-02-26**: V50.8-P5.10（r2rv探索ローテーション）を反映。`r2a`（trend）は `HOLD` のため見送り、`reversion` 構成 `r2rv`（`magic=560083`）へ切替。単発診断で `ORDER(retcode=10009)` を確認し、`r2rv` live report に `open_positions=1` を観測。`v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r2rv.json` / `v50_8_gap_analysis_20260226_runtime_r2rv.json` / `v50_8_dual_run_status_20260226.json`（`primary=r1s2`, `secondary=r2rv`）を更新。
- **2026-02-26**: V50.8-P5.9（r2sc副run再開）を反映。`r1s2` 本線を維持したまま `r2sc` を `xau_autobot_trial_v2_current_run_r2.json`（lock分離）で再起動し、2本の live loop 並走を復帰。`xau_autobot_trial_judge_trial_v2_20260226_v50_8_30d_r2sc.json` は再起動直後のため `verdict=INVALID_TRIAL`（`window_days=0.000367`）、watchdog は `CONTINUE` を確認。`v50_8_dual_run_status_20260226.json` を `primary=r1s2`, `secondary=r2sc` へ再生成。
- **2026-02-26**: V50.8-P5.8（r1s2 daily judge refresh）を反映。`trial_v2_20260226_v50_8_30d_r1s2` を再評価し、`window_days=0.003376/14`・`closed_positions=0` のため `verdict=INVALID_TRIAL` を確認。`v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r1s2.json` / `v50_8_monthly_decision_20260225.json` / `v50_8_gap_analysis_20260226_runtime_r1s2.json` / `xau_autobot_trial_watchdog_trial_v2_20260226_v50_8_30d_r1s2.json` を同期更新。単発診断 `xau_autobot_live_loop.ps1 -Live -Once` は `action=HOLD` で、`session/volatility/comment` 由来の BLOCKED/REJECT ではなくシグナル待機が主因と判定。
- **2026-02-26**: V50.8-P5.7（r1scローテーション）を反映。`r2sc` の `trial_valid=true` / `net_profit=-5232` を受けて `trial_v2_20260226_v50_8_30d_r1sc`（`magic=560080`）へ切替。`v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r1sc.json` / `v50_8_monthly_decision_20260225.json` / `v50_8_gap_analysis_20260226_runtime_r1sc.json` を同期更新。trial 運用契約は single-runner 固定から `magic/comment_prefix` 分離計測（並走許容）へ更新。
- **2026-02-26**: V50.8-P5.6（r2sc close反映）を更新。`trial_v2_20260226_v50_8_30d_r2sc` で `closed_positions=3` を確認し、judge は `trial_valid=true` / `verdict=NO_GO`（`window_days=0.4233`）。`v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r2sc.json` / `v50_8_monthly_decision_20260225.json` / `v50_8_gap_analysis_20260226_runtime_r2sc.json` を同期更新。
- **2026-02-26**: V50.8-P5.6（MT5 comment 制約対応）を反映。`r2` の実バー診断で `action=ORDER` が出る一方、`order_result.error=(-2, 'Invalid "comment" argument')` により発注が全拒否される root cause を確認。`r2sc` へ切替後は `magic=560079` の実ポジションが立つことを確認（発注経路復旧）。あわせて `xau_autobot_trial_v2_eval.sh` の `comment_prefix` を先頭16文字へ正規化し、MT5履歴 comment truncation と trial 集計条件を一致させた（INTERFACES変更なし）。
- **2026-02-26**: Sランク生成フロー最適化（TFフォーカス）を反映。breeder の既定時間足方針を `M5` 除外・`H1/H5` 優先へ更新し、`*breeder-timeframe-excluded-minutes*=(5)` / `*breeder-timeframe-priority-minutes*=(60 300)` を正本化。親TFが除外対象でも child は許可TFへフォールバックし、`M5` への再固定を回避する契約を追加（INTERFACES変更なし）。
- **2026-02-26**: Sランク生成フロー最適化（短TF補正）を反映。`*breeder-timeframe-short-parent-max-minutes*=30` / `*breeder-timeframe-short-parent-mutation-floor*=0.55` を導入し、親が `M15/M30` に偏る局面で child の mutation rate 下限を適用する契約を追加。短TF親ペアの `M15/M30` 固定化を抑制し、`H1/H5` 優先プールへの遷移を促進する（INTERFACES変更なし）。
- **2026-02-26**: Sランク生成フロー最適化（短TF親ペア選抜補正）を反映。`breeding-partner-score` に短TF親向け lane bias を追加し、`H1/H5` 優先候補へ加点、`M15/M30` 短TF候補へ減点する契約を正本化。mutation 段だけでなく親選抜段から短TF再結合を抑制し、中期足探索の比率を引き上げる（INTERFACES変更なし）。
- **2026-02-26**: V50.8-P5（r2 daily judge refresh #2）を更新。`trial_v2_20260226_v50_8_30d_r2` を `XAU_AUTOBOT_TRIAL_WATCHDOG_ENABLED=1` で再評価し、`window_days=0.0088/14`、`closed_positions=0`、`verdict=INVALID_TRIAL` を確認。`xau_autobot_trial_watchdog_trial_v2_20260226_v50_8_30d_r2.json` は `decision=CONTINUE`（`window_hours=0.2114/24`, `triggered=false`）で、zero-trade fail-closed は未発火。`v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r2.json` / `v50_8_monthly_decision_20260225.json` / `v50_8_gap_analysis_20260226_runtime_r2.json` を同期更新。
- **2026-02-26**: V50.8-P5.5（entry unblocking / r2正本化）を反映。`xau_autobot.trial_v2_20260226_v50_8_30d_r2.json`（`session=0-23`, `atr_ratio_filter=0.0-999.0`, `magic=560077`）を追加し、run を `trial_v2_20260226_v50_8_30d_r2` へ切替。Windows 側では他シンボル運用（`USDJPY/EURUSD`）が別途稼働中だが、**XAU trial 対象config は `..._30d_r2` のみ**を確認。`xau_autobot_trial_judge_trial_v2_20260226_v50_8_30d_r2.json` / `v50_8_trial_judge_trial_v2_20260226_v50_8_30d_r2.json` / `v50_8_monthly_decision_20260225.json` / `v50_8_gap_analysis_20260226_runtime_r2.json` を更新（開始直後のため `INVALID_TRIAL`、`decision=NO_GO` 継続）。
- **2026-02-26**: V50.8-P5.5（dual-run 並走）を反映。`r1`（`..._r1.json`/`magic=560076`）と `r2`（`..._r2.json`/`magic=560077`）の live loop を同時起動し、run meta を `xau_autobot_trial_v2_current_run.json`（本線）と `xau_autobot_trial_v2_current_run_r2.json`（探索）に分離。`xau_autobot_trial_judge_trial_v2_20260225_v50_8_30d_r2.json` / `v50_8_trial_judge_trial_v2_20260225_v50_8_30d_r2.json` を生成し、`v50_8_dual_run_status_20260226.json` を追加。
- **2026-02-26**: V50.8-P5 の日次 judge を再更新（#8）。`trial_v2_20260225_v50_8_30d_r1` の再評価で `window_days=0.7211/14` へ進行。`closed_positions=0` のため `INVALID_TRIAL` / `NO_GO` は継続し、`diagnostics={history_deals_scanned:16, after_magic_filter:0, after_comment_prefix_filter:0, top_magics:[560190,560160,560145]}` を確認。`v50_8_trial_judge_trial_v2_20260225_v50_8_30d_r1.json` / `v50_8_monthly_decision_20260225.json` / `v50_8_gap_analysis_20260225_runtime_r1.json` を最新 judge へ再同期。
- **2026-02-26**: V50.8-P5.4（single-runner clean-up）を反映。Windows 側の `xau_autobot.py --live` 多重起動（`trial_v2_20260222`/`tuned_auto_active`/`live_named_*`/旧trial）を停止し、`trial_v2_20260225_v50_8_30d_r1` 単独稼働へ収束。`Swimmy-XAU-Cycle` を `Disabled`、Startup の `Swimmy-XAU-Exec.vbs` を `.disabled_20260226_084917` へ退避。再評価で混線は解消したが、trial対象約定は未発生（`after_magic_filter=0`, `after_comment_prefix_filter=0`）のため `INVALID_TRIAL` / `decision=NO_GO` 継続。
- **2026-02-26**: V50.8-P6.2 を完了更新。`ih_opt_monthly10_20260225_001800.xml/.forward.xml` の生成と `logs/mt5_monthly10_wait_and_gate_20260225_215746.log` の gate完了を確認し、`data/reports/mt5/ih_opt_monthly10_20260225_001800.decision.json` を正本化。結果は `accept_for_promotion=false`（`monthly_cagr_pct=2.2477`, `trades=3`, `PF=0.0`, `DD=11.0348`）。`v50_8_monthly10_runtime_status_20260225.json` は `latest_progress_pct=99`, `completed=true` へ更新し、`v50_8_mt5_monthly10_scan_20260225.json` は `decision_files=4`（`accepted_count=0`）へ再集約。
- **2026-02-26**: V50.8-P5 の日次 judge を再更新（#7）。`trial_v2_20260225_v50_8_30d_r1` の再評価で `window_days=0.7125/14` へ進行。`closed_positions=0` のため `INVALID_TRIAL` / `NO_GO` は継続し、`diagnostics={history_deals_scanned:16, after_magic_filter:0, after_comment_prefix_filter:0}` を確認。
- **2026-02-25**: Sランク生成フロー最適化（分離トラック）を追補。`run-b-rank-culling-for-category` の bootstrap 上限既定値を `A<=8` へ拡張し、`B<count threshold` でも A母集団が小さい間は B→A 昇格キューを継続する契約を追加（閾値本体・INTERFACES変更なし）。
- **2026-02-25**: Sランク生成フロー最適化（分離トラック）を反映。`school-breeder` の親選抜ペナルティ既定値を A Stage1 基準（`0.45/1.30/0.43/0.16`）へ更新し、A-base 未達親の OOS ボーナスは既定 `0.20x` に減衰する契約を追加。ランク閾値・INTERFACES 変更はなし。
- **2026-02-25**: V50.8-P5 の日次 judge を再更新（#5）。`trial_v2_20260225_v50_8_30d_r1` の再評価で `window_days=0.2614/14` まで進行。`closed_positions=0` のため `INVALID_TRIAL` / `NO_GO` は継続し、`v50_8_monthly_decision_20260225.json` と `v50_8_gap_analysis_20260225_runtime_r1.json` を更新。
- **2026-02-25**: V50.8-P5 の日次 judge を再更新（#4）。`trial_v2_20260225_v50_8_30d_r1` の再評価で `window_days=0.2571/14` まで進行。`closed_positions=0` のため `INVALID_TRIAL` / `NO_GO` は継続し、`v50_8_monthly_decision_20260225.json` と `v50_8_gap_analysis_20260225_runtime_r1.json` を更新。
- **2026-02-25**: V50.8-P6.2 runtime 進捗を再更新。`ih_opt_monthly10_20260225_001800` は `AutoTesting 57%`（`21:55 JST`）に到達し、推定完了は `2026-02-26 03:44 JST`。`monthly10 decision json` は未生成で待機継続（active wait log: `mt5_monthly10_wait_and_gate_20260225_215746.log`）。
- **2026-02-25**: V50.8-P5 の日次 judge を再更新（#3）。`trial_v2_20260225_v50_8_30d_r1` の再評価で `window_days=0.2333/14` まで進行、`closed_positions=0` により `INVALID_TRIAL` / `NO_GO` 継続。`v50_8_monthly_decision_20260225.json` と `v50_8_gap_analysis_20260225_runtime_r1.json` を更新。
- **2026-02-25**: V50.8-P6.2 runtime 進捗を再更新。`ih_opt_monthly10_20260225_001800` は `AutoTesting 51%`（`21:14 JST`）に到達し、推定完了は `2026-02-26 03:56 JST`。`monthly10 decision json` は未生成で待機継続。
- **2026-02-25**: V50.8-P5 の日次 judge を再更新（#2）。`trial_v2_20260225_v50_8_30d_r1` の再評価で `window_days=0.1552/14` まで進行、`closed_positions=0` のため `INVALID_TRIAL` / `NO_GO` は継続。`v50_8_monthly_decision_20260225.json` と `v50_8_gap_analysis_20260225_runtime_r1.json` を更新。
- **2026-02-25**: V50.8-P6.2 runtime 進捗を再更新。`ih_opt_monthly10_20260225_001800` は `AutoTesting 35%`（`19:24 JST`）に到達し、推定完了は `2026-02-26 04:54 JST`。`monthly10 decision json` は未生成で待機継続。
- **2026-02-25**: V50.8-P5 の日次 judge 更新を反映。`XAU_AUTOBOT_TRIAL_RUN_ID=trial_v2_20260225_v50_8_30d_r1 tools/xau_autobot_trial_v2_eval.sh` を再実行し、`xau_autobot_trial_judge_trial_v2_20260225_v50_8_30d_r1.json` / `v50_8_trial_judge_trial_v2_20260225_v50_8_30d_r1.json` / `v50_8_monthly_decision_20260225.json` を更新。現況は `INVALID_TRIAL`（`window_days=0.0226/14`、約定0件）で `decision=NO_GO` 継続。`v50_8_gap_analysis_20260225_runtime_r1.json` を追加。
- **2026-02-25**: V50.8-P6.2 runtime 進捗を再計測。`v50_8_monthly10_runtime_status_20260225.json` を更新し、`ih_opt_monthly10_20260225_001800` の最新進捗 `13%`（`16:12:43 JST`）と推定完了 `2026-02-26 05:07 JST` を記録。`mt5_monthly10_wait_and_gate_20260225_141236.log` は report 生成待機継続。
- **2026-02-25**: V50.8-P5.3（controlled cutover）を反映。実運用runを `trial_v2_20260225_v50_8_30d_r1` へ切替し、`tools/configs/xau_autobot.trial_v2_20260225_v50_8_30d_r1.json` で `xau_autobot_live_loop.ps1 -Live` が稼働する状態を正本化。`xau_autobot_trial_v2_current_run.json` を更新し、`xau_autobot_trial_judge_trial_v2_20260225_v50_8_30d_r1.json` / `v50_8_trial_judge_trial_v2_20260225_v50_8_30d_r1.json` / `v50_8_monthly_decision_20260225.json` を再生成（開始直後のため `INVALID_TRIAL`、`decision=NO_GO` 継続）。
- **2026-02-25**: V50.8-P5（再最適化ラウンド1）を反映。`xau_autobot_optimize_20260225_v50_8_p5_r1.jsonl` を追加し、entry制約を絞った 30d 候補 `xau_autobot.trial_v2_20260225_v50_8_30d_r1.json` を生成。rank1 は `pullback_atr=0.3 / sl_tp=2.0/3.0 / session=8-17 / atr_band=0.95-1.30`。実運用runは窓維持のため据え置き。
- **2026-02-25**: V50.8-P6.2 の runtime進捗可視化を追加。`data/reports/v50_8_monthly10_runtime_status_20260225.json` を生成し、`ih_opt_monthly10_20260225_001800` の最新進捗 `52%` と推定完了時刻 `2026-02-26 03:54 JST`（線形近似）を記録。
- **2026-02-25**: V50.8-P6（IH monthly10ゲート）を反映。`data/reports/v50_8_mt5_monthly10_scan_20260225.json` を追加し、既存forward 3ランの `monthly>=10%` 判定が `accepted_count=0`（best `monthly_cagr_pct=2.3078`）であることを正本化。`ih_opt_monthly10_20260225_001800` は Terminal log で start config 起動と `Tester automatical testing started` を確認済みで、`logs/mt5_monthly10_wait_and_gate_20260225_141236.log` にて report生成待機中（`xml/.forward.xml` 未生成）。
- **2026-02-25**: V50.8-P2 を `30d` 候補へ切替。`tools/configs/xau_autobot.trial_v2_20260225_v50_8_30d.json` を追加し、run_id を `trial_v2_20260225_v50_8_30d` へ更新。`xau_autobot_trial_v2_current_run.json` の正本を更新し、`xau_autobot_live_loop.ps1 -Live` が `magic=560075/comment=xau_autobot_trial_v2_20260225_v50_8_30d` で稼働していることを確認。`v50_8_candidate_rank_20260225.json` は `30d`（`monthly_return_est_pct=10.0742`）選抜へ更新し、`v50_8_trial_judge_trial_v2_20260225_v50_8_30d.json` / `v50_8_monthly_decision_20260225.json` を再生成（現時点は `INVALID_TRIAL` のため `decision=NO_GO`）。
- **2026-02-25**: V50.8-P4（identity整合プローブ）を反映。`trial_v2_20260225_identity_probe` の 14日判定で `trial_valid=true` かつ `verdict=NO_GO` を確認し、`after_magic_filter/comment_prefix_filter` は通過（`53/27`）。未達の主因を `PF/WR/net_profit` 不足へ更新。`data/reports/v50_8_gap_analysis_20260225.json` を追加。
- **2026-02-25**: V50.8-P2 run切替を反映。`tools/configs/xau_autobot.trial_v2_20260225_v50_8.json` を追加し、run_id を `trial_v2_20260225_v50_8` へ更新。あわせて `tools/xau_autobot_trial_v2_eval.sh` は `XAU_AUTOBOT_TRIAL_CONFIG` 未指定時に run metadata の `trial_config` を優先するよう修正し、評価時の `symbol/magic/comment_prefix` を run_id と整合させた。回帰テスト `tools/tests/test_xau_autobot_trial_v2_eval.py` は `3 passed`。`v50_8_trial_judge_trial_v2_20260225_v50_8.json` と `v50_8_monthly_decision_20260225.json` を更新（`NO_GO` 継続）。
- **2026-02-25**: 方針競合を解消。ユーザー選択 `option=2` により `A19再評価GO` を正本化し、`V50.8` を継続トラックとして更新（打ち切り判断は履歴扱い）。
- **2026-02-25**: V50.8-P0/P1/P2 初回実行を反映。`v50_8_baseline_20260225.json`（基準固定）、`v50_8_candidate_rank_20260225.json`（候補再ランク）、`v50_8_trial_judge_trial_v2_20260224_60d_manualcheck.json`（trial判定）を追加。P2は `INVALID_TRIAL`（identity不一致）で継続監視。
- **2026-02-25**: 収益化トラックの期限付き運用契約（ユーザー承認）を反映。`2026-03-03`（paper/slippage証拠ゲート）・`2026-03-17`（forward損益ゲート）・`2026-03-18`（最終Go/Stop判定）を固定し、無期限継続を禁止。
- **2026-02-25**: `tools/ops/armada_paper_readiness.py` を更新し、`Synthetic-Close-Probe-*` をデフォルト除外、runtime guard を直近N件（既定20）で判定するよう変更。`tools/tests/test_armada_paper_readiness.py` に3件追加し `6 passed` を確認。実DB再計測 `data/reports/armada_paper_readiness_20260225_runtime_window_default.json` で `decision=GO`（`runtime_window_net_pnl=1.103113...`）を確認。
- **2026-02-25**: V50.7-A19 の打ち切りを反映。`swimmy-armada-paper-readiness.timer/service` を停止し、timer を `disabled` へ変更。`A19` は未達（`paper=2/20`, `slippage=0/20`）のまま終了し、次トラックを `V50.8`（主KPI: 月利10%）へ移行。
- **2026-02-24**: V50.7-A19 追補6を反映。`trade_logs.execution_mode={LIVE:1, SHADOW:2, PAPER:0}` を再確認し、`swimmy-armada-paper-readiness.service` 手動実行で `data/reports/armada_paper_readiness_20260224_fix10refresh.json`（`generated_at=2026-02-24T13:47:07.263282+00:00`）を更新。`decision=HOLD`（`paper_trade_count=2/20`, `slippage_sample_count=0/20`）継続を正本化。
- **2026-02-24**: V50.7-A20 を完了更新。`trade_logs.execution_mode={LIVE:1, SHADOW:2, PAPER:0}` を確認し、`data/reports/armada_paper_readiness_20260224_a20_timeoutfix.json`（`generated_at=2026-02-24T13:44:55.827558+00:00`）で `paper_trade_count=2/20` まで進捗したことを正本化。
- **2026-02-24**: shadow evidence 停滞対策を追加。`close-a-rank-shadow-positions` に `*shadow-max-hold-seconds*`（既定3600秒）超過時の timeout close（`hit=:timeout`）を実装し、`test-close-a-rank-shadow-positions-closes-timeout-slot` の RED/GREEN と shadow回帰4件の通過を確認。
- **2026-02-24**: founder overflow回帰を修正。`cull-pool-overflow` が founder recovery 候補を保護せず `DEATHMATCH` で `:GRAVEYARD` 化していたため、保護条件を追加。RED/GREEN は `test-breeder-cull-protects-founder-recovery-candidate` で確認し、`sample 17`（22:11 JST）で `B=3/Graveyard=0` 復帰を確認。
- **2026-02-24**: V50.7-A20 初動を反映。`reseed_active_b.py` 実適用（`updated=142`）と service 再読込後、`strategies.rank` 実測が `:A=5` まで復帰。A20は「A復帰」達成、残件は `SHADOW/PAPER` 証拠増分。
- **2026-02-24**: V50.7-A20 を起票。`A-rank=0`（`B=2, LEGEND=61`）と `SHADOW/PAPER=0` を実測し、A19完了条件の前提不足を明文化。`reseed_active_b.py --dry-run`（`would_update=142`）を次アクション候補として追加。
- **2026-02-24**: V50.7-A19 追補2を反映。`data/reports/armada_paper_readiness_20260224_followup2.json`（`generated_at=2026-02-24T12:56:29Z`）を追加し、`decision=HOLD` 継続を確認。あわせて `swimmy-armada-paper-readiness.service` 手動実行 `status=0/SUCCESS` と `armada_paper_readiness_20260224_fix10refresh.json` 更新（`generated_at=2026-02-24T12:58:06Z`）を確認。
- **2026-02-24**: V50.7-A19 の自動実行基盤を追加。`tools/ops/armada_paper_readiness_runner.sh` と `swimmy-armada-paper-readiness.service/timer`、`tools/install_armada_paper_readiness_service.sh` を正本化し、`L3 paper readiness` を日次バッチ実行できる運用経路を追加。runner の既定入力は固定日付ではなく `fix10` 系最新レポートを自動解決する。`SWIMMY_SYSTEMD_SCOPE=user` で timer を有効化し、service 手動起動 `status=0/SUCCESS` まで確認済み。
- **2026-02-24**: founder 3通貨再監視ジョブを再起動。`founder_rank_watch_20260224_114359.service`（transient）を起動し、`data/reports/founder_rank_watch_20260224_114359.jsonl` へ記録開始。初回サンプルは `B=1/Graveyard=2`（`drift=True`）で、再発停止確認は継続中。
- **2026-02-24**: V50.7-A19 追補を反映。`data/reports/armada_paper_readiness_20260224_followup.json` を生成し、`decision=HOLD`（`paper_evidence_shortage: 0/20`, `slippage_samples_shortage: 0/20`）継続を正本化。
- **2026-02-24**: V50.7-A17（L3 paper evidence 現況スナップショット）を反映。`trade_logs.execution_mode={SHADOW:0, PAPER:0, LIVE:1}` を確認し、`primary (SHADOW+PAPER)=0/20` の未進捗を正本化。
- **2026-02-24**: founder 3通貨監視の再評価を反映。`founder_rank_watch_20260223_121322.jsonl` で `sample 169` 以降 `B=1/Graveyard=2` 逸脱を確認し、`journalctl` で `Operation Black Death (Low Sharpe)` による `B->GRAVEYARD` 実 demote を根因として確定。`school-pruning.lisp` に founder recovery 例外を追加し、`test-prune-low-sharpe-keeps-founder-recovery-candidate` を正本化。
- **2026-02-23**: V50.7-A15（L3 paper readiness更新）を反映。`data/reports/armada_paper_readiness_20260223_fix10refresh.json` を追加し、`decision=HOLD`（`paper_evidence_shortage: 0/20`, `slippage_samples_shortage: 0/20`）を正本化。
- **2026-02-23**: V50.7-A14（C1 refresh fix10反映版）を反映。`b1r_completed=true` を投入判定へ反映し、strict/proxy とも `deploy_decision=保留` を確認（主要残課題: `strict bt_ok=0` と `L3 paper evidence`）。
- **2026-02-23**: V50.7-A12 の最終評価を反映。`fix10` ミックスで `both_players_pass_count=4/5`（`b1r_completed=true`）を確認し、B1R完了扱いへ更新。
- **2026-02-23**: V50.7-A13（Armada OOS再ランク）を反映。`tools/ops/armada_player_replica.py` の `--oos-rerank-pool` 実装と `fix10a` seed47 回復実測（`top3_oos_ok=1`）を正本化。
- **2026-02-23**: V50.7-A9/A10/A11 の実行結果を反映。`A9` は `fix6d` で達成、`A10` は `3/5` 到達だが未完、`A11`（seed23/fix6e）で `top3_oos_ok=1` を確認。
- **2026-02-23**: `fix7b`（seed47 hold-bars=1.2..6.0）は `Broken pipe (os error 32)` で出力未生成となる `FAILED_PARTIAL` 扱いを正本化（`armada_b1r_fix7_seed47_evaluation_20260223.json`）。
- **2026-02-20**: Trade close 経路の narrative 依存を廃止。`generate-trade-result-narrative` ではなく fixed template 通知を正本化。
- **2026-02-20**: `TRADE_CLOSED` 学習文脈の正本を payload に統一し、Executor の slot allocation 補完依存を削減する方針を正本化。
- **2026-02-20**: Allocation 用語を `warrior` から `slot` へ移行する方針を追加。`Execution Slot Allocation` を正本語彙として運用・実装・通知文言を統一する。
- **2026-02-20**: Live trade-close 整合監査を追加。`tools/check_live_trade_close_integrity.py` を新設し、`trade_logs` 文脈欠落（Unknown/NIL）と `POSITIONS` S式不整合の再発を運用監査で検知する方針を正本化。`tools/system_audit.sh` に同チェックを統合。
- **2026-02-20**: Live trade-close の連続監視スクリプト `tools/watch_trade_close_loop.sh` を追加。トレード未発生時の timeout を自動再試行し、次回クローズ発生時の整合確認を取りこぼさない運用へ更新。
- **2026-02-20**: Rank conformance監査の差分基準を更新。`tools/check_rank_conformance.py` は `rank_conformance_latest.json` 直前値ではなく、履歴ディレクトリ内の「前日以前の最新スナップショット」を基準に `promotion/demotion/by_route` を算出する方針を正本化。
- **2026-02-20**: V50.7-P0 の Edge Scorecard 契約を追加。`tools/edge_scorecard.py` で KPI-0〜KPI-3 を latest+history へ保存し、欠損データは `degraded` で可観測化する方針を正本化。
- **2026-02-20**: V50.7-P1 の System Audit 統合契約を追加。`tools/system_audit.sh` で `tools/edge_scorecard.py` を WARN ステップとして日次実行し、`Edge scorecard summary` を監査ログに残す方針を正本化。
- **2026-02-21**: V50.7-P3 の KPI定義契約を追加。Edge Scorecard の `KPI-0..3` についてデータソース（`deployment_gate_status` / `trade_logs` / `rank_conformance_latest.json` / `strategies`）と `degraded` 判定条件、`overall_status` 集約条件を正本化。
- **2026-02-21**: V50.7-P2 の Discord通知契約を追加。`edge_scorecard` の `discord-when=problem` は `degraded/critical` のみ通知し、`ok` は通知しない方針を正本化。通知は Notifier経由キューイングを標準とする。
- **2026-02-21**: V50.7-P4 の専用タイマー契約を追加。`swimmy-edge-scorecard.service/timer` と `tools/install_edge_scorecard_service.sh` により Edge Scorecard を単独で日次実行・運用有効化できる方針を正本化。
- **2026-02-21**: V50.7-P4.1 の installer scope 契約を追加。`install_edge_scorecard_service.sh` は system/user scope を切替可能とし、sudo不可環境でも `--user` で有効化できる方針を正本化。
- **2026-02-21**: V50.7-P4.2 の unit権限契約を更新。`swimmy-edge-scorecard.service` の正本は system scope（`User=swimmy`）を維持しつつ、`install_edge_scorecard_service.sh` の user scope では配置時に `User=`/`Group=` を除去したコピーを生成する方針へ修正（`status=216/GROUP` 回避）。
- **2026-02-21**: `tools/system_audit.sh` の auto-repair ノイズ抑制を追加。`systemctl is-enabled` で既に有効な unit には `enable` を再実行せず、`enable` のみ権限不足な環境で不要 WARN を増やさない方針を正本化。
- **2026-02-21**: 回帰テスト安定化契約を更新。`test-periodic-maintenance-flushes-stagnant-c-rank` は run-all 時に他 timeout バッファ通知が混在しうるため、`Stagnant C-Rank Summary` を含む通知のみ抽出して評価し、順序依存で誤FAILしない方針を正本化。
- **2026-02-21**: Live 実行経路の Rank件数ゲート禁止契約を追加。`process-category-trades` の前段で `S-rank` 件数しきい値による全体停止を行わず、`deployment_gate_status(LIVE_READY)` + `Live Edge Guard` を発注可否の正本に統一する方針を正本化。
- **2026-02-21**: Forward evidence source 契約を追加。`deployment_gate_status` の `forward_*` 指標は `trade_logs.execution_mode` の `SHADOW/PAPER` を正本（互換で `LIVE` も許容）として集計し、`LIVE_ONLY` の循環ゲートを避ける方針を正本化。
- **2026-02-21**: Evolution Report のパーセント表記契約を更新。`candidate-rank-label` の `CPCV PENDING` 文言は `%` を単一表記とし、レポート文字列に `%%` が混入しないことを正本化。
- **2026-02-21**: Evolution Report の `Learning Logs` 表記契約を更新。`learning-log-summary-line` の勝率表記は `%` を単一表記とし、レポート全体で `%%` が混入しないことを正本化。
- **2026-02-21**: Rank demotion 永続化契約を更新。`ensure-rank` 経路で `A->B` などの明示降格を行う際、`upsert-strategy` の active-rank regression guard を意図的にバイパスする動的束縛を必ず有効化し、DB rank が旧ランクへ巻き戻らないことを正本化。
- **2026-02-20**: Live trade-close 監査の fail-closed 契約を更新。`tools/check_live_trade_close_integrity.py` は `DB not found` / `trade_logs` クエリエラー時に WARN 成功へ落とさず FAIL（exit 1）にする。`tools/system_audit.sh` は `LIVE_TRADE_CLOSE_AFTER_ID` を渡して historical 不良行を除外できる。
- **2026-02-20**: `trade_logs` の legacy 不良データ（`id=1..7`, `Unknown/NIL`）を `trade_logs_archive_20260220_205326` へ退避し、主テーブルから削除して live 監査基盤をリフレッシュ。`sqlite_sequence(trade_logs)=7` を維持し、次回新規行は `id=8` から継続する運用とした。
- **2026-02-20**: MT5 `POSITIONS` S式整合契約を追加。`(data . (...))` を含む整形式 alist（0件時は `(data . ())`）を必須化し、括弧不整合メッセージで Dispatcher が `Unsafe/invalid SEXP` 棄却する事象を防ぐ方針を正本化。
- **2026-02-20**: OOS dispatch の範囲算出契約を更新。`70/30 split` ではなく `*oos-fixed-window-days*`（既定180日）を正本として `start_time/end_time` を算出する方針を追加。
- **2026-02-20**: 実運用 Go/No-Go 契約を追加。`deployment_gate_status` を新設し、`BLOCKED_OOS/FORWARD_RUNNING/FORWARD_FAIL/LIVE_READY` を strategy 単位で永続化する方針を正本化。
- **2026-02-20**: Forward Go/No-Go のレポート契約を追加。`data/reports/forward_status.txt` と Evolution Report の Forward行を正本化し、`LIVE_READY` 件数と失敗理由を可視化する方針を追記。
- **2026-02-20**: Legacy WFV の運用契約を更新。WFV は分析専用（テレメトリ用途）とし、`move-strategy`/rank遷移/アーカイブ移動を禁止する方針を正本化。既定値 `*wfv-enabled*` は `nil` とする。
- **2026-02-20**: Live execution gate を Rank依存から `deployment_gate_status` 依存へ強化する方針を追加。`decision=LIVE_READY` 以外は fail-closed とし、研究評価（B/A/S）と実運用可否（Go/No-Go）を実行経路で分離する。
- **2026-02-20**: 実行文脈の nil-like 戦略名（`NIL/UNKNOWN/NULL/NONE/空文字`）を fail-closed 対象に追加し、`Unknown/NIL` 文脈の trade close 学習混入を防止する方針を正本化。
- **2026-02-20**: Rank整合スイープを A/B/S 全体へ拡張する方針を追加。`run-rank-evaluation` で A/B 基準不適合の残留を毎サイクル是正する。
- **2026-02-20**: Breeder 親選抜を edge-first へ補正する方針を追加。`strategy-breeding-priority-score` に OOS/Stage1 品質の重みを反映し、低品質親の過剰交配を抑制する。
- **2026-02-20**: Breeder 親品質ハードゲート契約を追加。`can-breed-p` で非Legend親に Stage1 B 基準（Sharpe/PF/WR/MaxDD）を必須化し、弱エッジ親の交配流入を fail-closed で抑止する方針を正本化。`run-legend-breeding` の B側親も同ゲートに統一。
- **2026-02-20**: Breeder OOSハードゲート契約を追加。`can-breed-p` で A/S 親に `OOS Sharpe >= 0.35` を必須化し、OOS 欠落/未達の高ランク親を fail-closed で交配対象から除外する方針を正本化。
- **2026-02-20**: Breeder ランク整合ハードゲート契約を追加。`can-breed-p` で A/S 親に自ランク基準適合（A: TradeEvidence/A Stage1/OOS、S: TradeEvidence/S Stage1/CPCV）を必須化し、ランク名先行の弱い親流入を fail-closed で抑止する方針を正本化。
- **2026-02-20**: Live edge guard 契約を追加。`LIVE_READY` 戦略でも直近 LIVE 実績（最新40件・最小20件）で `PF>=1.05` / `WR>=35%` / `net_pnl>=0` を満たさない場合は、実行経路で fail-closed により発注停止する方針を正本化。
- **2026-02-20**: Live edge guard を連敗耐性へ拡張。`latest_loss_streak<=3` を追加し、`LIVE_READY` でも直近連敗が閾値超過なら実行経路で fail-closed により発注停止する方針を正本化。
- **2026-02-17**: Dispatcher の S式 bool互換契約を追加。`safe-read-sexp` は `#t/#f` を `t/nil` 相当として受理し、`serde_lexpr` 由来メッセージの誤 `Unsafe/invalid SEXP` を抑止する方針を正本化。
- **2026-02-17**: Dispatcher の invalid S式可観測性契約を追加。`Unsafe/invalid SEXP` ログに payload 先頭（`head`）を併記し、再現時に原因メッセージを即時特定できる方針を正本化。
- **2026-02-17**: MT5 `ORDER_REJECT` 可観測化契約を更新。sink-guard fail-closed の Discord alert は維持しつつ、送信側再送による同一 `id+reason` の短時間重複をデデュープして通知スパムを抑止する方針を正本化。
- **2026-02-17**: Evolution Report `Top Candidates` を更新。DB Active候補（Graveyard/Retired除外）を `evidence-adjusted-sharpe` でソートし、表示を `S=<adjusted> (raw <raw>)` に統一。回帰テスト（`test-top-candidates-*`）で検証済み。
- **2026-02-17**: MT5 Bridge の DeadMan 判定順序を更新。`OnTimer` で `:5560` キュー処理を Dead Man's Switch 判定より先に実行し、キュー済み HEARTBEAT 未処理による誤クローズを防ぐ方針を正本化。
- **2026-02-17**: MT5 Bridge の `ORDER_ACK/ORDER_REJECT` 応答到達性を更新。短時間再送で at-least-once 配信を許容し、Dispatcher 側は同一 `id` 重複を idempotent に処理する方針を正本化。
- **2026-02-17**: MT5 Bridge の `REQ_HISTORY` TF正規化契約を追加。`MN/MN1` と minutes文字列TFを標準ENUMへ正規化し、非標準minutesは `M1` 返却＋上位resampleへフォールバックする方針を正本化。
- **2026-02-17**: MT5 Bridge の ORDER_OPEN sink guard 契約を更新。受信 `comment` を `strategy|tf` 形式で再検証し、欠落/形式不正/NIL/不正TFを `ORDER_REJECT` で fail-closed する方針を正本化。
- **2026-02-17**: MT5 Bridge の ORDER_OPEN instrument 契約を更新。実注文で `ALL` を受理せず、`instrument/symbol` が空または nil-like（`NIL/NULL/NONE`）なら `MISSING_INSTRUMENT`、`ALL` なら `INVALID_INSTRUMENT` の `ORDER_REJECT` で fail-closed とする方針を正本化。
- **2026-02-17**: MT5 Bridge の `CLOSE_SHORT_TF` 保護契約を更新。`POSITION_COMMENT` の `tf_key` を minutes 正規化して `D1` 以上を保護し、旧形式 `|D1|W1|MN|MN1` サフィックス判定も後方互換で維持する方針を正本化。
- **2026-02-17**: MT5 Bridge の S式受信互換契約を更新。`(<key> . <value>)` と `(<key> <value>)` の両形式を受理し、bool値として `#t/#f` も解釈する方針を正本化。
- **2026-02-17**: MT5 Bridge command drain 契約を追加。`OnTimer` で `:5560` コマンドを複数件処理し、`HEARTBEAT` を symbol filter 前で受理することで ORDER_OPEN 滞留と DeadMan 誤動作を抑止する方針を正本化。
- **2026-02-17**: Aux service S式パース契約を更新。`parse_sexp_alist` は alist の短縮表記 `(key v1 v2...)` を top-level でも受理し、`(candles (... ) (...))` のような list-cdr 形式を `key -> list-value` として解釈する（`Expected alist at top level` の誤拒否を防止）。
- **2026-02-17**: Executor pending pause 契約を追加。`check-pending-orders` は execution link stale 中に retry/timeout を進めず、リンク断中の `Order Timed Out` 連発を抑止する方針を正本化。
- **2026-02-17**: Rank評価契約を更新。`run-rank-evaluation` に S conformance sweep（既存 `:S` の `check-rank-criteria :S` 再評価）を追加し、基準逸脱Sを `:A/:B` へ自動降格する方針を正本化。
- **2026-02-17**: 既存DBの S不整合ランクを是正。`s_conformance_backup_20260217` へ更新前 `:S` 行を退避し、S staged gate 不合格の `RECRUIT-RND-1768781166-12` を `:B` へ降格（`strategies.rank` 反映）した。
- **2026-02-17**: Test telemetry 隔離契約を拡張。`run-all-tests` だけでなく個別 `deftest` 実行時も telemetry 出力先を `data/memory/swimmy-tests-telemetry*.jsonl` へ固定し、検証用 fail-closed WARN（例: `ORDER BLOCKED ... NIL|M1`）が本番 `logs/swimmy.json.log` へ混入しない方針を正本化。
- **2026-02-17**: Execution link freshness gate 契約を追加。`safe-order` は MT5実行リンク（guardian heartbeat / ACCOUNT_INFO）が stale の間は fail-closed で `ORDER_OPEN` を送らず、pending retry table を増やさない方針を正本化。
- **2026-02-17**: テスト契約を現行ゲート仕様へ整合（A `TradeEvidence>=50` / S `TradeEvidence>=100` / S昇格CommonStage2）。CPCV候補・B-rank culling・promotion通知・evolution report件数の回帰テストを更新し、`test-backtest-trade-logs-insert` は `*disable-auto-migration*` を有効化して DB lock フレークを抑止。実運用ロジックの挙動変更はなし（テスト安定化のみ）。
- **2026-02-17**: `swimmy-watchdog` の timeout 運用契約を更新。`TIMEOUT_WARN/BLOCK/CLOSE` は最小 `120/300/600s` を下回らないよう clamp し、短周期 silence（約30〜90秒）での誤 `BRAIN TIMEOUT` / 不要な `swimmy-brain` 再起動ループを抑止する方針を正本化。
- **2026-02-17**: `swimmy-watchdog` の startup grace 契約を追加。`swimmy-brain` の MainPID 変更後、初回 Brain信号受信までは既定900秒の猶予を設け、起動直後の silence を timeout 判定しない方針を正本化。
- **2026-02-17**: Strategy signal 評価契約を更新。`BOLLINGER` を `BB` 同義で正規化し、`UPPER-BAND/LOWER-BAND` alias 束縛（`*-PREV` 含む）を追加して、`Hunted-BB-Reversion` 系の `LOWER-BAND is unbound` を防ぐ方針を正本化。
- **2026-02-17**: Strategy signal の symbol package 正規化契約を追加。`entry/exit` が `COMMON-LISP-USER::*` や他packageの指標シンボル（例: `SMA-20`, `BB-LOWER`, `UPPER-BAND`）を含んでも、評価器は同名束縛へ alias 解決して `unbound variable` を防ぐ方針を正本化。
- **2026-02-17**: Signal candidate scope 契約を追加。`collect-strategy-signals` は active rank（`:B/:A/:S/:LEGEND`）のみを評価し、graveyard/retired/NIL rank を live 評価ループから除外してログストームとCPU過負荷を防ぐ方針を正本化。
- **2026-02-17**: Legacy keyword logic 正規化契約を追加。`evaluate-strategy-signal` は `((:RSI-BELOW ...))` / `((:RSI-ABOVE ...))` / `((:CROSS-OVER ...))` / `((:CROSS-UNDER ...))` 形式を canonical logic へ変換してから評価し、`illegal function call` を起点とした compile-error 連鎖を防ぐ方針を正本化。
- **2026-02-17**: Timeframe canonical 契約を更新。内部表現を minutes(int) に統一し、既定8TFバケットを維持しつつ任意TF探索（例: M36/H2/H5/H60）を許容する方針を正本化。カテゴリ/相関/Pattern Gate は有限バケットへ正規化し、TF mutation pool は pending 圧で budget 制御する。
- **2026-02-17**: Rank TradeEvidence floor 契約を追加。A `>=50`、S `>=100` を必須化し、`run-rank-evaluation` の floor sweep（`S<100` 降格、`A<50` 降格）と `evaluate-a-rank-strategy` の未達即時降格を正本化。
- **2026-02-17**: 低頻度Sharpe過大評価の統計ドリフト対策を更新。Guardian の Sharpe 算出は 0 リターン日を除外せずに計算し、trade evidence が薄い戦略は rank/score で上振れしにくくする方針を正本化。
- **2026-02-17**: 既存DBのA/S証拠不足ランクを一括是正。`trade_floor_backup_20260217` を退避後に `S<50 -> B`、`50<=S<100 -> A`、`A<50 -> B` を適用し、`strategies.rank` と `data_sexp` の rank 表記を同期した。
- **2026-02-17**: Backtest停滞アラート契約を更新。`maybe-alert-backtest-stale` は pending/inflight が正のときのみ通知し、CPCV-only/idle で `Backtest停滞` を誤送信しない方針を正本化。
- **2026-02-17**: Guardian CPCV のメモリ契約を更新。`CPCV_VALIDATE` は 1リクエストにつき CSV全件ロードを1回に限定し、path/range ごとの再読込を行わない（同一バッファ再利用）方針を正本化。
- **2026-02-17**: Indicator type 正規化契約を追加。`strategy.indicators` の type が `sma` / `:SMA` / `"sma"` のように package や表現が混在しても、評価器は同一指標として解釈して束縛を生成する。`SMA-20` などの unbound で評価停止しない。
- **2026-02-17**: Logic 参照指標の補完契約を追加。`strategy.indicators` と `entry/exit` の期間参照（例: `SMA-20`）が不整合でも、評価器は参照された period 指標を history から補完束縛し、`SMA-20` unbound で評価停止しない。補完対象は `SMA/EMA/RSI/CCI/ATR/WILLIAMS` の `-<period>` と `-<period>-PREV`。
- **2026-02-17**: Logic symbol alias 解決契約を拡張。`evaluate-strategy-signal` は package/case 混在の参照シンボルをシンボル名ベースで正規化して束縛解決し、`SWIMMY.TESTS::SMA-20` やエスケープ小文字（例: `|sma-20|`, `|lower-band|`）でも unbound で評価停止しない。
- **2026-02-17**: Strategy indicator 評価契約を更新。`evaluate-strategy-signal` / `get-indicator-values` は `williams` 指標を正式サポートし、`WILLIAMS`（および period 付き変数）を常に束縛できることを正本化。`SWIMMY.SCHOOL::WILLIAMS` の unbound で評価停止しない。
- **2026-02-17**: Bollinger パラメータ正規化契約を追加。`(bb period)` のように偏差が欠落した指標は `dev=2.0` を既定補完して評価し、`NIL is not of type NUMBER` を起こさない。
- **2026-02-17**: Guardian Dead-Man timeout の運用契約を再更新。`BRAIN_TIMEOUT_SECS` は SPEC/INTERFACES と整合する `300s` を正本とし、さらに「初回 Brain motor signal 受信前」は startup grace（既定 900s）中の silence を timeout 判定しない方針を追加。長時間コールドスタート中の誤 `BRAIN DEAD DETECTED` / 不要な `swimmy-brain` restart を抑止する。
- **2026-02-17**: Guardian の Dead-Man timeout 判定契約を更新。`sub_from_brain` に未処理メッセージがあるループでは `BRAIN_TIMEOUT_SECS` 超過でも即時 Dead 判定しない（受信優先）。これにより、CPCV/Backtest の重い処理中に heartbeat がキュー済みでも `BRAIN DEAD DETECTED`/`AUTO-REVIVAL HALTED` を誤発火させない方針を正本化。
- **2026-02-17**: fail-closed 可観測性契約を追加。実行文脈欠落で注文を中止した際に Discord alert と `execution.context_missing` telemetry を出力する方針を正本化。
- **2026-02-17**: Execution fail-closed 契約を追加。`strategy_name/timeframe` が欠落した注文は `NIL`/既定TFへフォールバックせず中止し、文脈不整合を早期に顕在化させる方針を正本化。
- **2026-02-17**: ORDER_OPEN コメントの実行文脈契約を更新。`process-category-trades` で選抜したトップ戦略の `strategy_name/timeframe` を実行経路へ引き渡し、`NIL|M1` のような文脈欠落コメントを送信しない方針を正本化。
- **2026-02-17**: 実行時時間足の厳格パース契約を追加。`"NIL"`/空文字/未知ラベルの `timeframe` は `M1` へ丸めず、`execution.context_missing` を出して fail-closed で注文中止する。
- **2026-02-17**: ORDER_OPEN の sink guard 契約を拡張。`safe-order` に加えて `make-order-message` でも `comment` を厳格検証し、`strategy|tf` 形式を満たさない（`NIL` 含む）注文は MT5 送信前に fail-closed で中止する方針を正本化。
- **2026-02-17**: MT5 ORDER_OPEN 受信ガード契約を追加。`SwimmyBridge` は `comment` 欠落/形式不正/`NIL`/不正TF を `SW-<magic>` へフォールバックせず `ORDER_REJECT`（`MISSING_COMMENT/INVALID_COMMENT_FORMAT/MISSING_STRATEGY/MISSING_TIMEFRAME/INVALID_COMMENT_TF`）で fail-closed する方針を正本化。
- **2026-02-17**: Executor pending の運用契約を更新。MECU exposure 計算で pending `ORDER_OPEN` を `instrument/side/lot` で解釈し、`ORDER_ACK` 受信時に該当UUIDを `swimmy.globals:*pending-orders*` から除去する方針を正本化。
- **2026-02-17**: MT5 reject 応答契約を追加。MT5 が注文拒否時に `ORDER_REJECT`（`id`/`symbol`/`reason`/`retcode`）を返し、Dispatcher は `ORDER_REJECT` 受信時も該当UUIDを `swimmy.globals:*pending-orders*` から即時除去して timeout リトライ残留を防ぐ方針を正本化。
- **2026-02-17**: MT5 reject 可観測化契約を拡張。Dispatcher は `ORDER_REJECT.reason` が fail-closed 系（`MISSING_INSTRUMENT/INVALID_INSTRUMENT/MISSING_COMMENT/INVALID_COMMENT_FORMAT/MISSING_STRATEGY/MISSING_TIMEFRAME/INVALID_COMMENT_TF`）の場合に Discord alert を発火し、受信側 fail-closed の発生を運用面で即時検知できるようにする。
- **2026-02-17**: XAU AutoBot の運用契約を更新。`Swimmy-XAU-Cycle` の成功は「最適化成功」であり実注文稼働を意味しないことを明確化。実注文の健全判定は `xau_autobot.py --loop --live` 常駐（Exec task または Startup launcher）を正本とし、`-Live` 抜けを停止要因として扱う方針を追加。
- **2026-02-17**: Pattern Similarity の運用契約を更新。`QUERY` に `intended_direction`（BUY/SELL）を追加し、service側で `follow/fade/no-trade` の decision を返す方針を正本化。`SWIMMY_PATTERN_POLICY_MODE` 既定値は `shadow`（助言のみ、強制停止なし）とする。
- **2026-02-17**: Pattern Similarity の実装契約を更新。backend は `clip-vit-b32` と `vector-siamese-v1` の併用を正本化し、低歪み局面（volume/range/price-band concentration が弱い）は gate 適用をスキップしてノイズ照合を抑制する方針を追加。
- **2026-02-17**: Pattern backend 比較ベンチ（`data/reports/pattern_backend_benchmark_2026-02-17.json`）の結果を反映し、`SWIMMY_PATTERN_ENSEMBLE_VECTOR_WEIGHT` の既定値を `0.00`（clip優先）へ更新。
- **2026-02-17**: Pattern backend 自動校正契約を追加。`tools/pattern_backend_calibration_update.py` + `swimmy-pattern-backend-calibration.timer` により定期ベンチを実行し、`data/patterns/models/ensemble_weight.json` を更新して service 側へ動的反映する方針を正本化。
- **2026-02-17**: Pattern backend 校正の監査契約を追加。`tools/system_audit.sh` に `tools/pattern_backend_calibration_status.py` を統合し、timer 有効性と calibration report 鮮度（既定48時間）を WARN 監査する方針を正本化。
- **2026-02-17**: Pattern backend 重み適用契約を拡張。`ensemble_weight.json` の `symbol_timeframe_weights`（`<SYMBOL>:<TF>`）を導入し、QUERY時の重み決定を `symbol+timeframe` 単位で上書き可能にした。
- **2026-02-17**: Pattern backend 運用実装を更新。`pattern_backend_calibration_update.py` が `ensemble_weight.json` に `symbol_timeframe_weights` を出力し、`pattern_similarity_service.py` の `STATUS/QUERY` レスポンスに重み適用情報（default file path / applied weight / weight_source）を返す方針を正本化。
- **2026-02-17**: Pattern Gate 実行ポリシーを更新。Lisp実売買側は `decision_action` を解釈し、`follow/mismatch=0.70x`、`fade=0.55x`、`no-trade=0.35x` の段階減衰を適用する（強制停止ではなく fail-soft）。あわせて telemetry に `vector_weight_applied/weight_source` を記録し、symbol+timeframe 重みの実適用を追跡可能にする。
- **2026-02-14**: Brain/Guardian の auto-revival（`swimmy-guardian` / `swimmy-watchdog`）は `systemctl restart` が polkit で `Interactive authentication required` になる環境を想定し、**まず** `sudo -n /usr/bin/systemctl restart <unit>` を試す。成功すれば SIGTERM フォールバックを使わずに復旧できる（flapping/進捗リセットを抑制）。`sudo -n` が使えない場合/許可が無い場合は従来通り `systemctl show -p MainPID --value` → `SIGTERM`（必要時 `SIGKILL`）で MainPID を落とし、systemd の `Restart=` で復旧させる。
- **2026-02-14**: passwordless `systemctl` 運用を `/etc/sudoers.d/swimmy-systemctl`（`restart/status/is-active` を unit 限定で許可）で提供する方針を追加。テンプレートは `tools/ops/swimmy-systemctl.sudoers`、インストールは `sudo bash tools/ops/install_swimmy_systemctl_sudoers.sh` を正本とする。
- **2026-02-14**: Polymarket OpenClaw status の運用契約を更新。cycle timer が無効なとき、status ファイルが更新されず stale になるのは仕様のため `Health: disabled` として扱い、`--fail-on-problem` でも exit 0 とする方針へ更新。
- **2026-02-14**: Archive drift の表示契約を更新。Library の GRAVEYARD/RETIRED raw dir count は overlap により二重計上されるため、drift 判定を canonical(unique-name) に統一し、`delta(DB-LibraryCanonical)` と `overlap` を併記する方針へ更新。
- **2026-02-13**: BACKTEST_RESULT 適用の数値メトリクス耐性を追加。`metrics` がキー存在でも値が `NIL` の場合は `0.0/0` として正規化し、`The value NIL is not of type REAL` で受信ループが落ちないことを正本化。
- **2026-02-13**: `Msg Error` 可観測性を強化。message-dispatcher の例外ログに `head`（先頭プレビュー）と `step`（ブレッドクラム）を付与し、原因メッセージ/経路を同定できるように更新。
- **2026-02-13**: Allocation の pending 管理を修正。executor の `swimmy.globals:*pending-orders*`（UUID→(ts,retry,msg)）と School の execution slot 用 pending を分離し、`check-pending-timeouts` が誤って retry table を走査して `NIL is not of type REAL` を起こす不具合を解消（`*allocation-pending-orders*` 導入）。
- **2026-02-13**: PF/WR mutation bias の S-target を追加。両親が A-rank 以上のときは S基準（PF=1.70/WR=0.50）を mutation bias のターゲットとして扱い、A基準達成後も S readiness を探索圧として維持する。
- **2026-02-13**: Graveyard Avoidance の運用契約を更新。`analyze-graveyard-for-avoidance` は graveyard.sexp の破損フォームで中断せずスキップ継続し、`SWIMMY_GRAVEYARD_AVOID_CACHE_SEC` によるTTLキャッシュで child 生成ごとの全走査を防ぐ方針を追加。
- **2026-02-13**: `migrate-existing-data` の graveyard 読み込み契約を更新。`read` 一括読込で破損行に遭遇すると migration 全体が停止するため、行単位 `safe-read-sexp` に変更し、破損行をスキップして継続する方針を追加。
- **2026-02-13**: `collect-all-strategies-unpruned` の計算量契約を更新。DB+Library の重複除外を線形探索から `strategy_name` ハッシュ集合へ変更し、O(n) で統合する方針を追加。
- **2026-02-13**: OOS結果適用のフォールバック契約を追加。`handle-oos-backtest-result` は in-memory miss でも DB（`strategies.data_sexp`）復元を試み、両方不在時のみ `Strategy not found for OOS result` を記録する方針を明記。
- **2026-02-13**: `strategies` テーブルの検索最適化契約を追加。`idx_strategies_rank_sharpe` と `idx_strategies_category_rank` を `init-db` で必須作成し、ランク/カテゴリ条件の抽出を高速化する方針を明記。
- **2026-02-13**: Backtest pending カウンタの運用契約を更新。`submit-recv` の過大ドリフト時に送信側で安全リベースして `MAX_PENDING` 張り付きによる永続停止を回避する方針を追加。
- **2026-02-13**: BACKTEST_RESULT 名正規化契約を強化。`-RR/-QUAL/-OOS/_P1` は末尾一致のみで除去し、基底名中の `-QUAL-...` を誤って切り落とさない方針を追加。
- **2026-02-13**: `tools/evolution_daemon.py` の排他運用契約を更新。起動後に `swimmy-school` が立ち上がった場合でも evolution 子SBCLを停止して待機へ戻し、二重の `start-evolution-service` ループを継続しない方針を追加。
- **2026-02-13**: School Connector の Wisdom 実行を間隔制御へ変更。`SWIMMY_WISDOM_UPDATE_INTERVAL_SEC`（既定1800秒）を導入し、`phase-7-wisdom-update` が毎サイクルで `analyze-veterans` を実行しない方針を追加。
- **2026-02-13**: `analyze-veterans` の処理契約を更新。de-dup/filter/sort を単一パス化し、`Top-N`（50件）のみ保持する実装へ変更して Wisdom 抽出時のピークメモリを削減。
- **2026-02-13**: Breeder の補完ペア距離ゲートを調整。`*breeder-min-genetic-distance-complement*=0.01`、`*breeder-min-genetic-distance-partial-recovery*=0.02` を正本化し、`Dist 0.01-0.02` 帯で補完交配が継続的に reject される停滞を緩和する方針を追加。
- **2026-02-13**: Breeder の低PF回復圧を強化する方針を追加。`avg_pf<=1.15 && avg_wr>=0.43` のペアで PF回復モード（RR floor/scale floor 強化）を適用し、PF不足停滞の打破を優先する契約を追記。
- **2026-02-13**: Breeder の WR補完判定を動的化。親PF余剰と候補WR余剰に応じて `WR-complement` の最低PF閾値を `1.18 -> max(1.08, 動的閾値)` へ緩和し、`PF-only x 高WR` の有効ペアを取りこぼさない方針を追加。
- **2026-02-13**: PF回復の上位ターゲット圧を追加。`avg_wr>=0.47` かつ `avg_pf<1.70` の WR-ready ペアに `upside scale floor` を適用し、A基準達成済みでも S基準PFへ寄せる探索圧を維持する方針を追記。
- **2026-02-13**: B-Rank culling の保持順を PF帯優先へ更新。`PF>=A基準` → `PF near` → `others` の順に保持候補を選び、同帯内のみ culling score で並べる方針を追加。
- **2026-02-13**: `tools/system_audit.sh` の systemd監査を強化。`sudo -n` が使えない環境でも `systemctl` 直実行へフォールバックして状態確認を継続し、監査自体を `skipping systemctl status` で欠落させない方針を追加。
- **2026-02-13**: `tools/system_audit.sh` の監査契約を更新。`swimmy-pattern-similarity` は unit 未登録でも実プロセス + `:5564` LISTEN を fallback 健全判定として扱い、`Interactive authentication required` 発生時の auto-repair は WARN スキップで監査継続する方針を追加。
- **2026-02-13**: Dashboard のサービス表示契約を更新。`PatternSim` は systemd unit 未登録時でも fallback 健全判定（実プロセス + `:5564` LISTEN）を表示に反映し、運用者が実稼働を誤認しない方針を追加。
- **2026-02-13**: `tools/deep_audit.lisp` をストリーミング監査へ更新。archive-heavy DB でも `init-knowledge-base` を呼ばず、DB/Library のランク集計と `data_sexp` のサンプル復元で健全性を確認する方針へ変更。
- **2026-02-13**: `backtest_status.txt` の保存先を `swimmy.main::*backtest-status-path*` へ抽象化。テストは一時ファイルへバインドし、本番 `data/reports/backtest_status.txt` を汚染しない方針へ更新。
- **2026-02-12**: Evolution Report の `System Status` 契約を更新。`Evolution Daemon Active` を固定表示せず、systemd実状態（`swimmy-evolution.service`）を反映し、`systemctl` 取得不能時のみ heartbeat 補助判定へ切替える方針を追加。
- **2026-02-12**: Evolution Report の表示整形契約を更新。`CPCV Stage2` / `A Near-Miss` の `%` が `%%` で出る退行を修正し、A Near-Miss の同名戦略重複表示を抑制する方針を追加。
- **2026-02-12**: Evolution Report の候補名短縮契約を更新。先頭25文字のみの省略で同名衝突が発生するため、先頭+末尾を保持する短縮表示へ統一する方針を追加。
- **2026-02-12**: Evolution Report に Validation Coverage（OOS/CPCVのDB累計、全体/Active）を追加する方針を追記。`CPCV Status` の瞬間値だけでは実行実績を誤読しやすい点を補正する。
- **2026-02-13**: Evolution Report に A Gate Pressure（Active B の A Stage1 ゲート通過件数/PF近傍帯）を追加する方針を追記。Sharpe高値でも A/S が 0 のとき、Stage1（特に PF）詰まりを即時判読できるようにする。
- **2026-02-13**: B-Rank culling の A基準欠損ペナルティを PF優先へ調整する方針を追記。PF不足を WR/Sharpe/MaxDD より重く扱い、`pass_all=0` 停滞時の PF ボトルネック解消を優先する。
- **2026-02-12**: Backtest throttle の診断ログ契約を追加。`pending` 超過と `rate` 未達を原因別にログ表示し、`pending=1/max=3000` のような rate 由来 throttled を誤解しない運用へ更新。
- **2026-02-12**: Backtest の運用レート上限を段階調整。`SWIMMY_BACKTEST_RATE_LIMIT` を `100→120→140` に更新し、`pending` 低位でも `rate limit` 再キューが発生するボトルネックを緩和する方針を追加。
- **2026-02-12**: Backtest Service worker 数を運用調整。`SWIMMY_BACKTEST_WORKERS` を `4→6` へ引き上げ、`pending` が低位でも結果反映が断続的に止まる状況のスループット改善を狙う方針を追加。
- **2026-02-13**: Backtest Service worker 数を追加調整。`SWIMMY_BACKTEST_WORKERS` を `6→8` へ引き上げ、CPU/メモリ余力を使って RR バッチの処理密度を高める運用へ更新。
- **2026-02-13**: メモリ圧迫対応として Backtest knobs を再調整。`SWIMMY_BACKTEST_WORKERS` を `8→3`、`SWIMMY_BACKTEST_MAX_INFLIGHT=6` を明示し、`MAX_PENDING`（Lisp送信側）と `MAX_INFLIGHT`（Service側）の役割を分離して運用する方針を追加。
- **2026-02-13**: Breeder生成物のPhase1スクリーニング契約を強化。`add-to-kb(source=:breeder, require-bt=T)` は Sharpe値に依存せず `run-phase-1-screening` を必須化し、初期ランクを `:incubator` として非検証の即時B昇格を抑止する方針を追加。
- **2026-02-13**: Breeder運用経路を契約に再整合。`run-breeding-cycle` から `add-to-kb` 呼び出しは `:require-bt t` を正本とし、実運用で Breeder child が必ず Phase1 screening を経由する方針を追加。
- **2026-02-13**: Legend交配統合契約を追加。`run-legend-breeding` で生成される子戦略も `add-to-kb(:breeder :require-bt t)` に統一し、直接KB投入による検証スキップを禁止する方針を明記。
- **2026-02-13**: Scout語彙廃止契約を追加。新規ランク生成/フォールバックを `:incubator` へ統一し、旧 `:scout` は後方互換としてのみ受理する方針を明記。
- **2026-02-13**: BACKTEST_RESULT の `_P1` サフィックス正規化契約を追加。Phase1結果を基底戦略名へ正規化してDB反映し、RR/QUAL進捗集計への混入を防止する方針を追記。
- **2026-02-13**: Backtest Request の `request_id` 必須契約を更新。`request-backtest-v2`（Phase1）が `request_id` なしで送信されると Backtest Service で `request_id="MISSING"` error結果となるため、送信時に相関IDを必須付与する方針を明記。
- **2026-02-13**: Backtest/CPCV の timeout 進捗通知契約を更新。途中経過通知ではバッファ/expectedを破棄せず保持し、進捗スナップショット後に start時刻だけ更新して重複通知スパムを抑制する方針を追加。
- **2026-02-13**: Backtest進捗通知の可観測性契約を拡張。RR/QUAL通知に Throughput/ETA を追加し、Top Strategy Results へ PF/WR/MaxDD を併記して Sharpe単独誤読を抑止する方針を追記。
- **2026-02-13**: Evolution Report の `Source Drift` 表示を補強。Graveyard/Retired mismatch に `delta(DB-Library)` を付与し、ドリフト方向（DB余剰/Library余剰）を明示する方針を追加。
- **2026-02-13**: `reconcile_archive_db.py` に `--grace-sec` を実装。`mtime > (scan_start - grace_sec)` の archive ファイルを当該実行から除外し、稼働中レースで `wrong_rank` が揺れ続ける問題を抑制する（既定 `0` は無効）。
- **2026-02-12**: `finalize_rank_report` の運用契約を更新。既定動作を集計専用（rank変更なし）にし、`SWIMMY_FINALIZE_REPORT_RUN_RANK_EVAL=1` 指定時のみ rank評価を実行する方針を追加。
- **2026-02-12**: 最終エントリー前に Signal Confidence Gate を追加。低確度シグナルは見送り、中確度シグナルはロット縮小（0.55x）で実行し、無差別エントリーを抑制する方針を明記。
- **2026-02-12**: Dashboard の backtest欄に systemd/listener drift 可視化を追加する方針を追記。`inactive + listener` や PID mismatch を画面上で即時判読可能にする。
- **2026-02-12**: `swimmy-backtest` の systemd運用ドリフト検知方針を追加。`inactive + manual 5580 LISTEN` を監査FAIL扱いにし、systemd正本への復帰を促す。
- **2026-02-12**: Backtest Service の S式正規化を強化する方針を追加。`(strategy (k . v) ...)` などの短縮表現を含むBACKTEST要求でも bool を `#t/#f` へ正規化して Guardian へ転送し、`invalid type: symbol, expected boolean` を防止する。
- **2026-02-13**: Backtest Service の bool 正規化フォールバックを追加する方針を追記。S式 parse 正規化が失敗するケースでも、既知 bool キーの `t/nil` を `#t/#f` へ保守的に置換して Guardian parse error を抑止する。
- **2026-02-13**: `reconcile_archive_db.py` の運用を拡張。DB-only archive drift の件数を常時表示し、`--prune-db-only` 指定時はバックアップテーブル退避後に prune 可能とする方針を追記。
- **2026-02-12**: B-Rank culling の既定閾値を 20 へ引き上げる方針を追加。カテゴリごとの B 基盤を 20 件まで維持する運用へ変更。
- **2026-02-12**: B-Rank culling の prune順を A基準欠損ペナルティ込みへ更新する方針を追加。Sharpe偏重で A基準から遠いBが残るドリフトを抑制する。
- **2026-02-12**: Backtest Service の実行モデルを並列worker対応に拡張する方針を追加。`SWIMMY_BACKTEST_WORKERS` で Guardian `--backtest-only` の並列数を制御し、inflight 非同期処理で `pending` 上限張り付き時のスループット低下を緩和する。
- **2026-02-12**: B-Rank culling の保持契約を追加。A候補以外を全量 graveyard 化する挙動を廃止し、カテゴリごとのB基盤（`*culling-threshold*` 件以上）を保持したうえで超過分のみ prune する方針を明記。
- **2026-02-12**: Backtest送信キューの実装契約を更新。`length`/`nconc` 依存を廃止し O(1) キュー運用を正本化、あわせて `SWIMMY_BACKTEST_SEND_QUEUE_MAX` による容量調整方針を追加。
- **2026-02-12**: Evolution/Backtest系レポートに A Stage1 基準の不合格内訳（Sharpe/PF/WR/MaxDD）を常時表示する方針を追加。
- **2026-02-12**: Evolution Report に A Near-Miss（Bランク上位）表示を追加する方針を追記。`a-base-deficit-score` が小さい順に候補を提示し、各候補の不足ゲート（Sharpe/PF/WR/MaxDD）を併記して A/S 停滞の原因を即時確認できるようにする。
- **2026-02-12**: RR Backtest Batch の送信をレート制限に同期。受理済み dispatch ごとに `1 / SWIMMY_BACKTEST_RATE_LIMIT` 秒の間隔を挿入し、同一バッチ内 `:throttled` 連発で `Queued: 1` 近傍に張り付く失速を抑制する方針を追加。
- **2026-02-12**: Deferred Founder Backtest Flush の送信をレート制限に合わせて間隔化（`1 / SWIMMY_BACKTEST_RATE_LIMIT` 秒）。同一tickで `:throttled` が連発して `Deferred BT sent` が実質 `1件/tick` になる失速を抑制する方針を追加。
- **2026-02-12**: `request-cpcv-validation` の送信S式キーを正規化（`action/strategy_name/candles_file/request_id/strategy_params` を package 非依存で出力）し、呼び出し元 `*package*` による `swimmy.school::action` 形式のドリフトを防止する方針を追加。
- **2026-02-12**: Telemetry ログ書き込みを耐障害化。主要ログの Permission denied / rotate 競合時に `data/memory/swimmy.telemetry.fallback.jsonl` へ退避するフォールバックを追加し、`run-all-tests` は telemetry 出力先を `data/memory/` 配下へ隔離して運用ログとの競合を避ける方針を明記。
- **2026-02-12**: `systemd/swimmy-school.service` に `User=swimmy` / `Group=swimmy` を明示し、systemd正本ユニットの実装を STATE の運用方針（非root実行）に再整合。
- **2026-02-12**: AランクWR下限の実装ドリフトを修正。`school-rank-system` / Evolution Report文言 / 単体テスト / 運用ドキュメントを `WR>=43%` に統一し、`WR>=38%` 例外を撤廃。
- **2026-02-12**: Evolution Report 保存の実装契約を修正。`write-evolution-report-files` が `*evolution-report-path*` を正本に使用し、テスト実行時の固定パス上書きドリフトを防止する方針を追加。
- **2026-02-12**: `run-all-tests` のレポート出力隔離を追加。`*evolution-report-path*` を `data/memory/swimmy-tests-evolution-report.txt` へバインドし、テストで本番 `evolution_factory_report.txt` が上書きされないように修正。
- **2026-02-11**: Backtest送信の計上契約を強化。スロットル時は可能な限り再キューし、RR/QUAL/Deferred/OOS の expected/sent は `NIL/:throttled` を除外して計上するよう方針を明文化。
- **2026-02-11**: AランクのWR下限を正本（SPEC/STATE）へ再整合する方針を確定。`WR>=43%` を単一の運用基準とし、実装側の `38%` 例外を廃止。
- **2026-02-11**: Dynamic Drawdown Alert の Peak 金額表示を整数表記へ統一し、`¥1000000.` のような末尾小数点が Discord 通知に出ないよう修正（`DYNAMIC DRAWDOWN WARNING` の文面整形）。
- **2026-02-11**: Executor の heartbeat pulse 表示 `Equity` を整数表記へ統一し、`Equity: 1000000.` のような末尾小数点を解消。
- **2026-02-11**: Executor/Risk の円建てログ表記を追加整合。`MT5 Sync`、`EQUITY UNKNOWN OR ZERO` fallback、`DAILY LOSS LIMIT HIT` の金額表示を整数表記へ統一し、末尾小数点を除去。
- **2026-02-11**: 円建て表示の追加整合を拡張。Heartbeat summary、Trade close fallback通知、Global Stats PnL、Darwin daily toxic ログの金額表示も整数表記へ統一し、末尾小数点を除去。
- **2026-02-11**: School heartbeat 更新をサイクル完了依存から独立tickへ変更。`run-stagnant-flush-tick` で `data/heartbeat/school.tick` を更新し、長時間フェーズ実行中の `Evolution report/heartbeat stale` 誤検知を抑制。
- **2026-02-11**: Pattern Similarity の Phase 2（ベクトル深層学習）を追加。`tools/pattern_vector_dl.py` と `tools/train_pattern_vector_model.py` を実装し、service側で学習済み Siamese チェックポイントを自動ロードして `model=vector-siamese-v1` を返せるように更新。未配置時は `vector-fallback-v1` へフォールバック。
- **2026-02-11**: Data Keeper の Tick API（`ADD_TICK` / `GET_TICKS`）を実装。`tools/test_data_keeper_sexp.py` に契約テスト（追加/取得/時間窓）を追加。
- **2026-02-11**: Lisp Core に Pattern Similarity client を追加（`SWIMMY_PORT_PATTERN_SIMILARITY` / 既定5564）。`school-execution` に H1+ のソフトゲート（不一致時 lot 0.7x）を接続し、`execution.pattern_gate` telemetry を追加。
- **2026-02-11**: Pattern Similarity Service (5564) の Phase 1 実装を追加。`tools/pattern_similarity_service.py`、`systemd/swimmy-pattern-similarity.service`、`tools/test_pattern_similarity_sexp.py` を追加し、`tools/install_services.sh` / `tools/system_audit.sh` にサービス反映。
- **2026-02-11**: `upsert-strategy` に Archive Rank 保護を追加し、DB既存 `:GRAVEYARD/:RETIRED` が通常upsertで `NIL/Active` に戻る退行を防止。
- **2026-02-11**: OOS dispatch の成否契約を厳格化。Backtest送信が受理されなかった要求を `sent` に残さず `error` 化し、`oos_status` の `sent/pending` 誤増加を抑制。
- **2026-02-11**: OOS status 表示のダミー値を廃止。`data/send/db` の失敗内訳と latency(avg/min/max) を実測から表示するよう更新。
- **2026-02-11**: CPCV status の `failed` を内訳表示（`send_failed/result_failed(runtime/criteria)`）に拡張し、ゲート未達と実行系エラーを区別可能にした。
- **2026-02-11**: CPCV受信結果の分類を強化し、`path_count/passed_count/failed_count=0` の空結果を `runtime` 失敗として扱うように更新。未知戦略名の CPCV 個別通知を抑制して `Strategy: AAA` ノイズ通知を防止。
- **2026-02-11**: ランク判定を `Balanced + 2段階ゲート` に更新する方針を確定。Stage 1固定閾値（B/A/S）を引き上げ、Stage 2に OOS/CPCV/MC/DryRun を組み合わせる昇格ゲートを正本化。
- **2026-02-11**: ランク昇格ロジックを実装更新。A昇格に `Expectancy>0` を追加し、A/S共通で `MC prob_ruin<=2%` と `DryRun p95(slippage)<=max_spread` を必須化。`TRADE_CLOSED` のスリッページ計測を戦略単位で蓄積して DryRun ゲートに接続。
- **2026-02-11**: DryRunスリッページの永続化を追加。`dryrun_slippage_samples` を導入し、戦略ごとの最新サンプル保持（既定200件）と再起動後のゲート継続を実装。
- **2026-02-11**: DryRunスリッページ永続化に期間保持（TTL）を追加。`*dryrun-slippage-max-age-seconds*` が正値のとき、`dryrun_slippage_samples` の保持期間外サンプルを戦略単位で削除する。
- **2026-02-11**: `systemd/swimmy-guardian.service` の再起動ポリシーを強化（`Restart=always`、`StartLimitIntervalSec=300`、`StartLimitBurst=5`）。
- **2026-02-11**: `swimmy-guardian` の Brain auto-revival を強化。`systemctl restart swimmy-brain` が失敗した場合に `systemctl show -p MainPID --value swimmy-brain` → `SIGTERM`（必要時 `SIGKILL`）で MainPID を落とし、systemd の `Restart=` で復旧させるフォールバックを追加。
- **2026-02-11**: Guardian の `CPCV_VALIDATE` S式パーサでキー正規化を強化。`swimmy.school::action` のような package 修飾キーでも `action` として受理し、`missing action` による parse/serialize error を抑止。
- **2026-02-11**: Brain の Port 5556（Motor Output）に `HEARTBEAT` を定期送信する運用を明記（Guardian の Brain Silence（>120s）誤検知を防ぐ）。送信は periodic maintenance から呼び出し、内部で約10秒スロットル。
- **2026-02-10**: `swimmy-watchdog` の自動復旧で `systemctl restart` が権限不足（polkit）で失敗するケースに対応し、失敗時は `systemctl show MainPID` → `SIGTERM/SIGKILL` で MainPID を落として systemd の `Restart=` に復旧させるフォールバックを追加。
- **2026-02-06**: `strategy_daily_pnl` の日次集計と 00:10 JST スケジュールを追加。日次PnL相関（Pearson）と非相関スコア通知（A/S昇格時）を実装。
- **2026-02-06**: Retired Rank を追加（Max Age退役、`data/library/RETIRED/`・`data/memory/retired.sexp`）。Evolution Report/DB集計に Retired を追加。
- **2026-02-06**: Pair-Composite の設計を確定し、`trade_logs` に `pair_id`、`backtest_trade_logs` を追加。`BACKTEST_RESULT` の `trade_list` を永続化し、`trades` は件数のまま維持。PnL系列は OOS/CPCV/Backtest を結合、`oos_kind` は `-OOS`=OOS / `-QUAL/-RR`=BACKTEST(IS) とする方針を明記（ペア選定/スコアは未実装）。候補母集団は **シンボル×TFごとの上位N=50** とする方針を追加。
- **2026-02-07**: ペア戦略の永続化・OOS/CPCV合成ゲート・ハイブリッド枠選抜・日次 00:10 スケジュール連携を実装。`pair_strategies` 保存、`CPCV_RESULT` trade_list 永続化、`refresh-pair-strategies`/`refresh-pair-active-defs` による選抜更新が稼働。
- **2026-02-06**: 起動時に `oos_queue` を全クリアし、古い request_id が残らないようにする方針を明記。
- **2026-02-06**: `BACKTEST_RESULT` の `request_id` を必須とする契約を明記。
- **2026-02-05**: 補助サービス（Data Keeper / Risk Gateway / Notifier）ZMQをS式のみに統一（legacy JSON廃止、`schema_version=1` 必須）。
- **2026-02-05**: Notifier の `payload`（S式）を受理し、`payload_json` 互換をINTERFACESに明記。
- **2026-02-05**: SBCLロード時WARNING/STYLE-WARNINGの全解消（ロード順、export、未使用変数、廃止フックの整理）。
- **2026-02-05**: 補助サービス（Data Keeper / Risk Gateway / Notifier）のS式スキーマをINTERFACESに定義（`schema_version=1`）。
- **2026-02-03**: Structured Telemetry を導入（JSONLイベントログ統合、`log_type="telemetry"`）。`system_metrics.sexp` / `live_status.sexp` を原子書き込みに統一。
- **2026-02-04**: `run.sh` の Brain 起動は `brain.lisp` 優先、欠落時はASDF直起動フォールバックの方針を明記。
- **2026-02-04**: Backtestのpending/レート制御とDeferred Flush制御パラメータをSTATEに明記。
- **2026-02-04**: `SWIMMY_BACKTEST_CSV_OVERRIDE` でBacktestのCSV差し替えを許可する方針を明記。
- **2026-02-04**: Backtest V2の`Option`表現（`timeframe`等）は空/1要素リストが正本と明記。
- **2026-02-04**: `tools/system_audit.sh` と `tools/test_notifier_direct.py` で `.env` を自動読み込みする運用に統一。
- **2026-02-04**: `tools/system_audit.sh` に `SUDO_CMD` で sudo 実行方法を上書きできる運用を追加（非対話 `sudo -n` 既定、必要時は対話式 `sudo`）。
- **2026-02-04**: MT5コマンド送信をS式に統一（ORDER_OPENは `instrument`/`side`）。`InpWSL_IP` のデフォルトを空に変更。
- **2026-02-04**: `backtest_status.txt` に `last_request_id` を追加。
- **2026-02-04**: MCPの `request_id` を JSON-RPC id/明示指定から引き回すよう統一。
- **2026-02-04**: `tools/dashboard.py` は systemd(system) の状態を正として表示する方針に統一。
- **2026-02-03**: REQ_HISTORY の要求キーを `count` に統一（`volume` は廃止）。
- **2026-02-03**: MT5系メッセージ（HISTORY/POSITIONS/SWAP_DATA/ORDER_ACK/TRADE_CLOSED）と管理コマンド（GET_POSITIONS/GET_SWAP/CLOSE_SHORT_TF）をINTERFACESに明記。
- **2026-02-04**: 内部ZMQはS式のみ（JSON受理しない）に厳格化。ORDER_OPENは`instrument/side/lot`に固定。
- **2026-02-01**: systemdの `swimmy-guardian` をRust Guardian実行に修正し、evolution daemonのSBCLメモリ設定を `SWIMMY_SBCL_DYNAMIC_SPACE_MB` に統一。watchdogのsystemdユニットを追加。
- **2026-02-01**: owners guide / runbook のsystemd操作をsystemレベル（`sudo systemctl ...`）に一本化。`.env` の読み込み方法を修正してコメント行エラーを解消。
- **2026-02-01**: Backtest ServiceのS式戦略名抽出正規表現を修正（`re.error: unbalanced parenthesis` 対策）。
- **2026-02-01**: monolith `swimmy.service` をrepoから削除（systemdコア4サービス構成へ完全移行）。
- **2026-02-01**: systemdのsystemレベル正本ユニット（brain/guardian/school/data-keeper/backtest/risk/notifier/evolution/watchdog）をrepo側に整備し、`User=swimmy`/絶対パス指定で統一。
- **2026-02-01**: arXiv Scout の `last_sent` をリセットし、手動通知を実行。
- **2026-01-31**: SBCLロード時WARNING/STYLE-WARNINGの解消（未定義関数/変数・ロード順・重複定義の整理）。
- **2026-01-31**: SBCLロード時STYLE-WARNING追加整理（未使用変数の無視/削除、LLM圧縮コンテキスト適用、Founders docstring登録）。
- **2026-01-31**: SBCLロード時の重複定義WARNING整理（`calculate-slope`/`format-duration` の衝突回避）。
- **2026-01-31**: SBCLロード時STYLE-WARNING追加整理（school-* の未使用変数/ハンドラ整理）。
- **2026-02-01**: 依存ライブラリ更新（Quicklisp dist 2026-01-01）と警告対策（pzmq ASDF命名、cl-sqlite CFFI struct参照、ironclad/postmodernのdefgeneric再定義ガード）。
- **2026-02-01**: school-breeder の括弧不整合を修正（ロード時COMPILE-FILEエラー解消）。
- **2026-02-17**: AランクOOS dispatch に explicit range を追加。`maybe-request-oos-backtest` が `data/historical/<SYMBOL>_M1.csv` の timestamp から 70/30 split を算出し、`request-backtest` に `start_time/end_time` を渡す契約へ更新（suffix は `-OOS` 維持）。
- **2026-02-17**: `request-backtest` が `:start-ts/:end-ts` を受け取り、S式 BACKTEST payload に `start_time/end_time`（Option Some 形式）を含められるよう更新。
- **2026-02-17**: Guardian の :5559 SXP BACKTEST ルートでも `start_time/end_time` スライスを適用。`sub_from_brain` ルートと同じ日付範囲セマンティクスに統一。
- **2026-02-17**: Top Candidates 表示を `TE official/composite=official_trades/backtest_trade_logs_count` へ拡張。並び順は `max(official, composite)` を trade evidence として `evidence-adjusted-sharpe` に反映。
- **2026-02-17**: MT5 `SendHistoryData` の default history window を長期TF向けに拡張（D1=20000, W1=10000, MN1=2400）。
- **2026-02-01**: Quicklisp dist側のパッチを撤回し、`local-projects` のパッチ版を優先利用する構成に整理。
- **2026-02-01**: SBCL起動オプションを `SWIMMY_SBCL_DYNAMIC_SPACE_MB` に統一（run.sh / tools / systemd）。
- **2026-02-01**: Quicklisp local-projects固定化スクリプトとパッチを追加（`tools/setup_quicklisp_local_projects.sh`）。
- **2026-02-01**: Quicklispパッチをunified diff形式に整形し、`patch` 適用エラーを解消。
- **2026-02-01**: SBCLサニティチェックを追加（`tools/sbcl_sanity_check.sh`）。
- **2026-02-01**: V3.0「61-STRATEGY SIGNAL SYSTEM」を `tools/restore_legend_61.lisp` で再登録（59本追加、2本は重複判定で除外）。弱体Legendは `archive-weak-legends` で LEGEND-ARCHIVE へ退避。
- **2026-02-01**: Legend保護テストスクリプト `tools/test_legend_protection.lisp` 追加（Fortress/ensure-rank を検証）。
- **2026-02-01**: Legend再検証フラグ `strategy-revalidation-pending` を追加し、起動時に `queue-legend-revalidation` を自動実行。`restore_legend_61.lisp` を swimmy-school の `ExecStartPre` に組み込み、LEGEND-ARCHIVE もライブラリロード対象に追加。
- **2026-01-31**: arXiv Scout 通知に S/A/B/C の優先度ラベルを追加（スコア閾値: S=9-10, A=8, B=6-7, C<=5）。
- **2026-01-31**: arXiv Scout の手動再送（`last_sent` リセット → `--daily` 実行）を実施。
- **2026-01-31**: arXiv Scout の `last_sent` をリセットして手動再送を実施。
- **2026-01-31**: `SWIMMY_GEMINI_API_KEY` を `/home/swimmy/swimmy/.env` に更新（ユーザー対応）。
- **2026-01-31**: arXiv Scout デーモンを再起動（Geminiキー反映）。
- **2026-01-31**: Backtest Service プロトコルを **S式に統一**（JSON要求は廃止）。Brain/School→Backtest Service→Guardian 間はS式でやり取り。
- **2026-01-31**: arXiv Scout のDiscord Webhookを更新（通知先切替）。
- **2026-01-31**: `SYSTEM_COMMAND: HEARTBEAT_NOW` を追加（ZMQ 5555経由でDiscord Heartbeatを即時送信可能に）。
- **2026-01-31**: `swimmy-school.service` を enable/active に復帰（4サービス体制を再確立）。
- **2026-01-31**: ZMQポートを `SWIMMY_PORT_*` で上書き可能に統一。Backtest Service は `SWIMMY_BACKTEST_SERVICE` で有効化。
- **2026-01-31**: Data Keeper のsystemdユニット名を `swimmy-data-keeper` に統一。
- **2026-01-31**: ZMQ bind endpointのフォーマットを修正（`tcp://*:<port>` の生成不備を解消）。
- **2026-01-31**: `tools/deep_audit.lisp` でDB/KB初期化後に比較するよう調整。
- **2026-01-31**: V2 Screeningの欠損リンク修正とGraveyard照合の正規化を反映（Rank一本化に合わせた接続）。
- **2026-01-31**: Rankディレクトリ移行ツール追加（`tools/migrate_library_to_rank.py`）。
- **V50.5.1**: Evolution Factory Reportのメトリクス同期修正 (DBからの強制リロードを追加)。
- **V50.5**: Symbolic Hashing (論理重複排除), Service Isolation (Scribe), Broken Arrow Watchdog。
- **V50.2**: Engine of Life (親子対決進化)。
- **V49.8**: SQL Migration (KBのSQLite化)。
- **V49.4**: Hot Reloading, Regime Hard Lock。

## Legend運用メモ (2026-02-01)
- V3.0「61-STRATEGY SIGNAL SYSTEM」を初期化時に自動復元＆再検証キュー投入（`initialize-system` / `tools/restore_legend_61.lisp`）。重複はHighlanderで排除。
- 再検証完了まで `strategy-revalidation-pending` を立て、Breedingから除外。BACKTEST_RESULT 適用時に自動クリア。
- **Legend revalidation 状態同期契約（split-brain防止）**: `refresh-strategy-metrics-from-db` は Active rank（B/A/S/LEGEND）について `data_sexp` 由来の `strategy-revalidation-pending` と `strategy-breeding-count` も同期する。これにより `BACKTEST_RESULT` を別デーモン（brain）が消費する構成でも、school 側の in-memory フラグが stale のまま固定化されないことを正本とする。
- **Legend rank 同期ガード契約（immutability）**: `refresh-strategy-metrics-from-db` は DB rank 同期時に local `:LEGEND` を non-legend（`:B/:A/:S/NIL` など）へ上書き降格しない。明示的に許可される遷移は `:LEGEND -> :LEGEND-ARCHIVE` のみとし、DB側の stale rank による Legend 崩壊を fail-closed で防ぐ。
- **Legend restore DB resurrection 契約**: `restore-legend-61` は in-memory で既に `:LEGEND` の戦略でも、DB側 rank が `:GRAVEYARD/:RETIRED` のままなら起動時に `:LEGEND` へ自己修復（upsert）する。`old-rank == new-rank` で `ensure-rank` が no-op になっても、DB rank と Library rank のsplit-brainを放置しない。
- **Legend overflow immunity 契約**: `cull-pool-overflow`（Deathmatch overflow）は `:B` 以外（特に `:LEGEND/:A/:S` と `immortal`）を犠牲対象にしない。Pool上限超過時は「cullable Bのみ」から淘汰し、保護対象を `:GRAVEYARD` へ直接更新しない。
- LEGENDは墓場送りをブロック。弱いLegendは `archive-weak-legends` で `:legend-archive` として退避可能（`data/library/LEGEND-ARCHIVE/`）。LEGEND-ARCHIVE もロード対象に追加。
- `swimmy-school.service` の `ExecStartPre` で `tools/restore_legend_61.lisp` を実行し、起動時に Legends を自動復元＆再検証フラグセット（BACKTESTは本起動後に送信）。
- Breeding時のLegend占有率を各カテゴリ上位5本に制限、遺伝的距離しきい値を0.35へ強化。
- 保護テストは `tools/test_legend_protection.lisp`（CIでも実行）。

## Polymarket OpenClaw Runbook（任意）

### 状態確認（定常）
- Cycle timer（user）: `systemctl --user status swimmy-polymarket-openclaw.timer --no-pager`
- Cycle log: `tail -n 200 logs/polymarket_openclaw_cycle.log`
- Status（ファイル）: `python3 tools/polymarket_openclaw_status.py --output-dir data/reports/polymarket_openclaw_live`
- Status monitor（system）: `systemctl status swimmy-polymarket-openclaw-status.timer --no-pager`
- Notifier（system）: `systemctl status swimmy-notifier.service --no-pager`

### 停止（安全側）
- 自動売買停止（user）: `systemctl --user disable --now swimmy-polymarket-openclaw.timer`
- シグナル更新停止（user）: `systemctl --user disable --now swimmy-openclaw-signal-sync.timer`
- Status monitor 停止（system）: `sudo systemctl disable --now swimmy-polymarket-openclaw-status.timer`

### 初回セットアップ（最低限）
- Polymarket 側で **USDC Deposit** と **Approve Tokens** を 1 回通す（Allowance が 0 の間は注文が失敗する）。
- Allowance/Balances の診断: `python3 tools/polymarket_balance_allowance.py`
  - `balance` が USDC 残高、`allowances` が 0 でないこと（max uint が典型）。
- Proxy/Smart wallet を使う場合:
  - `POLYCLAW_LIVE_FUNDER=0x...` と `POLYCLAW_LIVE_SIGNATURE_TYPE=<int>` を設定する（EOA 署名者と funder が分離するため）。

### トラブルシュート（典型）
- `systemctl --user start swimmy-polymarket-openclaw.service` が無反応:
  - oneshot のため stdout が出ないのは正常。`systemctl --user status ...` と `journalctl --user -u ...`、`logs/polymarket_openclaw_cycle.log` を見る。
- status が `Health: disabled`:
  - cycle timer が disabled のときは意図的に disabled 扱い（stale 誤検知を抑止）。
- `missing_private_key`:
  - `POLYCLAW_LIVE_PRIVATE_KEY_FILE`（推奨）または `POLYCLAW_LIVE_PRIVATE_KEY` を設定する。
- `allowance=0` / `balance=0`:
  - Polymarket 側の Approve/Deposit が未完了。`tools/polymarket_balance_allowance.py` で確認する。

### セキュリティ（必須）
- 秘密鍵は `.env` 直書きではなく `POLYCLAW_LIVE_PRIVATE_KEY_FILE` を推奨。
  - 例: `~/.secrets/` を `chmod 700`、鍵ファイルは `chmod 600`
- Discord webhook は `config/.env.systemd` に隔離し、`chmod 600` で保護する（notifier/status は `.env` を読まない）。

## 次アクション
1. `2026-03-03 23:59 JST` までに `paper_trade_count>=20` かつ `slippage_sample_count>=20` を満たす（未達は停止）。
2. `2026-03-17 23:59 JST` までに fixed forward 判定 `net_pnl>0` かつ `PF>=1.10` を満たす（未達は停止）。
3. `2026-03-18 JST` に EA継続/停止を最終決定する（未達なら停止）。
4. founder 3通貨再監視（`founder_rank_watch_20260224_114359`）は別トラックで継続し、`B=3/Graveyard=0` の維持を確認する。

## リスク
- **複雑性**: 3言語 + SQLite + Python(Data Keeper) の複合システム。
- **ネットワーク**: WSL-Windows間の通信遮断。
